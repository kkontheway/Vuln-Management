2025-11-18 16:06:33,801 - __main__ - INFO - 开始执行Defender漏洞数据同步...
2025-11-18 16:06:34,460 - __main__ - INFO - 成功获取访问令牌
2025-11-18 16:06:34,497 - mysql.connector - INFO - package: mysql.connector.plugins
2025-11-18 16:06:34,497 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-11-18 16:06:34,497 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-11-18 16:06:34,512 - __main__ - INFO - 成功连接到MySQL数据库
2025-11-18 16:06:34,543 - __main__ - INFO - 数据库表结构初始化成功
2025-11-18 16:06:34,549 - __main__ - INFO - 开始执行全量同步...
2025-11-18 16:06:34,549 - __main__ - INFO - 正在请求: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-11-18 16:06:40,518 - __main__ - INFO - 获取到 50000 条记录
2025-11-18 16:06:40,519 - __main__ - INFO - 正在请求: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0xOC8wNjIyLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjQsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo0OTAxfQ==
2025-11-18 16:06:46,279 - __main__ - INFO - 获取到 50000 条记录
2025-11-18 16:06:46,280 - __main__ - INFO - 正在请求: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0xOC8wNjIyLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjgsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozMzgzMH0=
2025-11-18 16:06:51,187 - __main__ - INFO - 获取到 50000 条记录
2025-11-18 16:06:51,187 - __main__ - INFO - 正在请求: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0xOC8wNjIyLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjgsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4MzgzMH0=
2025-11-18 16:06:57,011 - __main__ - INFO - 获取到 50000 条记录
2025-11-18 16:06:57,012 - __main__ - INFO - 正在请求: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0xOC8wNjIyLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjksIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozMzgzMH0=
2025-11-18 16:07:01,605 - __main__ - INFO - 获取到 35786 条记录
2025-11-18 16:07:01,606 - __main__ - INFO - 总共获取到 235786 条记录
2025-11-18 16:08:53,349 - __main__ - INFO - 成功保存 235786 条漏洞记录
2025-11-18 16:08:53,350 - __main__ - INFO - 全量同步完成，获取了 235786 条记录
2025-11-18 16:09:57,703 - __main__ - INFO - 快照记录成功，快照ID: 2
2025-11-18 16:09:57,779 - __main__ - INFO - 更新同步时间成功: 2025-11-18 16:09:57.773037, 类型: full
2025-11-18 16:09:57,987 - __main__ - INFO - 数据库连接已关闭
2025-11-18 16:09:57,987 - __main__ - INFO - 漏洞数据同步完成
2025-11-20 13:58:39,770 - __main__ - INFO - 开始执行Defender漏洞数据同步... 数据源: vulnerability_list
2025-11-20 13:58:40,306 - __main__ - INFO - 成功获取访问令牌
2025-11-20 13:58:40,364 - mysql.connector - INFO - package: mysql.connector.plugins
2025-11-20 13:58:40,364 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-11-20 13:58:40,364 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-11-20 13:58:40,368 - __main__ - INFO - 成功连接到MySQL数据库
2025-11-20 13:58:40,551 - __main__ - INFO - 数据库表结构初始化成功
2025-11-20 13:58:40,554 - __main__ - INFO - 开始执行增量同步...
2025-11-20 13:58:40,556 - __main__ - INFO - 开始同步漏洞列表（全量）...
2025-11-20 13:58:40,556 - __main__ - INFO - 正在请求漏洞列表: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000
2025-11-20 13:58:48,315 - __main__ - INFO - 获取到 8000 条漏洞记录
2025-11-20 13:58:48,315 - __main__ - INFO - 总共获取到 8000 条漏洞列表记录
2025-11-20 13:58:50,804 - __main__ - INFO - 成功保存 8000 条漏洞列表记录
2025-11-20 13:58:50,804 - __main__ - INFO - 漏洞列表同步完成，获取了 8000 条记录
2025-11-20 13:59:50,223 - __main__ - INFO - 快照记录成功，快照ID: 3
2025-11-20 13:59:50,262 - __main__ - INFO - 漏洞列表快照记录成功，快照ID: 1
2025-11-20 13:59:50,325 - __main__ - INFO - 更新同步时间成功: 2025-11-20 13:59:50.319828, 类型: delta
2025-11-20 13:59:50,326 - __main__ - INFO - 数据库连接已关闭
2025-11-20 13:59:50,326 - __main__ - INFO - 漏洞数据同步完成
2025-11-21 15:43:33,417 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync... Data sources: device_vulnerabilities
2025-11-21 15:43:33,439 - mysql.connector - INFO - package: mysql.connector.plugins
2025-11-21 15:43:33,439 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-11-21 15:43:33,439 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-11-21 15:43:33,441 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-11-21 15:43:33,442 - app.integrations.defender.database - INFO - sync_state table already contains data_source column
2025-11-21 15:43:33,442 - app.integrations.defender.database - INFO - vulnerability_info table doesn't exist or already renamed
2025-11-21 15:43:33,442 - app.integrations.defender.database - ERROR - Database migration error: Unread result found
2025-11-21 15:43:33,487 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-11-21 15:43:33,496 - app.integrations.defender.sync - INFO - Starting delta sync...
2025-11-21 15:43:33,496 - app.integrations.defender.sync - INFO - Starting device vulnerability details sync (full)...
2025-11-21 15:43:34,110 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-11-21 15:43:34,110 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-11-21 15:43:40,378 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 15:43:40,378 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMTAyN30=
2025-11-21 15:43:46,088 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 15:43:46,088 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODk1MX0=
2025-11-21 15:43:52,241 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 15:43:52,241 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4ODk1MX0=
2025-11-21 15:43:57,414 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 15:43:57,414 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjgsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODk1MX0=
2025-11-21 15:44:01,656 - app.integrations.defender.api_client - INFO - Fetched 32009 records
2025-11-21 15:44:01,657 - app.integrations.defender.api_client - INFO - Total fetched 232009 records
2025-11-21 15:44:01,658 - app.integrations.defender.service - INFO - Successfully fetched 232009 vulnerability records
2025-11-21 15:46:19,984 - app.integrations.defender.repository - INFO - Successfully saved 232009 vulnerability records
2025-11-21 15:46:19,985 - app.integrations.defender.sync - INFO - Device vulnerability details sync completed, fetched 232009 records
2025-11-21 15:46:19,985 - app.integrations.defender.sync - INFO - Starting to generate vulnerability list from device vulnerability data...
2025-11-21 15:46:19,985 - app.integrations.defender.sync - INFO - Starting to generate vulnerability list (deduplicated by CVE ID from device vulnerability data)...
2025-11-21 15:46:21,212 - app.integrations.defender.repository - INFO - Generated 9696 deduplicated CVE records from device vulnerability data
2025-11-21 15:46:24,410 - app.integrations.defender.repository - INFO - Successfully saved 9696 vulnerability list records
2025-11-21 15:46:24,410 - app.integrations.defender.sync - INFO - Vulnerability list generation completed, 9696 deduplicated CVE records
2025-11-21 15:46:24,417 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-11-21 15:46:24.410931, type: full, data source: vulnerability_list
2025-11-21 15:46:24,428 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-11-21 15:46:24.423966, type: delta, data source: device_vulnerabilities
2025-11-21 15:47:17,873 - app.integrations.defender.repository - INFO - Snapshot recorded successfully, snapshot ID: 4
2025-11-21 15:47:17,938 - app.integrations.defender.repository - INFO - Vulnerability list snapshot recorded successfully, snapshot ID: 2
2025-11-21 15:47:18,012 - app.integrations.defender.sync - INFO - Database connection closed
2025-11-21 15:47:18,012 - app.integrations.defender.sync - INFO - Vulnerability data sync completed
2025-11-21 17:02:16,453 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-11-21 17:02:16,489 - mysql.connector - INFO - package: mysql.connector.plugins
2025-11-21 17:02:16,489 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-11-21 17:02:16,489 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-11-21 17:02:16,493 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-11-21 17:02:16,578 - app.integrations.defender.database - INFO - vulnerabilities table already exists, migration may not be needed
2025-11-21 17:02:16,578 - app.integrations.defender.database - ERROR - Database migration error: Unread result found
2025-11-21 17:02:16,642 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-11-21 17:02:16,642 - app.integrations.defender.sync - INFO - Starting full sync...
2025-11-21 17:02:16,642 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-11-21 17:02:17,379 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-11-21 17:02:17,379 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-11-21 17:02:22,908 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:02:22,908 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMTAyN30=
2025-11-21 17:02:28,620 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:02:28,621 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODk1MX0=
2025-11-21 17:02:35,113 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:02:35,113 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4ODk1MX0=
2025-11-21 17:02:40,968 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:02:40,969 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjgsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODk1MX0=
2025-11-21 17:02:45,619 - app.integrations.defender.api_client - INFO - Fetched 32009 records
2025-11-21 17:02:45,620 - app.integrations.defender.api_client - INFO - Total fetched 232009 records
2025-11-21 17:02:45,620 - app.integrations.defender.service - INFO - Successfully fetched 232009 vulnerability records
2025-11-21 17:02:45,628 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-11-21 17:02:45,789 - app.integrations.defender.repository - INFO - Preparing 232009 records for batch insert...
2025-11-21 17:02:48,931 - app.integrations.defender.repository - INFO - Inserting 232009 records in batches of 2000...
2025-11-21 17:02:49,439 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-11-21 17:02:49,746 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-11-21 17:02:50,025 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-11-21 17:02:50,278 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-11-21 17:02:50,534 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-11-21 17:02:50,933 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-11-21 17:02:51,161 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-11-21 17:02:51,371 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-11-21 17:02:51,602 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-11-21 17:02:51,909 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-11-21 17:02:52,146 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-11-21 17:02:52,339 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-11-21 17:02:52,568 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-11-21 17:02:52,982 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-11-21 17:02:53,258 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-11-21 17:02:53,494 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-11-21 17:02:53,786 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-11-21 17:02:53,999 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-11-21 17:02:54,308 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-11-21 17:02:54,524 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-11-21 17:02:54,774 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-11-21 17:02:54,979 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-11-21 17:02:55,168 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-11-21 17:02:55,341 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-11-21 17:02:55,508 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-11-21 17:02:55,820 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-11-21 17:02:55,988 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-11-21 17:02:56,164 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-11-21 17:02:56,336 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-11-21 17:02:56,520 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-11-21 17:02:56,759 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-11-21 17:02:56,933 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-11-21 17:02:57,102 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-11-21 17:02:57,266 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-11-21 17:02:57,441 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-11-21 17:02:57,616 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-11-21 17:02:57,861 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-11-21 17:02:58,032 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-11-21 17:02:58,366 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-11-21 17:02:58,555 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-11-21 17:02:58,839 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-11-21 17:02:59,023 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-11-21 17:02:59,213 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-11-21 17:02:59,388 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-11-21 17:02:59,566 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-11-21 17:02:59,871 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-11-21 17:03:00,061 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-11-21 17:03:00,250 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-11-21 17:03:00,422 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-11-21 17:03:00,600 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-11-21 17:03:00,939 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-11-21 17:03:01,114 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-11-21 17:03:01,291 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-11-21 17:03:01,464 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-11-21 17:03:01,656 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-11-21 17:03:01,886 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-11-21 17:03:02,078 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-11-21 17:03:02,260 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-11-21 17:03:02,440 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-11-21 17:03:02,614 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-11-21 17:03:02,862 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-11-21 17:03:03,144 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-11-21 17:03:03,343 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-11-21 17:03:03,525 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-11-21 17:03:03,806 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-11-21 17:03:04,015 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-11-21 17:03:04,214 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-11-21 17:03:04,404 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-11-21 17:03:04,586 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-11-21 17:03:04,844 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-11-21 17:03:05,050 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-11-21 17:03:05,245 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-11-21 17:03:05,441 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-11-21 17:03:05,636 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-11-21 17:03:05,849 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-11-21 17:03:06,137 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-11-21 17:03:06,345 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-11-21 17:03:06,535 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-11-21 17:03:06,793 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-11-21 17:03:06,980 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-11-21 17:03:07,163 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-11-21 17:03:07,351 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-11-21 17:03:07,531 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-11-21 17:03:07,725 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-11-21 17:03:07,952 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-11-21 17:03:08,138 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-11-21 17:03:08,312 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-11-21 17:03:08,495 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-11-21 17:03:08,677 - app.integrations.defender.repository - INFO - Inserted batch 89 (2000 records)
2025-11-21 17:03:08,912 - app.integrations.defender.repository - INFO - Inserted batch 90 (2000 records)
2025-11-21 17:03:09,150 - app.integrations.defender.repository - INFO - Inserted batch 91 (2000 records)
2025-11-21 17:03:09,349 - app.integrations.defender.repository - INFO - Inserted batch 92 (2000 records)
2025-11-21 17:03:09,535 - app.integrations.defender.repository - INFO - Inserted batch 93 (2000 records)
2025-11-21 17:03:09,855 - app.integrations.defender.repository - INFO - Inserted batch 94 (2000 records)
2025-11-21 17:03:10,054 - app.integrations.defender.repository - INFO - Inserted batch 95 (2000 records)
2025-11-21 17:03:10,240 - app.integrations.defender.repository - INFO - Inserted batch 96 (2000 records)
2025-11-21 17:03:10,427 - app.integrations.defender.repository - INFO - Inserted batch 97 (2000 records)
2025-11-21 17:03:10,609 - app.integrations.defender.repository - INFO - Inserted batch 98 (2000 records)
2025-11-21 17:03:10,864 - app.integrations.defender.repository - INFO - Inserted batch 99 (2000 records)
2025-11-21 17:03:11,061 - app.integrations.defender.repository - INFO - Inserted batch 100 (2000 records)
2025-11-21 17:03:11,247 - app.integrations.defender.repository - INFO - Inserted batch 101 (2000 records)
2025-11-21 17:03:11,418 - app.integrations.defender.repository - INFO - Inserted batch 102 (2000 records)
2025-11-21 17:03:11,703 - app.integrations.defender.repository - INFO - Inserted batch 103 (2000 records)
2025-11-21 17:03:11,911 - app.integrations.defender.repository - INFO - Inserted batch 104 (2000 records)
2025-11-21 17:03:12,111 - app.integrations.defender.repository - INFO - Inserted batch 105 (2000 records)
2025-11-21 17:03:12,296 - app.integrations.defender.repository - INFO - Inserted batch 106 (2000 records)
2025-11-21 17:03:12,483 - app.integrations.defender.repository - INFO - Inserted batch 107 (2000 records)
2025-11-21 17:03:12,763 - app.integrations.defender.repository - INFO - Inserted batch 108 (2000 records)
2025-11-21 17:03:12,990 - app.integrations.defender.repository - INFO - Inserted batch 109 (2000 records)
2025-11-21 17:03:13,203 - app.integrations.defender.repository - INFO - Inserted batch 110 (2000 records)
2025-11-21 17:03:13,386 - app.integrations.defender.repository - INFO - Inserted batch 111 (2000 records)
2025-11-21 17:03:13,569 - app.integrations.defender.repository - INFO - Inserted batch 112 (2000 records)
2025-11-21 17:03:13,840 - app.integrations.defender.repository - INFO - Inserted batch 113 (2000 records)
2025-11-21 17:03:14,076 - app.integrations.defender.repository - INFO - Inserted batch 114 (2000 records)
2025-11-21 17:03:14,280 - app.integrations.defender.repository - INFO - Inserted batch 115 (2000 records)
2025-11-21 17:03:14,664 - app.integrations.defender.repository - INFO - Inserted batch 116 (2000 records)
2025-11-21 17:03:14,672 - app.integrations.defender.repository - INFO - Inserted batch 117 (9 records)
2025-11-21 17:03:14,975 - app.integrations.defender.repository - INFO - Successfully inserted 232009 records into temporary table
2025-11-21 17:03:14,976 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-11-21 17:03:14,987 - app.integrations.defender.repository - INFO - vulnerabilities table doesn't exist, skipping rename
2025-11-21 17:03:14,988 - app.integrations.defender.repository - ERROR - Error saving vulnerability data: Unread result found
Traceback (most recent call last):
  File "/Users/k3zy/Desktop/VulnManagement/app/integrations/defender/repository.py", line 242, in save_vulnerabilities
    cursor.execute(f"RENAME TABLE {temp_table_name} TO {TABLE_VULNERABILITIES}")
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/cursor.py", line 582, in execute
    self._connection.handle_unread_result()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 1523, in handle_unread_result
    raise InternalError("Unread result found")
mysql.connector.errors.InternalError: Unread result found
2025-11-21 17:03:15,052 - app.integrations.defender.repository - INFO - Cleaned up temporary table vulnerabilities_temp
2025-11-21 17:03:15,052 - app.integrations.defender.sync - ERROR - Error syncing device vulnerability details: Unread result found
2025-11-21 17:03:15,052 - app.integrations.defender.sync - ERROR - Error during full sync: Unread result found
2025-11-21 17:03:15,052 - app.integrations.defender.sync - ERROR - Error occurred during sync: Unread result found
2025-11-21 17:03:15,321 - app.integrations.defender.sync - INFO - Database connection closed
2025-11-21 17:03:15,321 - app.integrations.defender.sync - INFO - Vulnerability data sync completed
2025-11-21 17:08:58,577 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-11-21 17:08:58,608 - mysql.connector - INFO - package: mysql.connector.plugins
2025-11-21 17:08:58,608 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-11-21 17:08:58,608 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-11-21 17:08:58,611 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-11-21 17:08:58,613 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-11-21 17:08:58,613 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-11-21 17:08:58,613 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-11-21 17:08:58,613 - app.integrations.defender.database - INFO - Removing data_source column from sync_state table...
2025-11-21 17:08:58,614 - app.integrations.defender.database - WARNING - Error removing data_source column: Unread result found
2025-11-21 17:08:58,633 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-11-21 17:08:58,633 - app.integrations.defender.sync - INFO - Starting full sync...
2025-11-21 17:08:58,633 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-11-21 17:08:59,274 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-11-21 17:08:59,274 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-11-21 17:09:05,055 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:09:05,056 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMTAyN30=
2025-11-21 17:09:11,090 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:09:11,093 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODk1MX0=
2025-11-21 17:09:17,270 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:09:17,271 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4ODk1MX0=
2025-11-21 17:09:23,619 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:09:23,620 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjgsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODk1MX0=
2025-11-21 17:09:27,519 - app.integrations.defender.api_client - INFO - Fetched 32009 records
2025-11-21 17:09:27,519 - app.integrations.defender.api_client - INFO - Total fetched 232009 records
2025-11-21 17:09:27,520 - app.integrations.defender.service - INFO - Successfully fetched 232009 vulnerability records
2025-11-21 17:09:27,524 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-11-21 17:09:27,639 - app.integrations.defender.repository - INFO - Preparing 232009 records for batch insert...
2025-11-21 17:09:30,908 - app.integrations.defender.repository - INFO - Inserting 232009 records in batches of 2000...
2025-11-21 17:09:31,288 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-11-21 17:09:31,497 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-11-21 17:09:31,679 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-11-21 17:09:31,994 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-11-21 17:09:32,220 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-11-21 17:09:32,410 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-11-21 17:09:32,586 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-11-21 17:09:32,752 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-11-21 17:09:33,122 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-11-21 17:09:33,309 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-11-21 17:09:33,476 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-11-21 17:09:33,648 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-11-21 17:09:33,824 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-11-21 17:09:34,010 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-11-21 17:09:34,306 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-11-21 17:09:34,528 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-11-21 17:09:34,745 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-11-21 17:09:35,017 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-11-21 17:09:35,256 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-11-21 17:09:35,469 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-11-21 17:09:35,674 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-11-21 17:09:35,884 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-11-21 17:09:36,074 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-11-21 17:09:36,255 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-11-21 17:09:36,435 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-11-21 17:09:36,605 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-11-21 17:09:36,780 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-11-21 17:09:36,956 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-11-21 17:09:37,207 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-11-21 17:09:37,389 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-11-21 17:09:37,567 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-11-21 17:09:37,744 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-11-21 17:09:38,057 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-11-21 17:09:38,251 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-11-21 17:09:38,434 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-11-21 17:09:38,622 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-11-21 17:09:38,840 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-11-21 17:09:39,081 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-11-21 17:09:39,269 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-11-21 17:09:39,436 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-11-21 17:09:39,620 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-11-21 17:09:39,786 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-11-21 17:09:40,060 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-11-21 17:09:40,285 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-11-21 17:09:40,462 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-11-21 17:09:40,645 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-11-21 17:09:40,822 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-11-21 17:09:41,099 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-11-21 17:09:41,327 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-11-21 17:09:41,510 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-11-21 17:09:41,688 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-11-21 17:09:41,868 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-11-21 17:09:42,106 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-11-21 17:09:42,299 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-11-21 17:09:42,475 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-11-21 17:09:42,636 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-11-21 17:09:42,814 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-11-21 17:09:43,025 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-11-21 17:09:43,208 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-11-21 17:09:43,380 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-11-21 17:09:43,567 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-11-21 17:09:43,731 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-11-21 17:09:43,980 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-11-21 17:09:44,201 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-11-21 17:09:44,391 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-11-21 17:09:44,576 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-11-21 17:09:44,754 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-11-21 17:09:44,962 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-11-21 17:09:45,198 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-11-21 17:09:45,397 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-11-21 17:09:45,567 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-11-21 17:09:45,755 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-11-21 17:09:46,071 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-11-21 17:09:46,259 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-11-21 17:09:46,450 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-11-21 17:09:46,627 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-11-21 17:09:46,825 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-11-21 17:09:47,081 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-11-21 17:09:47,258 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-11-21 17:09:47,567 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-11-21 17:09:47,744 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-11-21 17:09:47,957 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-11-21 17:09:48,169 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-11-21 17:09:48,365 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-11-21 17:09:48,552 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-11-21 17:09:48,746 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-11-21 17:09:48,964 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-11-21 17:09:49,251 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-11-21 17:09:49,464 - app.integrations.defender.repository - INFO - Inserted batch 89 (2000 records)
2025-11-21 17:09:49,645 - app.integrations.defender.repository - INFO - Inserted batch 90 (2000 records)
2025-11-21 17:09:49,838 - app.integrations.defender.repository - INFO - Inserted batch 91 (2000 records)
2025-11-21 17:09:50,184 - app.integrations.defender.repository - INFO - Inserted batch 92 (2000 records)
2025-11-21 17:09:50,397 - app.integrations.defender.repository - INFO - Inserted batch 93 (2000 records)
2025-11-21 17:09:50,580 - app.integrations.defender.repository - INFO - Inserted batch 94 (2000 records)
2025-11-21 17:09:50,764 - app.integrations.defender.repository - INFO - Inserted batch 95 (2000 records)
2025-11-21 17:09:51,056 - app.integrations.defender.repository - INFO - Inserted batch 96 (2000 records)
2025-11-21 17:09:51,273 - app.integrations.defender.repository - INFO - Inserted batch 97 (2000 records)
2025-11-21 17:09:51,475 - app.integrations.defender.repository - INFO - Inserted batch 98 (2000 records)
2025-11-21 17:09:51,667 - app.integrations.defender.repository - INFO - Inserted batch 99 (2000 records)
2025-11-21 17:09:51,861 - app.integrations.defender.repository - INFO - Inserted batch 100 (2000 records)
2025-11-21 17:09:52,081 - app.integrations.defender.repository - INFO - Inserted batch 101 (2000 records)
2025-11-21 17:09:52,302 - app.integrations.defender.repository - INFO - Inserted batch 102 (2000 records)
2025-11-21 17:09:52,525 - app.integrations.defender.repository - INFO - Inserted batch 103 (2000 records)
2025-11-21 17:09:52,704 - app.integrations.defender.repository - INFO - Inserted batch 104 (2000 records)
2025-11-21 17:09:53,023 - app.integrations.defender.repository - INFO - Inserted batch 105 (2000 records)
2025-11-21 17:09:53,240 - app.integrations.defender.repository - INFO - Inserted batch 106 (2000 records)
2025-11-21 17:09:53,463 - app.integrations.defender.repository - INFO - Inserted batch 107 (2000 records)
2025-11-21 17:09:53,647 - app.integrations.defender.repository - INFO - Inserted batch 108 (2000 records)
2025-11-21 17:09:53,840 - app.integrations.defender.repository - INFO - Inserted batch 109 (2000 records)
2025-11-21 17:09:54,047 - app.integrations.defender.repository - INFO - Inserted batch 110 (2000 records)
2025-11-21 17:09:54,246 - app.integrations.defender.repository - INFO - Inserted batch 111 (2000 records)
2025-11-21 17:09:54,416 - app.integrations.defender.repository - INFO - Inserted batch 112 (2000 records)
2025-11-21 17:09:54,590 - app.integrations.defender.repository - INFO - Inserted batch 113 (2000 records)
2025-11-21 17:09:54,775 - app.integrations.defender.repository - INFO - Inserted batch 114 (2000 records)
2025-11-21 17:09:55,024 - app.integrations.defender.repository - INFO - Inserted batch 115 (2000 records)
2025-11-21 17:09:55,302 - app.integrations.defender.repository - INFO - Inserted batch 116 (2000 records)
2025-11-21 17:09:55,307 - app.integrations.defender.repository - INFO - Inserted batch 117 (9 records)
2025-11-21 17:09:55,551 - app.integrations.defender.repository - INFO - Successfully inserted 232009 records into temporary table
2025-11-21 17:09:55,552 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-11-21 17:09:55,566 - app.integrations.defender.repository - INFO - vulnerabilities table doesn't exist, skipping rename
2025-11-21 17:09:55,566 - app.integrations.defender.repository - ERROR - Error saving vulnerability data: Unread result found
Traceback (most recent call last):
  File "/Users/k3zy/Desktop/VulnManagement/app/integrations/defender/repository.py", line 242, in save_vulnerabilities
    cursor.execute(f"RENAME TABLE {temp_table_name} TO {TABLE_VULNERABILITIES}")
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/cursor.py", line 582, in execute
    self._connection.handle_unread_result()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 1523, in handle_unread_result
    raise InternalError("Unread result found")
mysql.connector.errors.InternalError: Unread result found
2025-11-21 17:09:55,616 - app.integrations.defender.repository - INFO - Cleaned up temporary table vulnerabilities_temp
2025-11-21 17:09:55,617 - app.integrations.defender.sync - ERROR - Error syncing device vulnerability details: Unread result found
2025-11-21 17:09:55,617 - app.integrations.defender.sync - ERROR - Error during full sync: Unread result found
2025-11-21 17:09:55,617 - app.integrations.defender.sync - ERROR - Error occurred during sync: Unread result found
2025-11-21 17:09:55,915 - app.integrations.defender.sync - INFO - Database connection closed
2025-11-21 17:09:55,915 - app.integrations.defender.sync - INFO - Vulnerability data sync completed
2025-11-21 17:19:30,216 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-11-21 17:19:30,251 - mysql.connector - INFO - package: mysql.connector.plugins
2025-11-21 17:19:30,251 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-11-21 17:19:30,251 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-11-21 17:19:30,254 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-11-21 17:19:30,275 - app.integrations.defender.database - INFO - sync_state table doesn't exist, will be created
2025-11-21 17:19:30,518 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-11-21 17:19:30,518 - app.integrations.defender.sync - INFO - Starting full sync...
2025-11-21 17:19:30,518 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-11-21 17:19:31,217 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-11-21 17:19:31,217 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-11-21 17:19:37,165 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:19:37,166 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMTAyN30=
2025-11-21 17:19:42,181 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:19:42,181 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODk1MX0=
2025-11-21 17:19:48,128 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:19:48,129 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4ODk1MX0=
2025-11-21 17:19:54,189 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:19:54,190 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wNDI3LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjgsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODk1MX0=
2025-11-21 17:19:58,068 - app.integrations.defender.api_client - INFO - Fetched 32009 records
2025-11-21 17:19:58,068 - app.integrations.defender.api_client - INFO - Total fetched 232009 records
2025-11-21 17:19:58,069 - app.integrations.defender.service - INFO - Successfully fetched 232009 vulnerability records
2025-11-21 17:19:58,071 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-11-21 17:19:58,137 - app.integrations.defender.repository - INFO - Preparing 232009 records for batch insert...
2025-11-21 17:20:01,203 - app.integrations.defender.repository - INFO - Inserting 232009 records in batches of 2000...
2025-11-21 17:20:01,582 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-11-21 17:20:01,839 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-11-21 17:20:02,034 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-11-21 17:20:02,195 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-11-21 17:20:02,371 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-11-21 17:20:02,542 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-11-21 17:20:02,713 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-11-21 17:20:03,073 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-11-21 17:20:03,256 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-11-21 17:20:03,426 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-11-21 17:20:03,593 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-11-21 17:20:03,761 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-11-21 17:20:04,026 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-11-21 17:20:04,351 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-11-21 17:20:04,544 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-11-21 17:20:04,725 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-11-21 17:20:04,974 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-11-21 17:20:05,164 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-11-21 17:20:05,340 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-11-21 17:20:05,518 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-11-21 17:20:05,705 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-11-21 17:20:05,985 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-11-21 17:20:06,158 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-11-21 17:20:06,330 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-11-21 17:20:06,504 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-11-21 17:20:06,676 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-11-21 17:20:06,854 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-11-21 17:20:07,087 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-11-21 17:20:07,252 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-11-21 17:20:07,436 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-11-21 17:20:07,607 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-11-21 17:20:07,794 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-11-21 17:20:08,042 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-11-21 17:20:08,210 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-11-21 17:20:08,387 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-11-21 17:20:08,564 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-11-21 17:20:08,750 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-11-21 17:20:08,997 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-11-21 17:20:09,220 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-11-21 17:20:09,381 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-11-21 17:20:09,575 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-11-21 17:20:09,737 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-11-21 17:20:09,993 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-11-21 17:20:10,170 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-11-21 17:20:10,337 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-11-21 17:20:10,513 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-11-21 17:20:10,720 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-11-21 17:20:10,988 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-11-21 17:20:11,319 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-11-21 17:20:11,547 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-11-21 17:20:11,731 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-11-21 17:20:11,969 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-11-21 17:20:12,134 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-11-21 17:20:12,307 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-11-21 17:20:12,513 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-11-21 17:20:12,679 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-11-21 17:20:12,866 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-11-21 17:20:13,057 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-11-21 17:20:13,242 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-11-21 17:20:13,453 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-11-21 17:20:13,705 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-11-21 17:20:14,013 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-11-21 17:20:14,264 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-11-21 17:20:14,450 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-11-21 17:20:14,636 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-11-21 17:20:14,854 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-11-21 17:20:15,088 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-11-21 17:20:15,278 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-11-21 17:20:15,458 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-11-21 17:20:15,660 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-11-21 17:20:15,845 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-11-21 17:20:16,117 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-11-21 17:20:16,316 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-11-21 17:20:16,492 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-11-21 17:20:16,685 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-11-21 17:20:16,963 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-11-21 17:20:17,170 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-11-21 17:20:17,356 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-11-21 17:20:17,534 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-11-21 17:20:17,716 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-11-21 17:20:17,962 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-11-21 17:20:18,288 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-11-21 17:20:18,490 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-11-21 17:20:18,668 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-11-21 17:20:18,853 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-11-21 17:20:19,099 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-11-21 17:20:19,326 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-11-21 17:20:19,536 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-11-21 17:20:19,771 - app.integrations.defender.repository - INFO - Inserted batch 89 (2000 records)
2025-11-21 17:20:20,091 - app.integrations.defender.repository - INFO - Inserted batch 90 (2000 records)
2025-11-21 17:20:20,317 - app.integrations.defender.repository - INFO - Inserted batch 91 (2000 records)
2025-11-21 17:20:20,537 - app.integrations.defender.repository - INFO - Inserted batch 92 (2000 records)
2025-11-21 17:20:20,736 - app.integrations.defender.repository - INFO - Inserted batch 93 (2000 records)
2025-11-21 17:20:21,056 - app.integrations.defender.repository - INFO - Inserted batch 94 (2000 records)
2025-11-21 17:20:21,265 - app.integrations.defender.repository - INFO - Inserted batch 95 (2000 records)
2025-11-21 17:20:21,454 - app.integrations.defender.repository - INFO - Inserted batch 96 (2000 records)
2025-11-21 17:20:21,639 - app.integrations.defender.repository - INFO - Inserted batch 97 (2000 records)
2025-11-21 17:20:21,844 - app.integrations.defender.repository - INFO - Inserted batch 98 (2000 records)
2025-11-21 17:20:22,121 - app.integrations.defender.repository - INFO - Inserted batch 99 (2000 records)
2025-11-21 17:20:22,401 - app.integrations.defender.repository - INFO - Inserted batch 100 (2000 records)
2025-11-21 17:20:22,612 - app.integrations.defender.repository - INFO - Inserted batch 101 (2000 records)
2025-11-21 17:20:22,807 - app.integrations.defender.repository - INFO - Inserted batch 102 (2000 records)
2025-11-21 17:20:23,175 - app.integrations.defender.repository - INFO - Inserted batch 103 (2000 records)
2025-11-21 17:20:24,058 - app.integrations.defender.repository - INFO - Inserted batch 104 (2000 records)
2025-11-21 17:20:24,353 - app.integrations.defender.repository - INFO - Inserted batch 105 (2000 records)
2025-11-21 17:20:24,573 - app.integrations.defender.repository - INFO - Inserted batch 106 (2000 records)
2025-11-21 17:20:24,795 - app.integrations.defender.repository - INFO - Inserted batch 107 (2000 records)
2025-11-21 17:20:25,103 - app.integrations.defender.repository - INFO - Inserted batch 108 (2000 records)
2025-11-21 17:20:25,307 - app.integrations.defender.repository - INFO - Inserted batch 109 (2000 records)
2025-11-21 17:20:25,506 - app.integrations.defender.repository - INFO - Inserted batch 110 (2000 records)
2025-11-21 17:20:25,703 - app.integrations.defender.repository - INFO - Inserted batch 111 (2000 records)
2025-11-21 17:20:25,909 - app.integrations.defender.repository - INFO - Inserted batch 112 (2000 records)
2025-11-21 17:20:26,185 - app.integrations.defender.repository - INFO - Inserted batch 113 (2000 records)
2025-11-21 17:20:26,423 - app.integrations.defender.repository - INFO - Inserted batch 114 (2000 records)
2025-11-21 17:20:26,631 - app.integrations.defender.repository - INFO - Inserted batch 115 (2000 records)
2025-11-21 17:20:27,050 - app.integrations.defender.repository - INFO - Inserted batch 116 (2000 records)
2025-11-21 17:20:27,055 - app.integrations.defender.repository - INFO - Inserted batch 117 (9 records)
2025-11-21 17:20:27,326 - app.integrations.defender.repository - INFO - Successfully inserted 232009 records into temporary table
2025-11-21 17:20:27,326 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-11-21 17:20:27,331 - app.integrations.defender.repository - INFO - vulnerabilities table doesn't exist, skipping rename
2025-11-21 17:20:27,331 - app.integrations.defender.repository - ERROR - Error saving vulnerability data: Unread result found
Traceback (most recent call last):
  File "/Users/k3zy/Desktop/VulnManagement/app/integrations/defender/repository.py", line 242, in save_vulnerabilities
    cursor.execute(f"RENAME TABLE {temp_table_name} TO {TABLE_VULNERABILITIES}")
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/cursor.py", line 582, in execute
    self._connection.handle_unread_result()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 1523, in handle_unread_result
    raise InternalError("Unread result found")
mysql.connector.errors.InternalError: Unread result found
2025-11-21 17:20:27,390 - app.integrations.defender.repository - INFO - Cleaned up temporary table vulnerabilities_temp
2025-11-21 17:20:27,392 - app.integrations.defender.sync - ERROR - Error syncing device vulnerability details: Unread result found
2025-11-21 17:20:27,392 - app.integrations.defender.sync - ERROR - Error during full sync: Unread result found
2025-11-21 17:20:27,392 - app.integrations.defender.sync - ERROR - Error occurred during sync: Unread result found
2025-11-21 17:20:27,710 - app.integrations.defender.sync - INFO - Database connection closed
2025-11-21 17:20:27,710 - app.integrations.defender.sync - INFO - Vulnerability data sync completed
2025-11-21 17:34:08,662 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-11-21 17:34:08,696 - mysql.connector - INFO - package: mysql.connector.plugins
2025-11-21 17:34:08,696 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-11-21 17:34:08,696 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-11-21 17:34:08,699 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-11-21 17:34:08,700 - app.integrations.defender.sync - INFO - Initializing database...
2025-11-21 17:34:08,735 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-11-21 17:34:08,735 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-11-21 17:34:08,735 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-11-21 17:34:08,758 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-11-21 17:34:08,857 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-11-21 17:34:08,857 - app.integrations.defender.sync - INFO - Database initialization completed
2025-11-21 17:34:08,858 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-11-21 17:34:08,858 - app.integrations.defender.sync - INFO - Starting full sync...
2025-11-21 17:34:08,858 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-11-21 17:34:08,858 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-11-21 17:34:09,422 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-11-21 17:34:09,422 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-11-21 17:34:15,182 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:34:15,183 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMDg0M30=
2025-11-21 17:34:20,851 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:34:20,851 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODc2NX0=
2025-11-21 17:34:26,670 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:34:26,671 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4ODc2NX0=
2025-11-21 17:34:32,889 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:34:32,889 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjgsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODc2NX0=
2025-11-21 17:34:36,773 - app.integrations.defender.api_client - INFO - Fetched 30444 records
2025-11-21 17:34:36,773 - app.integrations.defender.api_client - INFO - Total fetched 230444 records
2025-11-21 17:34:36,773 - app.integrations.defender.service - INFO - Successfully fetched 230444 vulnerability records
2025-11-21 17:34:36,773 - app.integrations.defender.sync - INFO - API returned 230444 vulnerability records
2025-11-21 17:34:36,773 - app.integrations.defender.sync - INFO - Saving 230444 vulnerability records to database...
2025-11-21 17:34:36,773 - app.integrations.defender.repository - INFO - Starting to save 230444 vulnerability records...
2025-11-21 17:34:36,780 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-11-21 17:34:36,783 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-11-21 17:34:36,783 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-11-21 17:34:36,783 - app.integrations.defender.repository - ERROR - Failed to create temporary table using LIKE: Unread result found
2025-11-21 17:34:36,783 - app.integrations.defender.repository - INFO - Attempting to create temporary table with explicit structure...
2025-11-21 17:34:36,783 - app.integrations.defender.repository - ERROR - Error saving vulnerability data: Unread result found
Traceback (most recent call last):
  File "/Users/k3zy/Desktop/VulnManagement/app/integrations/defender/repository.py", line 169, in save_vulnerabilities
    cursor.execute(create_temp_table_query)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/cursor.py", line 582, in execute
    self._connection.handle_unread_result()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 1523, in handle_unread_result
    raise InternalError("Unread result found")
mysql.connector.errors.InternalError: Unread result found

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/k3zy/Desktop/VulnManagement/app/integrations/defender/repository.py", line 212, in save_vulnerabilities
    cursor.execute(create_temp_table_query)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/cursor.py", line 582, in execute
    self._connection.handle_unread_result()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 1523, in handle_unread_result
    raise InternalError("Unread result found")
mysql.connector.errors.InternalError: Unread result found
2025-11-21 17:34:36,808 - app.integrations.defender.repository - INFO - Cleaned up temporary table vulnerabilities_temp
2025-11-21 17:34:36,808 - app.integrations.defender.sync - ERROR - Error syncing device vulnerability details: Unread result found
Traceback (most recent call last):
  File "/Users/k3zy/Desktop/VulnManagement/app/integrations/defender/repository.py", line 169, in save_vulnerabilities
    cursor.execute(create_temp_table_query)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/cursor.py", line 582, in execute
    self._connection.handle_unread_result()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 1523, in handle_unread_result
    raise InternalError("Unread result found")
mysql.connector.errors.InternalError: Unread result found

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/k3zy/Desktop/VulnManagement/app/integrations/defender/sync.py", line 38, in sync_device_vulnerabilities_full
    save_vulnerabilities(connection, vulnerabilities, is_delta=False)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/app/integrations/defender/repository.py", line 212, in save_vulnerabilities
    cursor.execute(create_temp_table_query)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/cursor.py", line 582, in execute
    self._connection.handle_unread_result()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 1523, in handle_unread_result
    raise InternalError("Unread result found")
mysql.connector.errors.InternalError: Unread result found
2025-11-21 17:34:36,809 - app.integrations.defender.sync - ERROR - Error during full sync: Unread result found
2025-11-21 17:34:36,809 - app.integrations.defender.sync - ERROR - CRITICAL ERROR occurred during sync: Unread result found
Traceback (most recent call last):
  File "/Users/k3zy/Desktop/VulnManagement/app/integrations/defender/repository.py", line 169, in save_vulnerabilities
    cursor.execute(create_temp_table_query)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/cursor.py", line 582, in execute
    self._connection.handle_unread_result()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 1523, in handle_unread_result
    raise InternalError("Unread result found")
mysql.connector.errors.InternalError: Unread result found

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/k3zy/Desktop/VulnManagement/app/integrations/defender/sync.py", line 111, in main
    perform_full_sync(connection, None)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/app/integrations/defender/sync.py", line 82, in perform_full_sync
    sync_device_vulnerabilities_full(connection, access_token)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/app/integrations/defender/sync.py", line 38, in sync_device_vulnerabilities_full
    save_vulnerabilities(connection, vulnerabilities, is_delta=False)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/app/integrations/defender/repository.py", line 212, in save_vulnerabilities
    cursor.execute(create_temp_table_query)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/cursor.py", line 582, in execute
    self._connection.handle_unread_result()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 1523, in handle_unread_result
    raise InternalError("Unread result found")
mysql.connector.errors.InternalError: Unread result found
2025-11-21 17:34:36,810 - app.integrations.defender.sync - INFO - Database connection closed
2025-11-21 17:38:27,344 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-11-21 17:38:27,378 - mysql.connector - INFO - package: mysql.connector.plugins
2025-11-21 17:38:27,378 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-11-21 17:38:27,378 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-11-21 17:38:27,381 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-11-21 17:38:27,381 - app.integrations.defender.sync - INFO - Initializing database...
2025-11-21 17:38:27,383 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-11-21 17:38:27,383 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-11-21 17:38:27,383 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-11-21 17:38:27,384 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-11-21 17:38:27,413 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-11-21 17:38:27,413 - app.integrations.defender.sync - INFO - Database initialization completed
2025-11-21 17:38:27,413 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-11-21 17:38:27,413 - app.integrations.defender.sync - INFO - Starting full sync...
2025-11-21 17:38:27,413 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-11-21 17:38:27,413 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-11-21 17:38:28,148 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-11-21 17:38:28,148 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-11-21 17:38:33,859 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:38:33,860 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMDg0M30=
2025-11-21 17:38:39,662 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:38:39,662 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODc2NX0=
2025-11-21 17:38:45,535 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:38:45,535 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4ODc2NX0=
2025-11-21 17:38:51,295 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:38:51,295 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjgsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODc2NX0=
2025-11-21 17:38:55,505 - app.integrations.defender.api_client - INFO - Fetched 30444 records
2025-11-21 17:38:55,505 - app.integrations.defender.api_client - INFO - Total fetched 230444 records
2025-11-21 17:38:55,505 - app.integrations.defender.service - INFO - Successfully fetched 230444 vulnerability records
2025-11-21 17:38:55,505 - app.integrations.defender.sync - INFO - API returned 230444 vulnerability records
2025-11-21 17:38:55,505 - app.integrations.defender.sync - INFO - Saving 230444 vulnerability records to database...
2025-11-21 17:38:55,506 - app.integrations.defender.repository - INFO - Starting to save 230444 vulnerability records...
2025-11-21 17:38:55,511 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-11-21 17:38:55,515 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-11-21 17:38:55,515 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-11-21 17:38:55,708 - app.integrations.defender.repository - INFO - Temporary table vulnerabilities_temp created successfully
2025-11-21 17:38:55,709 - app.integrations.defender.repository - INFO - Validating and preparing 230444 records for batch insert...
2025-11-21 17:38:55,776 - app.integrations.defender.repository - INFO - Validated 230444 out of 230444 records
2025-11-21 17:38:59,496 - app.integrations.defender.repository - INFO - Inserting 230444 records in batches of 2000...
2025-11-21 17:39:00,026 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-11-21 17:39:00,281 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-11-21 17:39:00,486 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-11-21 17:39:00,677 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-11-21 17:39:00,869 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-11-21 17:39:01,046 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-11-21 17:39:01,281 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-11-21 17:39:01,470 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-11-21 17:39:01,642 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-11-21 17:39:01,804 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-11-21 17:39:01,974 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-11-21 17:39:02,145 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-11-21 17:39:02,369 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-11-21 17:39:02,550 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-11-21 17:39:02,731 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-11-21 17:39:02,926 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-11-21 17:39:03,099 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-11-21 17:39:03,402 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-11-21 17:39:03,601 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-11-21 17:39:03,780 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-11-21 17:39:03,962 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-11-21 17:39:04,148 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-11-21 17:39:04,350 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-11-21 17:39:04,508 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-11-21 17:39:04,682 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-11-21 17:39:04,854 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-11-21 17:39:05,016 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-11-21 17:39:05,208 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-11-21 17:39:05,497 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-11-21 17:39:05,700 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-11-21 17:39:05,887 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-11-21 17:39:06,074 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-11-21 17:39:06,342 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-11-21 17:39:06,535 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-11-21 17:39:06,744 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-11-21 17:39:06,926 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-11-21 17:39:07,100 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-11-21 17:39:07,978 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-11-21 17:39:08,294 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-11-21 17:39:08,528 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-11-21 17:39:08,798 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-11-21 17:39:09,015 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-11-21 17:39:10,120 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-11-21 17:39:10,409 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-11-21 17:39:10,641 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-11-21 17:39:10,889 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-11-21 17:39:11,123 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-11-21 17:39:12,905 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-11-21 17:39:13,330 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-11-21 17:39:13,545 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-11-21 17:39:13,724 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-11-21 17:39:13,905 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-11-21 17:39:14,087 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-11-21 17:39:14,288 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-11-21 17:39:14,484 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-11-21 17:39:14,668 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-11-21 17:39:14,868 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-11-21 17:39:15,047 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-11-21 17:39:15,252 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-11-21 17:39:15,499 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-11-21 17:39:15,681 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-11-21 17:39:15,863 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-11-21 17:39:16,079 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-11-21 17:39:16,313 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-11-21 17:39:16,642 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-11-21 17:39:16,828 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-11-21 17:39:17,010 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-11-21 17:39:17,200 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-11-21 17:39:17,491 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-11-21 17:39:17,680 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-11-21 17:39:17,864 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-11-21 17:39:18,053 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-11-21 17:39:18,229 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-11-21 17:39:18,533 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-11-21 17:39:18,727 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-11-21 17:39:18,922 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-11-21 17:39:19,100 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-11-21 17:39:19,364 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-11-21 17:39:19,563 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-11-21 17:39:19,759 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-11-21 17:39:19,949 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-11-21 17:39:20,167 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-11-21 17:39:20,436 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-11-21 17:39:20,659 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-11-21 17:39:20,847 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-11-21 17:39:21,057 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-11-21 17:39:21,395 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-11-21 17:39:21,598 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-11-21 17:39:21,785 - app.integrations.defender.repository - INFO - Inserted batch 89 (2000 records)
2025-11-21 17:39:21,967 - app.integrations.defender.repository - INFO - Inserted batch 90 (2000 records)
2025-11-21 17:39:22,159 - app.integrations.defender.repository - INFO - Inserted batch 91 (2000 records)
2025-11-21 17:39:22,533 - app.integrations.defender.repository - INFO - Inserted batch 92 (2000 records)
2025-11-21 17:39:22,832 - app.integrations.defender.repository - INFO - Inserted batch 93 (2000 records)
2025-11-21 17:39:23,060 - app.integrations.defender.repository - INFO - Inserted batch 94 (2000 records)
2025-11-21 17:39:23,431 - app.integrations.defender.repository - INFO - Inserted batch 95 (2000 records)
2025-11-21 17:39:24,395 - app.integrations.defender.repository - INFO - Inserted batch 96 (2000 records)
2025-11-21 17:39:24,641 - app.integrations.defender.repository - INFO - Inserted batch 97 (2000 records)
2025-11-21 17:39:24,925 - app.integrations.defender.repository - INFO - Inserted batch 98 (2000 records)
2025-11-21 17:39:25,142 - app.integrations.defender.repository - INFO - Inserted batch 99 (2000 records)
2025-11-21 17:39:25,450 - app.integrations.defender.repository - INFO - Inserted batch 100 (2000 records)
2025-11-21 17:39:25,675 - app.integrations.defender.repository - INFO - Inserted batch 101 (2000 records)
2025-11-21 17:39:25,888 - app.integrations.defender.repository - INFO - Inserted batch 102 (2000 records)
2025-11-21 17:39:26,091 - app.integrations.defender.repository - INFO - Inserted batch 103 (2000 records)
2025-11-21 17:39:26,352 - app.integrations.defender.repository - INFO - Inserted batch 104 (2000 records)
2025-11-21 17:39:26,600 - app.integrations.defender.repository - INFO - Inserted batch 105 (2000 records)
2025-11-21 17:39:26,839 - app.integrations.defender.repository - INFO - Inserted batch 106 (2000 records)
2025-11-21 17:39:27,030 - app.integrations.defender.repository - INFO - Inserted batch 107 (2000 records)
2025-11-21 17:39:27,267 - app.integrations.defender.repository - INFO - Inserted batch 108 (2000 records)
2025-11-21 17:39:27,558 - app.integrations.defender.repository - INFO - Inserted batch 109 (2000 records)
2025-11-21 17:39:27,777 - app.integrations.defender.repository - INFO - Inserted batch 110 (2000 records)
2025-11-21 17:39:27,957 - app.integrations.defender.repository - INFO - Inserted batch 111 (2000 records)
2025-11-21 17:39:28,144 - app.integrations.defender.repository - INFO - Inserted batch 112 (2000 records)
2025-11-21 17:39:28,343 - app.integrations.defender.repository - INFO - Inserted batch 113 (2000 records)
2025-11-21 17:39:28,678 - app.integrations.defender.repository - INFO - Inserted batch 114 (2000 records)
2025-11-21 17:39:29,001 - app.integrations.defender.repository - INFO - Inserted batch 115 (2000 records)
2025-11-21 17:39:29,056 - app.integrations.defender.repository - INFO - Inserted batch 116 (444 records)
2025-11-21 17:39:29,393 - app.integrations.defender.repository - INFO - Successfully inserted 230444 records into temporary table
2025-11-21 17:39:29,394 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-11-21 17:39:29,545 - app.integrations.defender.repository - INFO - Renamed vulnerabilities to vulnerabilities_old
2025-11-21 17:39:29,579 - app.integrations.defender.repository - INFO - Renamed vulnerabilities_temp to vulnerabilities
2025-11-21 17:39:29,606 - app.integrations.defender.repository - INFO - Dropped old table vulnerabilities_old
2025-11-21 17:39:29,606 - app.integrations.defender.repository - INFO - Verifying data was saved correctly...
2025-11-21 17:39:29,729 - app.integrations.defender.repository - INFO - Verification: 230444 records found in vulnerabilities table
2025-11-21 17:39:29,729 - app.integrations.defender.repository - INFO - Data verification successful: 230444 records match expected count
2025-11-21 17:39:29,729 - app.integrations.defender.repository - INFO - Successfully saved 230444 vulnerability records using table switching method
2025-11-21 17:39:29,943 - app.integrations.defender.sync - INFO - Database verification: 230444 records in database after save
2025-11-21 17:39:29,943 - app.integrations.defender.sync - INFO - Device vulnerability details full sync completed, fetched 230444 records, saved 230444 records
2025-11-21 17:39:29,955 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-11-21 17:39:29.943368, type: full, records: 230444
2025-11-21 17:39:29,956 - app.integrations.defender.sync - INFO - Sync time recorded: 2025-11-21 17:39:29.943368, records: 230444
2025-11-21 17:39:30,085 - app.integrations.defender.sync - INFO - Creating snapshot after sync...
2025-11-21 17:39:32,292 - app.integrations.defender.repository - INFO - Recording CVE-Device combinations for snapshot...
2025-11-21 17:39:34,278 - app.integrations.defender.repository - ERROR - Database error recording snapshot: 1048 (23000): Column 'status' cannot be null
Traceback (most recent call last):
  File "/Users/k3zy/Desktop/VulnManagement/app/integrations/defender/repository.py", line 503, in record_snapshot
    cursor.executemany(cve_device_snapshot_query, batch)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/cursor.py", line 723, in executemany
    return self.execute(stmt)
           ~~~~~~~~~~~~^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/cursor.py", line 617, in execute
    self._handle_result(self._connection.cmd_query(stmt))
                        ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 77, in wrapper
    return method(cnx, *args, **kwargs)
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 843, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 620, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1048 (23000): Column 'status' cannot be null
2025-11-21 17:39:34,324 - app.integrations.defender.sync - INFO - Full sync completed successfully
2025-11-21 17:39:34,328 - app.integrations.defender.sync - INFO - Full sync process completed successfully
2025-11-21 17:39:34,330 - app.integrations.defender.sync - INFO - Database connection closed
2025-11-21 17:39:34,332 - app.integrations.defender.sync - INFO - Vulnerability data sync completed successfully
2025-11-21 17:42:05,497 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-11-21 17:42:05,531 - mysql.connector - INFO - package: mysql.connector.plugins
2025-11-21 17:42:05,531 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-11-21 17:42:05,531 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-11-21 17:42:05,535 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-11-21 17:42:05,535 - app.integrations.defender.sync - INFO - Initializing database...
2025-11-21 17:42:05,538 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-11-21 17:42:05,538 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-11-21 17:42:05,538 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-11-21 17:42:05,539 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-11-21 17:42:05,564 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-11-21 17:42:05,564 - app.integrations.defender.sync - INFO - Database initialization completed
2025-11-21 17:42:05,564 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-11-21 17:42:05,564 - app.integrations.defender.sync - INFO - Starting full sync...
2025-11-21 17:42:05,564 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-11-21 17:42:05,564 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-11-21 17:42:06,191 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-11-21 17:42:06,192 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-11-21 17:42:11,815 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:42:11,815 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMDg0M30=
2025-11-21 17:42:17,641 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:42:17,641 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODc2NX0=
2025-11-21 17:42:23,708 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:42:23,708 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4ODc2NX0=
2025-11-21 17:42:29,869 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:42:29,870 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjgsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODc2NX0=
2025-11-21 17:42:33,626 - app.integrations.defender.api_client - INFO - Fetched 30444 records
2025-11-21 17:42:33,626 - app.integrations.defender.api_client - INFO - Total fetched 230444 records
2025-11-21 17:42:33,627 - app.integrations.defender.service - INFO - Successfully fetched 230444 vulnerability records
2025-11-21 17:42:33,627 - app.integrations.defender.sync - INFO - API returned 230444 vulnerability records
2025-11-21 17:42:33,627 - app.integrations.defender.sync - INFO - Saving 230444 vulnerability records to database...
2025-11-21 17:42:33,627 - app.integrations.defender.repository - INFO - Starting to save 230444 vulnerability records...
2025-11-21 17:42:33,632 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-11-21 17:42:33,641 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-11-21 17:42:33,641 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-11-21 17:42:33,789 - app.integrations.defender.repository - INFO - Temporary table vulnerabilities_temp created successfully
2025-11-21 17:42:33,790 - app.integrations.defender.repository - INFO - Validating and preparing 230444 records for batch insert...
2025-11-21 17:42:33,844 - app.integrations.defender.repository - INFO - Validated 230444 out of 230444 records
2025-11-21 17:42:36,802 - app.integrations.defender.repository - INFO - Inserting 230444 records in batches of 2000...
2025-11-21 17:42:37,182 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-11-21 17:42:37,402 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-11-21 17:42:37,603 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-11-21 17:42:37,775 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-11-21 17:42:37,976 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-11-21 17:42:38,163 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-11-21 17:42:38,333 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-11-21 17:42:38,507 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-11-21 17:42:38,690 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-11-21 17:42:38,968 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-11-21 17:42:39,167 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-11-21 17:42:39,327 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-11-21 17:42:39,511 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-11-21 17:42:39,685 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-11-21 17:42:39,977 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-11-21 17:42:40,178 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-11-21 17:42:40,341 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-11-21 17:42:40,515 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-11-21 17:42:40,683 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-11-21 17:42:40,867 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-11-21 17:42:41,048 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-11-21 17:42:41,227 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-11-21 17:42:41,415 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-11-21 17:42:41,584 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-11-21 17:42:41,756 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-11-21 17:42:42,096 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-11-21 17:42:42,270 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-11-21 17:42:42,443 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-11-21 17:42:42,609 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-11-21 17:42:42,783 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-11-21 17:42:43,099 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-11-21 17:42:43,288 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-11-21 17:42:43,456 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-11-21 17:42:43,621 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-11-21 17:42:43,793 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-11-21 17:42:44,068 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-11-21 17:42:44,250 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-11-21 17:42:44,426 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-11-21 17:42:44,607 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-11-21 17:42:44,764 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-11-21 17:42:45,155 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-11-21 17:42:45,371 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-11-21 17:42:45,547 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-11-21 17:42:45,734 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-11-21 17:42:45,903 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-11-21 17:42:46,164 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-11-21 17:42:46,347 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-11-21 17:42:46,516 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-11-21 17:42:46,680 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-11-21 17:42:46,848 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-11-21 17:42:47,158 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-11-21 17:42:47,364 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-11-21 17:42:47,542 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-11-21 17:42:47,718 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-11-21 17:42:47,903 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-11-21 17:42:48,126 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-11-21 17:42:48,303 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-11-21 17:42:48,487 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-11-21 17:42:48,651 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-11-21 17:42:48,825 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-11-21 17:42:49,008 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-11-21 17:42:49,333 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-11-21 17:42:49,539 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-11-21 17:42:49,713 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-11-21 17:42:49,986 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-11-21 17:42:50,175 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-11-21 17:42:50,367 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-11-21 17:42:50,546 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-11-21 17:42:50,721 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-11-21 17:42:50,934 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-11-21 17:42:51,161 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-11-21 17:42:51,357 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-11-21 17:42:51,528 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-11-21 17:42:51,707 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-11-21 17:42:51,900 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-11-21 17:42:52,363 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-11-21 17:42:52,936 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-11-21 17:42:53,786 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-11-21 17:42:54,054 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-11-21 17:42:54,239 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-11-21 17:42:54,446 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-11-21 17:42:54,671 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-11-21 17:42:54,913 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-11-21 17:42:55,151 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-11-21 17:42:55,342 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-11-21 17:42:55,523 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-11-21 17:42:55,721 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-11-21 17:42:55,922 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-11-21 17:42:56,145 - app.integrations.defender.repository - INFO - Inserted batch 89 (2000 records)
2025-11-21 17:42:56,403 - app.integrations.defender.repository - INFO - Inserted batch 90 (2000 records)
2025-11-21 17:42:56,622 - app.integrations.defender.repository - INFO - Inserted batch 91 (2000 records)
2025-11-21 17:42:56,815 - app.integrations.defender.repository - INFO - Inserted batch 92 (2000 records)
2025-11-21 17:42:57,169 - app.integrations.defender.repository - INFO - Inserted batch 93 (2000 records)
2025-11-21 17:42:57,367 - app.integrations.defender.repository - INFO - Inserted batch 94 (2000 records)
2025-11-21 17:42:57,555 - app.integrations.defender.repository - INFO - Inserted batch 95 (2000 records)
2025-11-21 17:42:57,735 - app.integrations.defender.repository - INFO - Inserted batch 96 (2000 records)
2025-11-21 17:42:57,984 - app.integrations.defender.repository - INFO - Inserted batch 97 (2000 records)
2025-11-21 17:42:58,232 - app.integrations.defender.repository - INFO - Inserted batch 98 (2000 records)
2025-11-21 17:42:58,420 - app.integrations.defender.repository - INFO - Inserted batch 99 (2000 records)
2025-11-21 17:42:58,598 - app.integrations.defender.repository - INFO - Inserted batch 100 (2000 records)
2025-11-21 17:42:58,941 - app.integrations.defender.repository - INFO - Inserted batch 101 (2000 records)
2025-11-21 17:42:59,173 - app.integrations.defender.repository - INFO - Inserted batch 102 (2000 records)
2025-11-21 17:42:59,348 - app.integrations.defender.repository - INFO - Inserted batch 103 (2000 records)
2025-11-21 17:42:59,537 - app.integrations.defender.repository - INFO - Inserted batch 104 (2000 records)
2025-11-21 17:42:59,720 - app.integrations.defender.repository - INFO - Inserted batch 105 (2000 records)
2025-11-21 17:43:00,018 - app.integrations.defender.repository - INFO - Inserted batch 106 (2000 records)
2025-11-21 17:43:00,278 - app.integrations.defender.repository - INFO - Inserted batch 107 (2000 records)
2025-11-21 17:43:00,484 - app.integrations.defender.repository - INFO - Inserted batch 108 (2000 records)
2025-11-21 17:43:00,680 - app.integrations.defender.repository - INFO - Inserted batch 109 (2000 records)
2025-11-21 17:43:00,868 - app.integrations.defender.repository - INFO - Inserted batch 110 (2000 records)
2025-11-21 17:43:01,074 - app.integrations.defender.repository - INFO - Inserted batch 111 (2000 records)
2025-11-21 17:43:01,307 - app.integrations.defender.repository - INFO - Inserted batch 112 (2000 records)
2025-11-21 17:43:01,492 - app.integrations.defender.repository - INFO - Inserted batch 113 (2000 records)
2025-11-21 17:43:01,683 - app.integrations.defender.repository - INFO - Inserted batch 114 (2000 records)
2025-11-21 17:43:02,058 - app.integrations.defender.repository - INFO - Inserted batch 115 (2000 records)
2025-11-21 17:43:02,154 - app.integrations.defender.repository - INFO - Inserted batch 116 (444 records)
2025-11-21 17:43:02,485 - app.integrations.defender.repository - INFO - Successfully inserted 230444 records into temporary table
2025-11-21 17:43:02,486 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-11-21 17:43:02,543 - app.integrations.defender.repository - INFO - Renamed vulnerabilities to vulnerabilities_old
2025-11-21 17:43:02,557 - app.integrations.defender.repository - INFO - Renamed vulnerabilities_temp to vulnerabilities
2025-11-21 17:43:02,576 - app.integrations.defender.repository - INFO - Dropped old table vulnerabilities_old
2025-11-21 17:43:02,578 - app.integrations.defender.repository - INFO - Verifying data was saved correctly...
2025-11-21 17:43:02,669 - app.integrations.defender.repository - INFO - Verification: 230444 records found in vulnerabilities table
2025-11-21 17:43:02,669 - app.integrations.defender.repository - INFO - Data verification successful: 230444 records match expected count
2025-11-21 17:43:02,669 - app.integrations.defender.repository - INFO - Successfully saved 230444 vulnerability records using table switching method
2025-11-21 17:43:02,853 - app.integrations.defender.sync - INFO - Database verification: 230444 records in database after save
2025-11-21 17:43:02,854 - app.integrations.defender.sync - INFO - Device vulnerability details full sync completed, fetched 230444 records, saved 230444 records
2025-11-21 17:43:02,866 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-11-21 17:43:02.854651, type: full, records: 230444
2025-11-21 17:43:02,866 - app.integrations.defender.sync - INFO - Sync time recorded: 2025-11-21 17:43:02.854651, records: 230444
2025-11-21 17:43:03,008 - app.integrations.defender.sync - INFO - Creating snapshot after sync...
2025-11-21 17:43:04,918 - app.integrations.defender.repository - INFO - Recording CVE-Device combinations for snapshot...
2025-11-21 17:43:07,002 - app.integrations.defender.repository - ERROR - Database error recording snapshot: 1062 (23000): Duplicate entry '2-CVE-2024-13176-001a587340da760fba26d5150892038b8c190773' for key 'cve_device_snapshots.uk_snapshot_cve_device'
Traceback (most recent call last):
  File "/Users/k3zy/Desktop/VulnManagement/app/integrations/defender/repository.py", line 505, in record_snapshot
    cursor.executemany(cve_device_snapshot_query, batch)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/cursor.py", line 723, in executemany
    return self.execute(stmt)
           ~~~~~~~~~~~~^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/cursor.py", line 617, in execute
    self._handle_result(self._connection.cmd_query(stmt))
                        ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 77, in wrapper
    return method(cnx, *args, **kwargs)
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 843, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/Users/k3zy/Desktop/VulnManagement/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 620, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2-CVE-2024-13176-001a587340da760fba26d5150892038b8c190773' for key 'cve_device_snapshots.uk_snapshot_cve_device'
2025-11-21 17:43:07,046 - app.integrations.defender.sync - INFO - Full sync completed successfully
2025-11-21 17:43:07,046 - app.integrations.defender.sync - INFO - Full sync process completed successfully
2025-11-21 17:43:07,047 - app.integrations.defender.sync - INFO - Database connection closed
2025-11-21 17:43:07,047 - app.integrations.defender.sync - INFO - Vulnerability data sync completed successfully
2025-11-21 17:51:51,686 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-11-21 17:51:51,716 - mysql.connector - INFO - package: mysql.connector.plugins
2025-11-21 17:51:51,716 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-11-21 17:51:51,716 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-11-21 17:51:51,721 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-11-21 17:51:51,721 - app.integrations.defender.sync - INFO - Initializing database...
2025-11-21 17:51:51,758 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-11-21 17:51:51,759 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-11-21 17:51:51,759 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-11-21 17:51:51,776 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-11-21 17:51:51,839 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-11-21 17:51:51,839 - app.integrations.defender.sync - INFO - Database initialization completed
2025-11-21 17:51:51,839 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-11-21 17:51:51,839 - app.integrations.defender.sync - INFO - Starting full sync...
2025-11-21 17:51:51,839 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-11-21 17:51:51,839 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-11-21 17:51:52,345 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-11-21 17:51:52,345 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-11-21 17:51:58,111 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:51:58,111 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMDg0M30=
2025-11-21 17:52:03,765 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:52:03,765 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODc2NX0=
2025-11-21 17:52:09,970 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:52:09,971 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4ODc2NX0=
2025-11-21 17:52:16,120 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 17:52:16,122 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjgsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODc2NX0=
2025-11-21 17:52:20,461 - app.integrations.defender.api_client - INFO - Fetched 30444 records
2025-11-21 17:52:20,461 - app.integrations.defender.api_client - INFO - Total fetched 230444 records
2025-11-21 17:52:20,464 - app.integrations.defender.service - INFO - Successfully fetched 230444 vulnerability records
2025-11-21 17:52:20,464 - app.integrations.defender.sync - INFO - API returned 230444 vulnerability records
2025-11-21 17:52:20,464 - app.integrations.defender.sync - INFO - Saving 230444 vulnerability records to database...
2025-11-21 17:52:20,464 - app.integrations.defender.repository - INFO - Starting to save 230444 vulnerability records...
2025-11-21 17:52:20,475 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-11-21 17:52:20,487 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-11-21 17:52:20,488 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-11-21 17:52:20,644 - app.integrations.defender.repository - INFO - Temporary table vulnerabilities_temp created successfully
2025-11-21 17:52:20,645 - app.integrations.defender.repository - INFO - Validating and preparing 230444 records for batch insert...
2025-11-21 17:52:20,808 - app.integrations.defender.repository - INFO - Validated 230444 out of 230444 records
2025-11-21 17:52:28,265 - app.integrations.defender.repository - INFO - Inserting 230444 records in batches of 2000...
2025-11-21 17:52:29,580 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-11-21 17:52:30,360 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-11-21 17:52:31,870 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-11-21 17:52:32,244 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-11-21 17:52:32,566 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-11-21 17:52:32,900 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-11-21 17:52:33,298 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-11-21 17:52:33,511 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-11-21 17:52:33,731 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-11-21 17:52:33,926 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-11-21 17:52:34,279 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-11-21 17:52:34,457 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-11-21 17:52:34,706 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-11-21 17:52:34,897 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-11-21 17:52:35,337 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-11-21 17:52:35,552 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-11-21 17:52:35,766 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-11-21 17:52:35,989 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-11-21 17:52:36,274 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-11-21 17:52:36,529 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-11-21 17:52:36,979 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-11-21 17:52:37,304 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-11-21 17:52:37,606 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-11-21 17:52:37,878 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-11-21 17:52:38,294 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-11-21 17:52:38,603 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-11-21 17:52:38,785 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-11-21 17:52:38,986 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-11-21 17:52:39,771 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-11-21 17:52:40,259 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-11-21 17:52:40,472 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-11-21 17:52:40,688 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-11-21 17:52:41,071 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-11-21 17:52:41,365 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-11-21 17:52:41,612 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-11-21 17:52:41,825 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-11-21 17:52:42,013 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-11-21 17:52:42,324 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-11-21 17:52:42,566 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-11-21 17:52:42,780 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-11-21 17:52:42,994 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-11-21 17:52:43,314 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-11-21 17:52:43,539 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-11-21 17:52:43,759 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-11-21 17:52:43,997 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-11-21 17:52:44,209 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-11-21 17:52:44,586 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-11-21 17:52:44,781 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-11-21 17:52:45,073 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-11-21 17:52:45,350 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-11-21 17:52:45,585 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-11-21 17:52:45,802 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-11-21 17:52:46,017 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-11-21 17:52:46,297 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-11-21 17:52:46,541 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-11-21 17:52:46,767 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-11-21 17:52:47,051 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-11-21 17:52:47,371 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-11-21 17:52:47,557 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-11-21 17:52:47,722 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-11-21 17:52:48,007 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-11-21 17:52:48,226 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-11-21 17:52:48,671 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-11-21 17:52:49,065 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-11-21 17:52:51,208 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-11-21 17:52:51,649 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-11-21 17:52:51,921 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-11-21 17:52:52,141 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-11-21 17:52:52,383 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-11-21 17:52:52,740 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-11-21 17:52:53,027 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-11-21 17:52:53,246 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-11-21 17:52:53,502 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-11-21 17:52:53,804 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-11-21 17:52:54,026 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-11-21 17:52:54,341 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-11-21 17:52:54,572 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-11-21 17:52:54,783 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-11-21 17:52:54,976 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-11-21 17:52:55,160 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-11-21 17:52:55,345 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-11-21 17:52:55,564 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-11-21 17:52:55,907 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-11-21 17:52:56,139 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-11-21 17:52:56,345 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-11-21 17:52:56,622 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-11-21 17:52:56,927 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-11-21 17:52:57,126 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-11-21 17:52:57,465 - app.integrations.defender.repository - INFO - Inserted batch 89 (2000 records)
2025-11-21 17:52:58,081 - app.integrations.defender.repository - INFO - Inserted batch 90 (2000 records)
2025-11-21 17:52:58,339 - app.integrations.defender.repository - INFO - Inserted batch 91 (2000 records)
2025-11-21 17:52:58,542 - app.integrations.defender.repository - INFO - Inserted batch 92 (2000 records)
2025-11-21 17:52:58,905 - app.integrations.defender.repository - INFO - Inserted batch 93 (2000 records)
2025-11-21 17:52:59,098 - app.integrations.defender.repository - INFO - Inserted batch 94 (2000 records)
2025-11-21 17:52:59,282 - app.integrations.defender.repository - INFO - Inserted batch 95 (2000 records)
2025-11-21 17:52:59,464 - app.integrations.defender.repository - INFO - Inserted batch 96 (2000 records)
2025-11-21 17:52:59,657 - app.integrations.defender.repository - INFO - Inserted batch 97 (2000 records)
2025-11-21 17:52:59,841 - app.integrations.defender.repository - INFO - Inserted batch 98 (2000 records)
2025-11-21 17:53:00,025 - app.integrations.defender.repository - INFO - Inserted batch 99 (2000 records)
2025-11-21 17:53:00,204 - app.integrations.defender.repository - INFO - Inserted batch 100 (2000 records)
2025-11-21 17:53:00,413 - app.integrations.defender.repository - INFO - Inserted batch 101 (2000 records)
2025-11-21 17:53:00,682 - app.integrations.defender.repository - INFO - Inserted batch 102 (2000 records)
2025-11-21 17:53:00,899 - app.integrations.defender.repository - INFO - Inserted batch 103 (2000 records)
2025-11-21 17:53:01,105 - app.integrations.defender.repository - INFO - Inserted batch 104 (2000 records)
2025-11-21 17:53:01,288 - app.integrations.defender.repository - INFO - Inserted batch 105 (2000 records)
2025-11-21 17:53:01,685 - app.integrations.defender.repository - INFO - Inserted batch 106 (2000 records)
2025-11-21 17:53:01,910 - app.integrations.defender.repository - INFO - Inserted batch 107 (2000 records)
2025-11-21 17:53:02,087 - app.integrations.defender.repository - INFO - Inserted batch 108 (2000 records)
2025-11-21 17:53:02,264 - app.integrations.defender.repository - INFO - Inserted batch 109 (2000 records)
2025-11-21 17:53:02,443 - app.integrations.defender.repository - INFO - Inserted batch 110 (2000 records)
2025-11-21 17:53:02,710 - app.integrations.defender.repository - INFO - Inserted batch 111 (2000 records)
2025-11-21 17:53:03,015 - app.integrations.defender.repository - INFO - Inserted batch 112 (2000 records)
2025-11-21 17:53:03,201 - app.integrations.defender.repository - INFO - Inserted batch 113 (2000 records)
2025-11-21 17:53:03,467 - app.integrations.defender.repository - INFO - Inserted batch 114 (2000 records)
2025-11-21 17:53:03,774 - app.integrations.defender.repository - INFO - Inserted batch 115 (2000 records)
2025-11-21 17:53:03,838 - app.integrations.defender.repository - INFO - Inserted batch 116 (444 records)
2025-11-21 17:53:04,165 - app.integrations.defender.repository - INFO - Successfully inserted 230444 records into temporary table
2025-11-21 17:53:04,167 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-11-21 17:53:04,240 - app.integrations.defender.repository - INFO - Renamed vulnerabilities to vulnerabilities_old
2025-11-21 17:53:04,266 - app.integrations.defender.repository - INFO - Renamed vulnerabilities_temp to vulnerabilities
2025-11-21 17:53:04,306 - app.integrations.defender.repository - INFO - Dropped old table vulnerabilities_old
2025-11-21 17:53:04,307 - app.integrations.defender.repository - INFO - Verifying data was saved correctly...
2025-11-21 17:53:04,393 - app.integrations.defender.repository - INFO - Verification: 230444 records found in vulnerabilities table
2025-11-21 17:53:04,393 - app.integrations.defender.repository - INFO - Data verification successful: 230444 records match expected count
2025-11-21 17:53:04,393 - app.integrations.defender.repository - INFO - Successfully saved 230444 vulnerability records using table switching method
2025-11-21 17:53:04,618 - app.integrations.defender.sync - INFO - Database verification: 230444 records in database after save
2025-11-21 17:53:04,618 - app.integrations.defender.sync - INFO - Device vulnerability details full sync completed, fetched 230444 records, saved 230444 records
2025-11-21 17:53:04,634 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-11-21 17:53:04.618479, type: full, records: 230444
2025-11-21 17:53:04,634 - app.integrations.defender.sync - INFO - Sync time recorded: 2025-11-21 17:53:04.618479, records: 230444
2025-11-21 17:53:04,771 - app.integrations.defender.sync - INFO - Creating snapshot after sync...
2025-11-21 17:53:06,971 - app.integrations.defender.repository - INFO - Recording CVE-Device combinations for snapshot (deduplicating by CVE-Device)...
2025-11-21 17:53:11,344 - app.integrations.defender.repository - INFO - Found 210564 unique CVE-Device combinations after deduplication
2025-11-21 17:53:11,622 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 1 (2000 records)
2025-11-21 17:53:11,754 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 2 (2000 records)
2025-11-21 17:53:11,828 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 3 (2000 records)
2025-11-21 17:53:11,899 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 4 (2000 records)
2025-11-21 17:53:11,964 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 5 (2000 records)
2025-11-21 17:53:12,027 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 6 (2000 records)
2025-11-21 17:53:12,088 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 7 (2000 records)
2025-11-21 17:53:12,149 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 8 (2000 records)
2025-11-21 17:53:12,212 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 9 (2000 records)
2025-11-21 17:53:12,276 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 10 (2000 records)
2025-11-21 17:53:12,342 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 11 (2000 records)
2025-11-21 17:53:12,407 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 12 (2000 records)
2025-11-21 17:53:12,471 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 13 (2000 records)
2025-11-21 17:53:12,530 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 14 (2000 records)
2025-11-21 17:53:12,623 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 15 (2000 records)
2025-11-21 17:53:12,690 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 16 (2000 records)
2025-11-21 17:53:12,751 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 17 (2000 records)
2025-11-21 17:53:12,815 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 18 (2000 records)
2025-11-21 17:53:12,888 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 19 (2000 records)
2025-11-21 17:53:12,950 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 20 (2000 records)
2025-11-21 17:53:13,012 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 21 (2000 records)
2025-11-21 17:53:13,070 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 22 (2000 records)
2025-11-21 17:53:13,132 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 23 (2000 records)
2025-11-21 17:53:13,195 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 24 (2000 records)
2025-11-21 17:53:13,255 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 25 (2000 records)
2025-11-21 17:53:13,319 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 26 (2000 records)
2025-11-21 17:53:13,383 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 27 (2000 records)
2025-11-21 17:53:13,443 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 28 (2000 records)
2025-11-21 17:53:13,505 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 29 (2000 records)
2025-11-21 17:53:13,729 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 30 (2000 records)
2025-11-21 17:53:13,838 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 31 (2000 records)
2025-11-21 17:53:13,903 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 32 (2000 records)
2025-11-21 17:53:13,965 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 33 (2000 records)
2025-11-21 17:53:14,026 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 34 (2000 records)
2025-11-21 17:53:14,088 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 35 (2000 records)
2025-11-21 17:53:14,167 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 36 (2000 records)
2025-11-21 17:53:14,229 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 37 (2000 records)
2025-11-21 17:53:14,290 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 38 (2000 records)
2025-11-21 17:53:14,351 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 39 (2000 records)
2025-11-21 17:53:14,409 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 40 (2000 records)
2025-11-21 17:53:14,468 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 41 (2000 records)
2025-11-21 17:53:14,535 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 42 (2000 records)
2025-11-21 17:53:14,650 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 43 (2000 records)
2025-11-21 17:53:14,715 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 44 (2000 records)
2025-11-21 17:53:14,779 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 45 (2000 records)
2025-11-21 17:53:14,842 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 46 (2000 records)
2025-11-21 17:53:14,903 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 47 (2000 records)
2025-11-21 17:53:14,970 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 48 (2000 records)
2025-11-21 17:53:15,030 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 49 (2000 records)
2025-11-21 17:53:15,091 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 50 (2000 records)
2025-11-21 17:53:15,152 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 51 (2000 records)
2025-11-21 17:53:15,214 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 52 (2000 records)
2025-11-21 17:53:15,276 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 53 (2000 records)
2025-11-21 17:53:15,341 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 54 (2000 records)
2025-11-21 17:53:15,404 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 55 (2000 records)
2025-11-21 17:53:15,465 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 56 (2000 records)
2025-11-21 17:53:15,527 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 57 (2000 records)
2025-11-21 17:53:15,670 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 58 (2000 records)
2025-11-21 17:53:15,731 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 59 (2000 records)
2025-11-21 17:53:15,793 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 60 (2000 records)
2025-11-21 17:53:15,861 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 61 (2000 records)
2025-11-21 17:53:15,924 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 62 (2000 records)
2025-11-21 17:53:15,989 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 63 (2000 records)
2025-11-21 17:53:16,050 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 64 (2000 records)
2025-11-21 17:53:16,128 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 65 (2000 records)
2025-11-21 17:53:16,188 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 66 (2000 records)
2025-11-21 17:53:16,249 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 67 (2000 records)
2025-11-21 17:53:16,310 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 68 (2000 records)
2025-11-21 17:53:16,372 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 69 (2000 records)
2025-11-21 17:53:16,433 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 70 (2000 records)
2025-11-21 17:53:16,494 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 71 (2000 records)
2025-11-21 17:53:16,656 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 72 (2000 records)
2025-11-21 17:53:16,720 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 73 (2000 records)
2025-11-21 17:53:16,784 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 74 (2000 records)
2025-11-21 17:53:16,845 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 75 (2000 records)
2025-11-21 17:53:16,907 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 76 (2000 records)
2025-11-21 17:53:16,969 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 77 (2000 records)
2025-11-21 17:53:17,032 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 78 (2000 records)
2025-11-21 17:53:17,104 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 79 (2000 records)
2025-11-21 17:53:17,169 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 80 (2000 records)
2025-11-21 17:53:17,233 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 81 (2000 records)
2025-11-21 17:53:17,304 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 82 (2000 records)
2025-11-21 17:53:17,369 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 83 (2000 records)
2025-11-21 17:53:17,433 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 84 (2000 records)
2025-11-21 17:53:17,499 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 85 (2000 records)
2025-11-21 17:53:17,584 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 86 (2000 records)
2025-11-21 17:53:17,681 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 87 (2000 records)
2025-11-21 17:53:17,745 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 88 (2000 records)
2025-11-21 17:53:17,822 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 89 (2000 records)
2025-11-21 17:53:17,887 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 90 (2000 records)
2025-11-21 17:53:17,950 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 91 (2000 records)
2025-11-21 17:53:18,013 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 92 (2000 records)
2025-11-21 17:53:18,075 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 93 (2000 records)
2025-11-21 17:53:18,141 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 94 (2000 records)
2025-11-21 17:53:18,205 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 95 (2000 records)
2025-11-21 17:53:18,275 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 96 (2000 records)
2025-11-21 17:53:18,339 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 97 (2000 records)
2025-11-21 17:53:18,402 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 98 (2000 records)
2025-11-21 17:53:18,474 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 99 (2000 records)
2025-11-21 17:53:18,539 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 100 (2000 records)
2025-11-21 17:53:18,664 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 101 (2000 records)
2025-11-21 17:53:18,732 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 102 (2000 records)
2025-11-21 17:53:18,796 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 103 (2000 records)
2025-11-21 17:53:18,860 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 104 (2000 records)
2025-11-21 17:53:18,924 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 105 (2000 records)
2025-11-21 17:53:18,941 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 106 (564 records)
2025-11-21 17:53:18,996 - app.integrations.defender.repository - INFO - Snapshot recorded successfully, snapshot ID: 3, CVE-Device records: 210564
2025-11-21 17:53:19,030 - app.integrations.defender.sync - INFO - Full sync completed successfully
2025-11-21 17:53:19,030 - app.integrations.defender.sync - INFO - Full sync process completed successfully
2025-11-21 17:53:19,031 - app.integrations.defender.sync - INFO - Database connection closed
2025-11-21 17:53:19,031 - app.integrations.defender.sync - INFO - Vulnerability data sync completed successfully
2025-11-21 18:19:02,984 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-11-21 18:19:03,024 - mysql.connector - INFO - package: mysql.connector.plugins
2025-11-21 18:19:03,024 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-11-21 18:19:03,024 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-11-21 18:19:03,026 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-11-21 18:19:03,026 - app.integrations.defender.sync - INFO - Initializing database...
2025-11-21 18:19:03,029 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-11-21 18:19:03,029 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-11-21 18:19:03,029 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-11-21 18:19:03,030 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-11-21 18:19:03,030 - app.integrations.defender.database - INFO - vulnerabilities table exists, checking for autopatch_covered column...
2025-11-21 18:19:03,031 - app.integrations.defender.database - INFO - vulnerabilities table already has autopatch_covered column
2025-11-21 18:19:03,068 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-11-21 18:19:03,068 - app.integrations.defender.sync - INFO - Database initialization completed
2025-11-21 18:19:03,068 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-11-21 18:19:03,068 - app.integrations.defender.sync - INFO - Starting full sync...
2025-11-21 18:19:03,068 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-11-21 18:19:03,069 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-11-21 18:19:03,796 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-11-21 18:19:03,797 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-11-21 18:19:09,732 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 18:19:09,733 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMDg0M30=
2025-11-21 18:19:15,538 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 18:19:15,539 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODc2NX0=
2025-11-21 18:19:20,923 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 18:19:20,923 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4ODc2NX0=
2025-11-21 18:19:27,067 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-21 18:19:27,067 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yMS8wOTI1LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjgsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODc2NX0=
2025-11-21 18:19:31,277 - app.integrations.defender.api_client - INFO - Fetched 30444 records
2025-11-21 18:19:31,277 - app.integrations.defender.api_client - INFO - Total fetched 230444 records
2025-11-21 18:19:31,278 - app.integrations.defender.service - INFO - Successfully fetched 230444 vulnerability records
2025-11-21 18:19:31,278 - app.integrations.defender.sync - INFO - API returned 230444 vulnerability records
2025-11-21 18:19:31,278 - app.integrations.defender.sync - INFO - Saving 230444 vulnerability records to database...
2025-11-21 18:19:31,278 - app.integrations.defender.repository - INFO - Starting to save 230444 vulnerability records...
2025-11-21 18:19:31,280 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-11-21 18:19:31,284 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-11-21 18:19:31,284 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-11-21 18:19:31,502 - app.integrations.defender.repository - INFO - Temporary table vulnerabilities_temp created successfully
2025-11-21 18:19:31,502 - app.integrations.defender.repository - INFO - Validating and preparing 230444 records for batch insert...
2025-11-21 18:19:31,598 - app.integrations.defender.repository - INFO - Validated 230444 out of 230444 records
2025-11-21 18:19:34,584 - app.integrations.defender.repository - INFO - Inserting 230444 records in batches of 2000...
2025-11-21 18:19:35,048 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-11-21 18:19:35,312 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-11-21 18:19:35,572 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-11-21 18:19:35,787 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-11-21 18:19:36,028 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-11-21 18:19:36,365 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-11-21 18:19:36,595 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-11-21 18:19:36,799 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-11-21 18:19:37,013 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-11-21 18:19:37,228 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-11-21 18:19:37,544 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-11-21 18:19:37,750 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-11-21 18:19:37,949 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-11-21 18:19:38,203 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-11-21 18:19:38,433 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-11-21 18:19:38,634 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-11-21 18:19:38,815 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-11-21 18:19:39,010 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-11-21 18:19:39,413 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-11-21 18:19:39,623 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-11-21 18:19:39,796 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-11-21 18:19:39,983 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-11-21 18:19:40,187 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-11-21 18:19:40,502 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-11-21 18:19:40,795 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-11-21 18:19:40,979 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-11-21 18:19:41,172 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-11-21 18:19:41,372 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-11-21 18:19:41,555 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-11-21 18:19:41,747 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-11-21 18:19:41,932 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-11-21 18:19:42,123 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-11-21 18:19:42,413 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-11-21 18:19:42,614 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-11-21 18:19:42,797 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-11-21 18:19:42,979 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-11-21 18:19:43,169 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-11-21 18:19:43,462 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-11-21 18:19:43,673 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-11-21 18:19:43,845 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-11-21 18:19:44,032 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-11-21 18:19:44,221 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-11-21 18:19:44,513 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-11-21 18:19:44,731 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-11-21 18:19:44,912 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-11-21 18:19:45,095 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-11-21 18:19:45,387 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-11-21 18:19:45,612 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-11-21 18:19:45,802 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-11-21 18:19:45,998 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-11-21 18:19:46,379 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-11-21 18:19:46,582 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-11-21 18:19:46,766 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-11-21 18:19:46,961 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-11-21 18:19:47,159 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-11-21 18:19:47,461 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-11-21 18:19:47,686 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-11-21 18:19:47,879 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-11-21 18:19:48,070 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-11-21 18:19:48,419 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-11-21 18:19:48,640 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-11-21 18:19:48,830 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-11-21 18:19:49,036 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-11-21 18:19:49,269 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-11-21 18:19:49,456 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-11-21 18:19:49,649 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-11-21 18:19:49,843 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-11-21 18:19:50,031 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-11-21 18:19:50,217 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-11-21 18:19:50,581 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-11-21 18:19:50,797 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-11-21 18:19:50,980 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-11-21 18:19:51,174 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-11-21 18:19:51,451 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-11-21 18:19:51,668 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-11-21 18:19:51,877 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-11-21 18:19:52,066 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-11-21 18:19:52,400 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-11-21 18:19:52,617 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-11-21 18:19:52,806 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-11-21 18:19:52,992 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-11-21 18:19:53,307 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-11-21 18:19:53,605 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-11-21 18:19:53,830 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-11-21 18:19:54,026 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-11-21 18:19:54,254 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-11-21 18:19:54,486 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-11-21 18:19:54,713 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-11-21 18:19:54,926 - app.integrations.defender.repository - INFO - Inserted batch 89 (2000 records)
2025-11-21 18:19:55,120 - app.integrations.defender.repository - INFO - Inserted batch 90 (2000 records)
2025-11-21 18:19:55,460 - app.integrations.defender.repository - INFO - Inserted batch 91 (2000 records)
2025-11-21 18:19:55,661 - app.integrations.defender.repository - INFO - Inserted batch 92 (2000 records)
2025-11-21 18:19:55,863 - app.integrations.defender.repository - INFO - Inserted batch 93 (2000 records)
2025-11-21 18:19:56,053 - app.integrations.defender.repository - INFO - Inserted batch 94 (2000 records)
2025-11-21 18:19:56,468 - app.integrations.defender.repository - INFO - Inserted batch 95 (2000 records)
2025-11-21 18:19:56,681 - app.integrations.defender.repository - INFO - Inserted batch 96 (2000 records)
2025-11-21 18:19:56,889 - app.integrations.defender.repository - INFO - Inserted batch 97 (2000 records)
2025-11-21 18:19:57,104 - app.integrations.defender.repository - INFO - Inserted batch 98 (2000 records)
2025-11-21 18:19:57,416 - app.integrations.defender.repository - INFO - Inserted batch 99 (2000 records)
2025-11-21 18:19:57,627 - app.integrations.defender.repository - INFO - Inserted batch 100 (2000 records)
2025-11-21 18:19:57,830 - app.integrations.defender.repository - INFO - Inserted batch 101 (2000 records)
2025-11-21 18:19:58,031 - app.integrations.defender.repository - INFO - Inserted batch 102 (2000 records)
2025-11-21 18:19:58,267 - app.integrations.defender.repository - INFO - Inserted batch 103 (2000 records)
2025-11-21 18:19:58,504 - app.integrations.defender.repository - INFO - Inserted batch 104 (2000 records)
2025-11-21 18:19:58,733 - app.integrations.defender.repository - INFO - Inserted batch 105 (2000 records)
2025-11-21 18:19:58,944 - app.integrations.defender.repository - INFO - Inserted batch 106 (2000 records)
2025-11-21 18:19:59,150 - app.integrations.defender.repository - INFO - Inserted batch 107 (2000 records)
2025-11-21 18:19:59,406 - app.integrations.defender.repository - INFO - Inserted batch 108 (2000 records)
2025-11-21 18:19:59,653 - app.integrations.defender.repository - INFO - Inserted batch 109 (2000 records)
2025-11-21 18:19:59,850 - app.integrations.defender.repository - INFO - Inserted batch 110 (2000 records)
2025-11-21 18:20:00,127 - app.integrations.defender.repository - INFO - Inserted batch 111 (2000 records)
2025-11-21 18:20:00,412 - app.integrations.defender.repository - INFO - Inserted batch 112 (2000 records)
2025-11-21 18:20:00,629 - app.integrations.defender.repository - INFO - Inserted batch 113 (2000 records)
2025-11-21 18:20:00,842 - app.integrations.defender.repository - INFO - Inserted batch 114 (2000 records)
2025-11-21 18:20:01,092 - app.integrations.defender.repository - INFO - Inserted batch 115 (2000 records)
2025-11-21 18:20:01,168 - app.integrations.defender.repository - INFO - Inserted batch 116 (444 records)
2025-11-21 18:20:01,613 - app.integrations.defender.repository - INFO - Successfully inserted 230444 records into temporary table
2025-11-21 18:20:01,613 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-11-21 18:20:01,699 - app.integrations.defender.repository - INFO - Renamed vulnerabilities to vulnerabilities_old
2025-11-21 18:20:01,745 - app.integrations.defender.repository - INFO - Renamed vulnerabilities_temp to vulnerabilities
2025-11-21 18:20:01,780 - app.integrations.defender.repository - INFO - Dropped old table vulnerabilities_old
2025-11-21 18:20:01,781 - app.integrations.defender.repository - INFO - Verifying data was saved correctly...
2025-11-21 18:20:01,921 - app.integrations.defender.repository - INFO - Verification: 230444 records found in vulnerabilities table
2025-11-21 18:20:01,921 - app.integrations.defender.repository - INFO - Data verification successful: 230444 records match expected count
2025-11-21 18:20:01,921 - app.integrations.defender.repository - INFO - Successfully saved 230444 vulnerability records using table switching method
2025-11-21 18:20:02,120 - app.integrations.defender.sync - INFO - Database verification: 230444 records in database after save
2025-11-21 18:20:02,120 - app.integrations.defender.sync - INFO - Device vulnerability details full sync completed, fetched 230444 records, saved 230444 records
2025-11-21 18:20:02,127 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-11-21 18:20:02.120410, type: full, records: 230444
2025-11-21 18:20:02,127 - app.integrations.defender.sync - INFO - Sync time recorded: 2025-11-21 18:20:02.120410, records: 230444
2025-11-21 18:20:02,254 - app.integrations.defender.sync - INFO - Creating snapshot after sync...
2025-11-21 18:20:05,132 - app.integrations.defender.repository - INFO - Recording CVE-Device combinations for snapshot (deduplicating by CVE-Device)...
2025-11-21 18:20:09,362 - app.integrations.defender.repository - INFO - Found 210564 unique CVE-Device combinations after deduplication
2025-11-21 18:20:09,594 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 1 (2000 records)
2025-11-21 18:20:09,671 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 2 (2000 records)
2025-11-21 18:20:09,786 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 3 (2000 records)
2025-11-21 18:20:09,917 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 4 (2000 records)
2025-11-21 18:20:10,019 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 5 (2000 records)
2025-11-21 18:20:10,101 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 6 (2000 records)
2025-11-21 18:20:10,171 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 7 (2000 records)
2025-11-21 18:20:10,293 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 8 (2000 records)
2025-11-21 18:20:10,440 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 9 (2000 records)
2025-11-21 18:20:10,514 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 10 (2000 records)
2025-11-21 18:20:10,607 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 11 (2000 records)
2025-11-21 18:20:10,688 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 12 (2000 records)
2025-11-21 18:20:10,764 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 13 (2000 records)
2025-11-21 18:20:10,846 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 14 (2000 records)
2025-11-21 18:20:10,925 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 15 (2000 records)
2025-11-21 18:20:11,002 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 16 (2000 records)
2025-11-21 18:20:11,071 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 17 (2000 records)
2025-11-21 18:20:11,139 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 18 (2000 records)
2025-11-21 18:20:11,211 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 19 (2000 records)
2025-11-21 18:20:11,284 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 20 (2000 records)
2025-11-21 18:20:11,442 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 21 (2000 records)
2025-11-21 18:20:11,523 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 22 (2000 records)
2025-11-21 18:20:11,593 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 23 (2000 records)
2025-11-21 18:20:11,664 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 24 (2000 records)
2025-11-21 18:20:11,735 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 25 (2000 records)
2025-11-21 18:20:11,809 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 26 (2000 records)
2025-11-21 18:20:11,874 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 27 (2000 records)
2025-11-21 18:20:11,944 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 28 (2000 records)
2025-11-21 18:20:12,014 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 29 (2000 records)
2025-11-21 18:20:12,209 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 30 (2000 records)
2025-11-21 18:20:12,285 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 31 (2000 records)
2025-11-21 18:20:12,454 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 32 (2000 records)
2025-11-21 18:20:12,994 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 33 (2000 records)
2025-11-21 18:20:13,139 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 34 (2000 records)
2025-11-21 18:20:13,224 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 35 (2000 records)
2025-11-21 18:20:13,378 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 36 (2000 records)
2025-11-21 18:20:13,453 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 37 (2000 records)
2025-11-21 18:20:13,526 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 38 (2000 records)
2025-11-21 18:20:13,602 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 39 (2000 records)
2025-11-21 18:20:13,673 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 40 (2000 records)
2025-11-21 18:20:13,744 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 41 (2000 records)
2025-11-21 18:20:13,819 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 42 (2000 records)
2025-11-21 18:20:13,888 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 43 (2000 records)
2025-11-21 18:20:13,958 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 44 (2000 records)
2025-11-21 18:20:14,032 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 45 (2000 records)
2025-11-21 18:20:14,113 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 46 (2000 records)
2025-11-21 18:20:14,186 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 47 (2000 records)
2025-11-21 18:20:14,254 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 48 (2000 records)
2025-11-21 18:20:14,434 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 49 (2000 records)
2025-11-21 18:20:14,504 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 50 (2000 records)
2025-11-21 18:20:14,574 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 51 (2000 records)
2025-11-21 18:20:14,651 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 52 (2000 records)
2025-11-21 18:20:14,733 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 53 (2000 records)
2025-11-21 18:20:14,802 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 54 (2000 records)
2025-11-21 18:20:14,880 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 55 (2000 records)
2025-11-21 18:20:14,960 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 56 (2000 records)
2025-11-21 18:20:15,024 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 57 (2000 records)
2025-11-21 18:20:15,095 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 58 (2000 records)
2025-11-21 18:20:15,166 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 59 (2000 records)
2025-11-21 18:20:15,235 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 60 (2000 records)
2025-11-21 18:20:15,301 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 61 (2000 records)
2025-11-21 18:20:15,443 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 62 (2000 records)
2025-11-21 18:20:15,524 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 63 (2000 records)
2025-11-21 18:20:15,591 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 64 (2000 records)
2025-11-21 18:20:15,658 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 65 (2000 records)
2025-11-21 18:20:15,724 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 66 (2000 records)
2025-11-21 18:20:15,791 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 67 (2000 records)
2025-11-21 18:20:15,901 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 68 (2000 records)
2025-11-21 18:20:15,967 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 69 (2000 records)
2025-11-21 18:20:16,035 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 70 (2000 records)
2025-11-21 18:20:16,101 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 71 (2000 records)
2025-11-21 18:20:16,186 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 72 (2000 records)
2025-11-21 18:20:16,258 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 73 (2000 records)
2025-11-21 18:20:16,422 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 74 (2000 records)
2025-11-21 18:20:16,501 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 75 (2000 records)
2025-11-21 18:20:16,569 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 76 (2000 records)
2025-11-21 18:20:16,638 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 77 (2000 records)
2025-11-21 18:20:16,711 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 78 (2000 records)
2025-11-21 18:20:16,785 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 79 (2000 records)
2025-11-21 18:20:16,853 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 80 (2000 records)
2025-11-21 18:20:16,923 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 81 (2000 records)
2025-11-21 18:20:16,995 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 82 (2000 records)
2025-11-21 18:20:17,067 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 83 (2000 records)
2025-11-21 18:20:17,139 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 84 (2000 records)
2025-11-21 18:20:17,210 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 85 (2000 records)
2025-11-21 18:20:17,281 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 86 (2000 records)
2025-11-21 18:20:17,472 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 87 (2000 records)
2025-11-21 18:20:17,540 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 88 (2000 records)
2025-11-21 18:20:17,622 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 89 (2000 records)
2025-11-21 18:20:17,695 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 90 (2000 records)
2025-11-21 18:20:17,773 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 91 (2000 records)
2025-11-21 18:20:17,845 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 92 (2000 records)
2025-11-21 18:20:17,922 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 93 (2000 records)
2025-11-21 18:20:18,000 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 94 (2000 records)
2025-11-21 18:20:18,071 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 95 (2000 records)
2025-11-21 18:20:18,143 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 96 (2000 records)
2025-11-21 18:20:18,215 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 97 (2000 records)
2025-11-21 18:20:18,287 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 98 (2000 records)
2025-11-21 18:20:18,385 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 99 (2000 records)
2025-11-21 18:20:18,480 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 100 (2000 records)
2025-11-21 18:20:18,561 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 101 (2000 records)
2025-11-21 18:20:18,638 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 102 (2000 records)
2025-11-21 18:20:18,710 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 103 (2000 records)
2025-11-21 18:20:18,788 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 104 (2000 records)
2025-11-21 18:20:18,861 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 105 (2000 records)
2025-11-21 18:20:18,882 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 106 (564 records)
2025-11-21 18:20:18,959 - app.integrations.defender.repository - INFO - Snapshot recorded successfully, snapshot ID: 4, CVE-Device records: 210564
2025-11-21 18:20:19,019 - app.integrations.defender.sync - INFO - Full sync completed successfully
2025-11-21 18:20:19,019 - app.integrations.defender.sync - INFO - Full sync process completed successfully
2025-11-21 18:20:19,020 - app.integrations.defender.sync - INFO - Database connection closed
2025-11-21 18:20:19,020 - app.integrations.defender.sync - INFO - Vulnerability data sync completed successfully
2025-11-24 14:00:39,948 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-11-24 14:00:39,983 - mysql.connector - INFO - package: mysql.connector.plugins
2025-11-24 14:00:39,984 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-11-24 14:00:39,984 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-11-24 14:00:39,987 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-11-24 14:00:39,987 - app.integrations.defender.sync - INFO - Initializing database...
2025-11-24 14:00:39,990 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-11-24 14:00:39,990 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-11-24 14:00:39,990 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-11-24 14:00:39,995 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-11-24 14:00:39,996 - app.integrations.defender.database - INFO - vulnerabilities table exists, checking for autopatch_covered column...
2025-11-24 14:00:39,996 - app.integrations.defender.database - INFO - vulnerabilities table already has autopatch_covered column
2025-11-24 14:00:40,034 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-11-24 14:00:40,035 - app.integrations.defender.sync - INFO - Database initialization completed
2025-11-24 14:00:40,035 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-11-24 14:00:40,035 - app.integrations.defender.sync - INFO - Starting full sync...
2025-11-24 14:00:40,035 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-11-24 14:00:40,035 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-11-24 14:00:40,644 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-11-24 14:00:40,645 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-11-24 14:00:46,232 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-24 14:00:46,233 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yNC8wMjMxLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjQsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxNjZ9
2025-11-24 14:00:51,904 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-24 14:00:51,905 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yNC8wMjMxLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo0MTc4N30=
2025-11-24 14:00:57,817 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-24 14:00:57,818 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yNC8wMjMxLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo5MTc4N30=
2025-11-24 14:01:03,727 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-24 14:01:03,728 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yNC8wMjMxLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjgsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo0MTc4N30=
2025-11-24 14:01:06,363 - app.integrations.defender.api_client - INFO - Fetched 5647 records
2025-11-24 14:01:06,364 - app.integrations.defender.api_client - INFO - Total fetched 205647 records
2025-11-24 14:01:06,364 - app.integrations.defender.service - INFO - Successfully fetched 205647 vulnerability records
2025-11-24 14:01:06,364 - app.integrations.defender.sync - INFO - API returned 205647 vulnerability records
2025-11-24 14:01:06,364 - app.integrations.defender.sync - INFO - Saving 205647 vulnerability records to database...
2025-11-24 14:01:06,364 - app.integrations.defender.repository - INFO - Starting to save 205647 vulnerability records...
2025-11-24 14:01:06,369 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-11-24 14:01:06,379 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-11-24 14:01:06,379 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-11-24 14:01:06,517 - app.integrations.defender.repository - INFO - Temporary table vulnerabilities_temp created successfully
2025-11-24 14:01:06,518 - app.integrations.defender.repository - INFO - Validating and preparing 205647 records for batch insert...
2025-11-24 14:01:06,586 - app.integrations.defender.repository - INFO - Validated 205647 out of 205647 records
2025-11-24 14:01:09,698 - app.integrations.defender.repository - INFO - Inserting 205647 records in batches of 2000...
2025-11-24 14:01:10,135 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-11-24 14:01:10,395 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-11-24 14:01:10,634 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-11-24 14:01:10,831 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-11-24 14:01:11,135 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-11-24 14:01:11,348 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-11-24 14:01:11,545 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-11-24 14:01:11,755 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-11-24 14:01:11,993 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-11-24 14:01:12,209 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-11-24 14:01:12,388 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-11-24 14:01:12,570 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-11-24 14:01:12,779 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-11-24 14:01:12,980 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-11-24 14:01:13,220 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-11-24 14:01:13,401 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-11-24 14:01:13,573 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-11-24 14:01:13,741 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-11-24 14:01:13,925 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-11-24 14:01:14,184 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-11-24 14:01:14,366 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-11-24 14:01:14,570 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-11-24 14:01:14,749 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-11-24 14:01:14,951 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-11-24 14:01:15,139 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-11-24 14:01:15,303 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-11-24 14:01:15,481 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-11-24 14:01:15,654 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-11-24 14:01:15,838 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-11-24 14:01:16,070 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-11-24 14:01:16,292 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-11-24 14:01:16,457 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-11-24 14:01:16,633 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-11-24 14:01:16,805 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-11-24 14:01:16,967 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-11-24 14:01:17,187 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-11-24 14:01:17,394 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-11-24 14:01:17,571 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-11-24 14:01:17,744 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-11-24 14:01:17,927 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-11-24 14:01:18,214 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-11-24 14:01:18,413 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-11-24 14:01:18,582 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-11-24 14:01:18,753 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-11-24 14:01:18,930 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-11-24 14:01:19,108 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-11-24 14:01:19,416 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-11-24 14:01:19,587 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-11-24 14:01:19,770 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-11-24 14:01:19,951 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-11-24 14:01:20,201 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-11-24 14:01:20,405 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-11-24 14:01:20,584 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-11-24 14:01:20,758 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-11-24 14:01:20,937 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-11-24 14:01:21,151 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-11-24 14:01:21,386 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-11-24 14:01:21,566 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-11-24 14:01:21,743 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-11-24 14:01:21,966 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-11-24 14:01:22,214 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-11-24 14:01:22,408 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-11-24 14:01:22,589 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-11-24 14:01:22,763 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-11-24 14:01:22,934 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-11-24 14:01:23,138 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-11-24 14:01:23,378 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-11-24 14:01:23,594 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-11-24 14:01:23,770 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-11-24 14:01:23,949 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-11-24 14:01:24,185 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-11-24 14:01:24,425 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-11-24 14:01:24,609 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-11-24 14:01:24,791 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-11-24 14:01:24,974 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-11-24 14:01:25,302 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-11-24 14:01:25,508 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-11-24 14:01:25,688 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-11-24 14:01:25,866 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-11-24 14:01:26,063 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-11-24 14:01:26,323 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-11-24 14:01:26,530 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-11-24 14:01:26,713 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-11-24 14:01:26,895 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-11-24 14:01:27,159 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-11-24 14:01:27,362 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-11-24 14:01:27,544 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-11-24 14:01:27,720 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-11-24 14:01:27,898 - app.integrations.defender.repository - INFO - Inserted batch 89 (2000 records)
2025-11-24 14:01:28,105 - app.integrations.defender.repository - INFO - Inserted batch 90 (2000 records)
2025-11-24 14:01:28,372 - app.integrations.defender.repository - INFO - Inserted batch 91 (2000 records)
2025-11-24 14:01:28,588 - app.integrations.defender.repository - INFO - Inserted batch 92 (2000 records)
2025-11-24 14:01:28,776 - app.integrations.defender.repository - INFO - Inserted batch 93 (2000 records)
2025-11-24 14:01:29,025 - app.integrations.defender.repository - INFO - Inserted batch 94 (2000 records)
2025-11-24 14:01:29,297 - app.integrations.defender.repository - INFO - Inserted batch 95 (2000 records)
2025-11-24 14:01:29,499 - app.integrations.defender.repository - INFO - Inserted batch 96 (2000 records)
2025-11-24 14:01:29,672 - app.integrations.defender.repository - INFO - Inserted batch 97 (2000 records)
2025-11-24 14:01:29,855 - app.integrations.defender.repository - INFO - Inserted batch 98 (2000 records)
2025-11-24 14:01:30,028 - app.integrations.defender.repository - INFO - Inserted batch 99 (2000 records)
2025-11-24 14:01:30,242 - app.integrations.defender.repository - INFO - Inserted batch 100 (2000 records)
2025-11-24 14:01:30,500 - app.integrations.defender.repository - INFO - Inserted batch 101 (2000 records)
2025-11-24 14:01:30,705 - app.integrations.defender.repository - INFO - Inserted batch 102 (2000 records)
2025-11-24 14:01:30,898 - app.integrations.defender.repository - INFO - Inserted batch 103 (1647 records)
2025-11-24 14:01:31,098 - app.integrations.defender.repository - INFO - Successfully inserted 205647 records into temporary table
2025-11-24 14:01:31,099 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-11-24 14:01:31,188 - app.integrations.defender.repository - INFO - Renamed vulnerabilities to vulnerabilities_old
2025-11-24 14:01:31,416 - app.integrations.defender.repository - INFO - Renamed vulnerabilities_temp to vulnerabilities
2025-11-24 14:01:31,449 - app.integrations.defender.repository - INFO - Dropped old table vulnerabilities_old
2025-11-24 14:01:31,450 - app.integrations.defender.repository - INFO - Verifying data was saved correctly...
2025-11-24 14:01:31,532 - app.integrations.defender.repository - INFO - Verification: 205647 records found in vulnerabilities table
2025-11-24 14:01:31,532 - app.integrations.defender.repository - INFO - Data verification successful: 205647 records match expected count
2025-11-24 14:01:31,532 - app.integrations.defender.repository - INFO - Successfully saved 205647 vulnerability records using table switching method
2025-11-24 14:01:31,623 - app.integrations.defender.sync - INFO - Database verification: 205647 records in database after save
2025-11-24 14:01:31,623 - app.integrations.defender.sync - INFO - Device vulnerability details full sync completed, fetched 205647 records, saved 205647 records
2025-11-24 14:01:31,630 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-11-24 14:01:31.623704, type: full, records: 205647
2025-11-24 14:01:31,630 - app.integrations.defender.sync - INFO - Sync time recorded: 2025-11-24 14:01:31.623704, records: 205647
2025-11-24 14:01:31,731 - app.integrations.defender.sync - INFO - Creating snapshot after sync...
2025-11-24 14:01:33,418 - app.integrations.defender.repository - INFO - Recording CVE-Device combinations for snapshot (deduplicating by CVE-Device)...
2025-11-24 14:01:35,998 - app.integrations.defender.repository - INFO - Found 187541 unique CVE-Device combinations after deduplication
2025-11-24 14:01:36,134 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 1 (2000 records)
2025-11-24 14:01:36,201 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 2 (2000 records)
2025-11-24 14:01:36,293 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 3 (2000 records)
2025-11-24 14:01:36,360 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 4 (2000 records)
2025-11-24 14:01:36,427 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 5 (2000 records)
2025-11-24 14:01:36,494 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 6 (2000 records)
2025-11-24 14:01:36,563 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 7 (2000 records)
2025-11-24 14:01:36,632 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 8 (2000 records)
2025-11-24 14:01:36,699 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 9 (2000 records)
2025-11-24 14:01:36,768 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 10 (2000 records)
2025-11-24 14:01:36,851 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 11 (2000 records)
2025-11-24 14:01:36,919 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 12 (2000 records)
2025-11-24 14:01:37,000 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 13 (2000 records)
2025-11-24 14:01:37,114 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 14 (2000 records)
2025-11-24 14:01:37,450 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 15 (2000 records)
2025-11-24 14:01:37,543 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 16 (2000 records)
2025-11-24 14:01:37,621 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 17 (2000 records)
2025-11-24 14:01:37,688 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 18 (2000 records)
2025-11-24 14:01:37,754 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 19 (2000 records)
2025-11-24 14:01:37,822 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 20 (2000 records)
2025-11-24 14:01:37,892 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 21 (2000 records)
2025-11-24 14:01:37,956 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 22 (2000 records)
2025-11-24 14:01:38,019 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 23 (2000 records)
2025-11-24 14:01:38,157 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 24 (2000 records)
2025-11-24 14:01:38,224 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 25 (2000 records)
2025-11-24 14:01:38,290 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 26 (2000 records)
2025-11-24 14:01:38,355 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 27 (2000 records)
2025-11-24 14:01:38,420 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 28 (2000 records)
2025-11-24 14:01:38,489 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 29 (2000 records)
2025-11-24 14:01:38,553 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 30 (2000 records)
2025-11-24 14:01:38,621 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 31 (2000 records)
2025-11-24 14:01:38,693 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 32 (2000 records)
2025-11-24 14:01:38,757 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 33 (2000 records)
2025-11-24 14:01:38,820 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 34 (2000 records)
2025-11-24 14:01:38,884 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 35 (2000 records)
2025-11-24 14:01:38,945 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 36 (2000 records)
2025-11-24 14:01:39,013 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 37 (2000 records)
2025-11-24 14:01:39,100 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 38 (2000 records)
2025-11-24 14:01:39,246 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 39 (2000 records)
2025-11-24 14:01:39,309 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 40 (2000 records)
2025-11-24 14:01:39,378 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 41 (2000 records)
2025-11-24 14:01:39,446 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 42 (2000 records)
2025-11-24 14:01:39,514 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 43 (2000 records)
2025-11-24 14:01:39,581 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 44 (2000 records)
2025-11-24 14:01:39,653 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 45 (2000 records)
2025-11-24 14:01:39,717 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 46 (2000 records)
2025-11-24 14:01:39,781 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 47 (2000 records)
2025-11-24 14:01:39,846 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 48 (2000 records)
2025-11-24 14:01:39,909 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 49 (2000 records)
2025-11-24 14:01:39,972 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 50 (2000 records)
2025-11-24 14:01:40,039 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 51 (2000 records)
2025-11-24 14:01:40,219 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 52 (2000 records)
2025-11-24 14:01:40,285 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 53 (2000 records)
2025-11-24 14:01:40,358 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 54 (2000 records)
2025-11-24 14:01:40,427 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 55 (2000 records)
2025-11-24 14:01:40,498 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 56 (2000 records)
2025-11-24 14:01:40,565 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 57 (2000 records)
2025-11-24 14:01:40,630 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 58 (2000 records)
2025-11-24 14:01:40,694 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 59 (2000 records)
2025-11-24 14:01:40,760 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 60 (2000 records)
2025-11-24 14:01:40,824 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 61 (2000 records)
2025-11-24 14:01:40,888 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 62 (2000 records)
2025-11-24 14:01:40,958 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 63 (2000 records)
2025-11-24 14:01:41,022 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 64 (2000 records)
2025-11-24 14:01:41,217 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 65 (2000 records)
2025-11-24 14:01:41,291 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 66 (2000 records)
2025-11-24 14:01:41,355 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 67 (2000 records)
2025-11-24 14:01:41,456 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 68 (2000 records)
2025-11-24 14:01:41,541 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 69 (2000 records)
2025-11-24 14:01:41,613 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 70 (2000 records)
2025-11-24 14:01:41,691 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 71 (2000 records)
2025-11-24 14:01:41,758 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 72 (2000 records)
2025-11-24 14:01:41,829 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 73 (2000 records)
2025-11-24 14:01:41,896 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 74 (2000 records)
2025-11-24 14:01:41,959 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 75 (2000 records)
2025-11-24 14:01:42,022 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 76 (2000 records)
2025-11-24 14:01:42,105 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 77 (2000 records)
2025-11-24 14:01:42,221 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 78 (2000 records)
2025-11-24 14:01:42,289 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 79 (2000 records)
2025-11-24 14:01:42,362 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 80 (2000 records)
2025-11-24 14:01:42,430 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 81 (2000 records)
2025-11-24 14:01:42,498 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 82 (2000 records)
2025-11-24 14:01:42,564 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 83 (2000 records)
2025-11-24 14:01:42,629 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 84 (2000 records)
2025-11-24 14:01:42,693 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 85 (2000 records)
2025-11-24 14:01:42,760 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 86 (2000 records)
2025-11-24 14:01:42,825 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 87 (2000 records)
2025-11-24 14:01:42,893 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 88 (2000 records)
2025-11-24 14:01:42,961 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 89 (2000 records)
2025-11-24 14:01:43,029 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 90 (2000 records)
2025-11-24 14:01:43,154 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 91 (2000 records)
2025-11-24 14:01:43,222 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 92 (2000 records)
2025-11-24 14:01:43,288 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 93 (2000 records)
2025-11-24 14:01:43,336 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 94 (1541 records)
2025-11-24 14:01:43,382 - app.integrations.defender.repository - INFO - Snapshot recorded successfully, snapshot ID: 5, CVE-Device records: 187541
2025-11-24 14:01:43,407 - app.integrations.defender.sync - INFO - Full sync completed successfully
2025-11-24 14:01:43,408 - app.integrations.defender.sync - INFO - Full sync process completed successfully
2025-11-24 14:01:43,408 - app.integrations.defender.sync - INFO - Database connection closed
2025-11-24 14:01:43,408 - app.integrations.defender.sync - INFO - Vulnerability data sync completed successfully
2025-11-24 14:12:33,636 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-11-24 14:12:33,663 - mysql.connector - INFO - package: mysql.connector.plugins
2025-11-24 14:12:33,664 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-11-24 14:12:33,664 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-11-24 14:12:33,667 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-11-24 14:12:33,667 - app.integrations.defender.sync - INFO - Initializing database...
2025-11-24 14:12:33,670 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-11-24 14:12:33,670 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-11-24 14:12:33,670 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-11-24 14:12:33,672 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-11-24 14:12:33,673 - app.integrations.defender.database - INFO - vulnerabilities table exists, checking for autopatch_covered column...
2025-11-24 14:12:33,673 - app.integrations.defender.database - INFO - vulnerabilities table already has autopatch_covered column
2025-11-24 14:12:33,709 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-11-24 14:12:33,709 - app.integrations.defender.sync - INFO - Database initialization completed
2025-11-24 14:12:33,709 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-11-24 14:12:33,709 - app.integrations.defender.sync - INFO - Starting full sync...
2025-11-24 14:12:33,709 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-11-24 14:12:33,709 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-11-24 14:12:34,282 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-11-24 14:12:34,282 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-11-24 14:12:39,789 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-24 14:12:39,789 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yNC8wMjMxLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjQsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxNjZ9
2025-11-24 14:12:45,373 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-24 14:12:45,374 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yNC8wMjMxLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo0MTc4N30=
2025-11-24 14:12:51,628 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-24 14:12:51,629 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yNC8wMjMxLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo5MTc4N30=
2025-11-24 14:12:57,679 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-24 14:12:57,679 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yNC8wMjMxLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjgsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo0MTc4N30=
2025-11-24 14:12:59,996 - app.integrations.defender.api_client - INFO - Fetched 5647 records
2025-11-24 14:12:59,997 - app.integrations.defender.api_client - INFO - Total fetched 205647 records
2025-11-24 14:12:59,997 - app.integrations.defender.service - INFO - Successfully fetched 205647 vulnerability records
2025-11-24 14:12:59,997 - app.integrations.defender.sync - INFO - API returned 205647 vulnerability records
2025-11-24 14:12:59,997 - app.integrations.defender.sync - INFO - Saving 205647 vulnerability records to database...
2025-11-24 14:12:59,997 - app.integrations.defender.repository - INFO - Starting to save 205647 vulnerability records...
2025-11-24 14:13:00,002 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-11-24 14:13:00,007 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-11-24 14:13:00,008 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-11-24 14:13:00,229 - app.integrations.defender.repository - INFO - Temporary table vulnerabilities_temp created successfully
2025-11-24 14:13:00,229 - app.integrations.defender.repository - INFO - Validating and preparing 205647 records for batch insert...
2025-11-24 14:13:00,292 - app.integrations.defender.repository - INFO - Validated 205647 out of 205647 records
2025-11-24 14:13:02,930 - app.integrations.defender.repository - INFO - Inserting 205647 records in batches of 2000...
2025-11-24 14:13:03,296 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-11-24 14:13:03,540 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-11-24 14:13:03,742 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-11-24 14:13:03,937 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-11-24 14:13:04,214 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-11-24 14:13:04,410 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-11-24 14:13:04,588 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-11-24 14:13:04,768 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-11-24 14:13:04,951 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-11-24 14:13:05,128 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-11-24 14:13:05,379 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-11-24 14:13:05,556 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-11-24 14:13:05,728 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-11-24 14:13:05,891 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-11-24 14:13:06,113 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-11-24 14:13:06,284 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-11-24 14:13:06,455 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-11-24 14:13:06,615 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-11-24 14:13:06,798 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-11-24 14:13:06,984 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-11-24 14:13:07,242 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-11-24 14:13:07,451 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-11-24 14:13:07,623 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-11-24 14:13:07,799 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-11-24 14:13:07,974 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-11-24 14:13:08,149 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-11-24 14:13:08,433 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-11-24 14:13:08,626 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-11-24 14:13:08,796 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-11-24 14:13:08,969 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-11-24 14:13:09,194 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-11-24 14:13:09,365 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-11-24 14:13:09,544 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-11-24 14:13:09,716 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-11-24 14:13:09,878 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-11-24 14:13:10,061 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-11-24 14:13:10,266 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-11-24 14:13:10,440 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-11-24 14:13:10,606 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-11-24 14:13:10,783 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-11-24 14:13:10,951 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-11-24 14:13:11,162 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-11-24 14:13:11,364 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-11-24 14:13:11,538 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-11-24 14:13:11,709 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-11-24 14:13:11,881 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-11-24 14:13:12,061 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-11-24 14:13:12,313 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-11-24 14:13:12,529 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-11-24 14:13:12,713 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-11-24 14:13:12,890 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-11-24 14:13:13,074 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-11-24 14:13:13,280 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-11-24 14:13:13,468 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-11-24 14:13:13,695 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-11-24 14:13:14,591 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-11-24 14:13:14,861 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-11-24 14:13:15,201 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-11-24 14:13:15,452 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-11-24 14:13:15,646 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-11-24 14:13:15,833 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-11-24 14:13:16,035 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-11-24 14:13:16,258 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-11-24 14:13:16,442 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-11-24 14:13:16,633 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-11-24 14:13:16,867 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-11-24 14:13:17,079 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-11-24 14:13:17,375 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-11-24 14:13:17,587 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-11-24 14:13:17,766 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-11-24 14:13:17,945 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-11-24 14:13:18,232 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-11-24 14:13:18,443 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-11-24 14:13:18,636 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-11-24 14:13:18,817 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-11-24 14:13:18,994 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-11-24 14:13:19,175 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-11-24 14:13:19,398 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-11-24 14:13:19,587 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-11-24 14:13:19,766 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-11-24 14:13:19,947 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-11-24 14:13:20,165 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-11-24 14:13:20,411 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-11-24 14:13:20,602 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-11-24 14:13:20,794 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-11-24 14:13:20,975 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-11-24 14:13:21,192 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-11-24 14:13:21,441 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-11-24 14:13:21,642 - app.integrations.defender.repository - INFO - Inserted batch 89 (2000 records)
2025-11-24 14:13:21,836 - app.integrations.defender.repository - INFO - Inserted batch 90 (2000 records)
2025-11-24 14:13:22,014 - app.integrations.defender.repository - INFO - Inserted batch 91 (2000 records)
2025-11-24 14:13:22,274 - app.integrations.defender.repository - INFO - Inserted batch 92 (2000 records)
2025-11-24 14:13:22,465 - app.integrations.defender.repository - INFO - Inserted batch 93 (2000 records)
2025-11-24 14:13:22,647 - app.integrations.defender.repository - INFO - Inserted batch 94 (2000 records)
2025-11-24 14:13:22,830 - app.integrations.defender.repository - INFO - Inserted batch 95 (2000 records)
2025-11-24 14:13:23,204 - app.integrations.defender.repository - INFO - Inserted batch 96 (2000 records)
2025-11-24 14:13:23,414 - app.integrations.defender.repository - INFO - Inserted batch 97 (2000 records)
2025-11-24 14:13:23,611 - app.integrations.defender.repository - INFO - Inserted batch 98 (2000 records)
2025-11-24 14:13:23,798 - app.integrations.defender.repository - INFO - Inserted batch 99 (2000 records)
2025-11-24 14:13:24,024 - app.integrations.defender.repository - INFO - Inserted batch 100 (2000 records)
2025-11-24 14:13:24,325 - app.integrations.defender.repository - INFO - Inserted batch 101 (2000 records)
2025-11-24 14:13:24,577 - app.integrations.defender.repository - INFO - Inserted batch 102 (2000 records)
2025-11-24 14:13:24,764 - app.integrations.defender.repository - INFO - Inserted batch 103 (1647 records)
2025-11-24 14:13:24,987 - app.integrations.defender.repository - INFO - Successfully inserted 205647 records into temporary table
2025-11-24 14:13:24,988 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-11-24 14:13:25,043 - app.integrations.defender.repository - INFO - Renamed vulnerabilities to vulnerabilities_old
2025-11-24 14:13:25,075 - app.integrations.defender.repository - INFO - Renamed vulnerabilities_temp to vulnerabilities
2025-11-24 14:13:25,168 - app.integrations.defender.repository - INFO - Dropped old table vulnerabilities_old
2025-11-24 14:13:25,170 - app.integrations.defender.repository - INFO - Verifying data was saved correctly...
2025-11-24 14:13:25,275 - app.integrations.defender.repository - INFO - Verification: 205647 records found in vulnerabilities table
2025-11-24 14:13:25,276 - app.integrations.defender.repository - INFO - Data verification successful: 205647 records match expected count
2025-11-24 14:13:25,276 - app.integrations.defender.repository - INFO - Successfully saved 205647 vulnerability records using table switching method
2025-11-24 14:13:25,410 - app.integrations.defender.sync - INFO - Database verification: 205647 records in database after save
2025-11-24 14:13:25,410 - app.integrations.defender.sync - INFO - Device vulnerability details full sync completed, fetched 205647 records, saved 205647 records
2025-11-24 14:13:25,420 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-11-24 14:13:25.410645, type: full, records: 205647
2025-11-24 14:13:25,420 - app.integrations.defender.sync - INFO - Sync time recorded: 2025-11-24 14:13:25.410645, records: 205647
2025-11-24 14:13:25,532 - app.integrations.defender.sync - INFO - Creating snapshot after sync...
2025-11-24 14:13:27,189 - app.integrations.defender.repository - INFO - Recording CVE-Device combinations for snapshot (deduplicating by CVE-Device)...
2025-11-24 14:13:29,746 - app.integrations.defender.repository - INFO - Found 187541 unique CVE-Device combinations after deduplication
2025-11-24 14:13:29,886 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 1 (2000 records)
2025-11-24 14:13:29,965 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 2 (2000 records)
2025-11-24 14:13:30,050 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 3 (2000 records)
2025-11-24 14:13:30,152 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 4 (2000 records)
2025-11-24 14:13:30,230 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 5 (2000 records)
2025-11-24 14:13:30,326 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 6 (2000 records)
2025-11-24 14:13:30,398 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 7 (2000 records)
2025-11-24 14:13:30,478 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 8 (2000 records)
2025-11-24 14:13:30,550 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 9 (2000 records)
2025-11-24 14:13:30,621 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 10 (2000 records)
2025-11-24 14:13:30,693 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 11 (2000 records)
2025-11-24 14:13:30,766 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 12 (2000 records)
2025-11-24 14:13:30,857 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 13 (2000 records)
2025-11-24 14:13:30,948 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 14 (2000 records)
2025-11-24 14:13:31,023 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 15 (2000 records)
2025-11-24 14:13:31,098 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 16 (2000 records)
2025-11-24 14:13:31,176 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 17 (2000 records)
2025-11-24 14:13:31,262 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 18 (2000 records)
2025-11-24 14:13:31,356 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 19 (2000 records)
2025-11-24 14:13:31,437 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 20 (2000 records)
2025-11-24 14:13:31,505 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 21 (2000 records)
2025-11-24 14:13:31,572 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 22 (2000 records)
2025-11-24 14:13:31,638 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 23 (2000 records)
2025-11-24 14:13:31,708 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 24 (2000 records)
2025-11-24 14:13:31,776 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 25 (2000 records)
2025-11-24 14:13:31,841 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 26 (2000 records)
2025-11-24 14:13:31,907 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 27 (2000 records)
2025-11-24 14:13:31,974 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 28 (2000 records)
2025-11-24 14:13:32,049 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 29 (2000 records)
2025-11-24 14:13:32,114 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 30 (2000 records)
2025-11-24 14:13:32,200 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 31 (2000 records)
2025-11-24 14:13:32,316 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 32 (2000 records)
2025-11-24 14:13:32,382 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 33 (2000 records)
2025-11-24 14:13:32,459 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 34 (2000 records)
2025-11-24 14:13:32,532 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 35 (2000 records)
2025-11-24 14:13:32,601 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 36 (2000 records)
2025-11-24 14:13:32,669 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 37 (2000 records)
2025-11-24 14:13:32,738 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 38 (2000 records)
2025-11-24 14:13:32,804 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 39 (2000 records)
2025-11-24 14:13:32,877 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 40 (2000 records)
2025-11-24 14:13:32,941 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 41 (2000 records)
2025-11-24 14:13:33,006 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 42 (2000 records)
2025-11-24 14:13:33,077 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 43 (2000 records)
2025-11-24 14:13:33,214 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 44 (2000 records)
2025-11-24 14:13:33,320 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 45 (2000 records)
2025-11-24 14:13:33,389 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 46 (2000 records)
2025-11-24 14:13:33,464 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 47 (2000 records)
2025-11-24 14:13:33,536 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 48 (2000 records)
2025-11-24 14:13:33,601 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 49 (2000 records)
2025-11-24 14:13:33,665 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 50 (2000 records)
2025-11-24 14:13:33,733 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 51 (2000 records)
2025-11-24 14:13:33,799 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 52 (2000 records)
2025-11-24 14:13:33,870 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 53 (2000 records)
2025-11-24 14:13:33,943 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 54 (2000 records)
2025-11-24 14:13:34,010 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 55 (2000 records)
2025-11-24 14:13:34,079 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 56 (2000 records)
2025-11-24 14:13:34,191 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 57 (2000 records)
2025-11-24 14:13:34,295 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 58 (2000 records)
2025-11-24 14:13:34,364 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 59 (2000 records)
2025-11-24 14:13:34,435 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 60 (2000 records)
2025-11-24 14:13:34,511 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 61 (2000 records)
2025-11-24 14:13:34,578 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 62 (2000 records)
2025-11-24 14:13:34,645 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 63 (2000 records)
2025-11-24 14:13:34,722 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 64 (2000 records)
2025-11-24 14:13:34,792 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 65 (2000 records)
2025-11-24 14:13:34,864 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 66 (2000 records)
2025-11-24 14:13:34,934 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 67 (2000 records)
2025-11-24 14:13:35,003 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 68 (2000 records)
2025-11-24 14:13:35,074 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 69 (2000 records)
2025-11-24 14:13:35,172 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 70 (2000 records)
2025-11-24 14:13:35,266 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 71 (2000 records)
2025-11-24 14:13:35,349 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 72 (2000 records)
2025-11-24 14:13:35,422 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 73 (2000 records)
2025-11-24 14:13:35,491 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 74 (2000 records)
2025-11-24 14:13:35,564 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 75 (2000 records)
2025-11-24 14:13:35,636 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 76 (2000 records)
2025-11-24 14:13:35,707 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 77 (2000 records)
2025-11-24 14:13:35,775 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 78 (2000 records)
2025-11-24 14:13:35,844 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 79 (2000 records)
2025-11-24 14:13:35,914 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 80 (2000 records)
2025-11-24 14:13:35,987 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 81 (2000 records)
2025-11-24 14:13:36,056 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 82 (2000 records)
2025-11-24 14:13:36,123 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 83 (2000 records)
2025-11-24 14:13:36,242 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 84 (2000 records)
2025-11-24 14:13:36,312 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 85 (2000 records)
2025-11-24 14:13:36,382 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 86 (2000 records)
2025-11-24 14:13:36,451 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 87 (2000 records)
2025-11-24 14:13:36,523 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 88 (2000 records)
2025-11-24 14:13:36,597 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 89 (2000 records)
2025-11-24 14:13:36,665 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 90 (2000 records)
2025-11-24 14:13:36,730 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 91 (2000 records)
2025-11-24 14:13:36,796 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 92 (2000 records)
2025-11-24 14:13:36,863 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 93 (2000 records)
2025-11-24 14:13:36,913 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 94 (1541 records)
2025-11-24 14:13:36,952 - app.integrations.defender.repository - INFO - Snapshot recorded successfully, snapshot ID: 6, CVE-Device records: 187541
2025-11-24 14:13:36,978 - app.integrations.defender.sync - INFO - Snapshot created successfully with ID: 6
2025-11-24 14:13:36,978 - app.integrations.defender.sync - INFO - Full sync completed successfully
2025-11-24 14:13:36,978 - app.integrations.defender.sync - INFO - Full sync process completed successfully
2025-11-24 14:13:36,979 - app.integrations.defender.sync - INFO - Database connection closed
2025-11-24 14:13:36,979 - app.integrations.defender.sync - INFO - Vulnerability data sync completed successfully
2025-11-27 14:46:53,664 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-11-27 14:46:53,695 - mysql.connector - INFO - package: mysql.connector.plugins
2025-11-27 14:46:53,695 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-11-27 14:46:53,695 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-11-27 14:46:53,700 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-11-27 14:46:53,700 - app.integrations.defender.sync - INFO - Initializing database...
2025-11-27 14:46:53,743 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-11-27 14:46:53,743 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-11-27 14:46:53,744 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-11-27 14:46:53,769 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-11-27 14:46:53,772 - app.integrations.defender.database - INFO - vulnerabilities table exists, checking for autopatch_covered column...
2025-11-27 14:46:53,773 - app.integrations.defender.database - INFO - vulnerabilities table already has autopatch_covered column
2025-11-27 14:46:53,818 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-11-27 14:46:53,818 - app.integrations.defender.sync - INFO - Database initialization completed
2025-11-27 14:46:53,818 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-11-27 14:46:53,818 - app.integrations.defender.sync - INFO - Starting full sync...
2025-11-27 14:46:53,818 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-11-27 14:46:53,818 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-11-27 14:46:54,472 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-11-27 14:46:54,472 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-11-27 14:47:00,261 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-27 14:47:00,261 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yNy8wNTM0LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMzUwN30=
2025-11-27 14:47:05,595 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-27 14:47:05,595 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yNy8wNTM0LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo0MjA2NH0=
2025-11-27 14:47:11,236 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-27 14:47:11,237 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0yNy8wNTM0LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo5MjA2NH0=
2025-11-27 14:47:15,957 - app.integrations.defender.api_client - INFO - Fetched 38204 records
2025-11-27 14:47:15,957 - app.integrations.defender.api_client - INFO - Total fetched 188204 records
2025-11-27 14:47:15,957 - app.integrations.defender.service - INFO - Successfully fetched 188204 vulnerability records
2025-11-27 14:47:15,958 - app.integrations.defender.sync - INFO - API returned 188204 vulnerability records
2025-11-27 14:47:15,958 - app.integrations.defender.sync - INFO - Saving 188204 vulnerability records to database...
2025-11-27 14:47:15,958 - app.integrations.defender.repository - INFO - Starting to save 188204 vulnerability records...
2025-11-27 14:47:15,961 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-11-27 14:47:15,972 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-11-27 14:47:15,973 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-11-27 14:47:16,205 - app.integrations.defender.repository - INFO - Temporary table vulnerabilities_temp created successfully
2025-11-27 14:47:16,205 - app.integrations.defender.repository - INFO - Validating and preparing 188204 records for batch insert...
2025-11-27 14:47:16,257 - app.integrations.defender.repository - INFO - Validated 188204 out of 188204 records
2025-11-27 14:47:18,777 - app.integrations.defender.repository - INFO - Inserting 188204 records in batches of 2000...
2025-11-27 14:47:19,392 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-11-27 14:47:19,656 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-11-27 14:47:20,254 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-11-27 14:47:20,528 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-11-27 14:47:20,775 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-11-27 14:47:21,002 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-11-27 14:47:21,255 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-11-27 14:47:21,471 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-11-27 14:47:21,687 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-11-27 14:47:21,869 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-11-27 14:47:22,101 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-11-27 14:47:22,453 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-11-27 14:47:22,679 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-11-27 14:47:22,866 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-11-27 14:47:23,168 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-11-27 14:47:23,389 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-11-27 14:47:23,567 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-11-27 14:47:23,754 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-11-27 14:47:23,935 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-11-27 14:47:24,141 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-11-27 14:47:24,361 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-11-27 14:47:24,550 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-11-27 14:47:24,723 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-11-27 14:47:24,896 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-11-27 14:47:25,083 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-11-27 14:47:25,299 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-11-27 14:47:25,505 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-11-27 14:47:25,690 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-11-27 14:47:25,863 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-11-27 14:47:26,041 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-11-27 14:47:26,284 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-11-27 14:47:26,478 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-11-27 14:47:26,644 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-11-27 14:47:26,814 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-11-27 14:47:26,997 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-11-27 14:47:27,240 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-11-27 14:47:27,425 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-11-27 14:47:27,602 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-11-27 14:47:27,785 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-11-27 14:47:27,960 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-11-27 14:47:28,238 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-11-27 14:47:28,433 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-11-27 14:47:28,610 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-11-27 14:47:28,794 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-11-27 14:47:28,964 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-11-27 14:47:29,167 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-11-27 14:47:29,358 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-11-27 14:47:29,546 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-11-27 14:47:29,726 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-11-27 14:47:29,909 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-11-27 14:47:30,102 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-11-27 14:47:30,354 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-11-27 14:47:30,570 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-11-27 14:47:30,777 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-11-27 14:47:30,954 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-11-27 14:47:31,163 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-11-27 14:47:31,396 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-11-27 14:47:31,602 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-11-27 14:47:31,794 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-11-27 14:47:31,986 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-11-27 14:47:32,215 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-11-27 14:47:32,395 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-11-27 14:47:32,581 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-11-27 14:47:32,751 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-11-27 14:47:32,937 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-11-27 14:47:33,190 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-11-27 14:47:33,452 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-11-27 14:47:33,654 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-11-27 14:47:33,838 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-11-27 14:47:34,018 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-11-27 14:47:34,242 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-11-27 14:47:34,509 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-11-27 14:47:34,721 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-11-27 14:47:34,902 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-11-27 14:47:35,083 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-11-27 14:47:35,347 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-11-27 14:47:35,557 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-11-27 14:47:35,741 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-11-27 14:47:35,922 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-11-27 14:47:36,123 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-11-27 14:47:36,389 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-11-27 14:47:36,605 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-11-27 14:47:36,794 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-11-27 14:47:36,982 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-11-27 14:47:37,213 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-11-27 14:47:37,412 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-11-27 14:47:37,596 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-11-27 14:47:37,775 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-11-27 14:47:37,951 - app.integrations.defender.repository - INFO - Inserted batch 89 (2000 records)
2025-11-27 14:47:38,204 - app.integrations.defender.repository - INFO - Inserted batch 90 (2000 records)
2025-11-27 14:47:38,408 - app.integrations.defender.repository - INFO - Inserted batch 91 (2000 records)
2025-11-27 14:47:38,583 - app.integrations.defender.repository - INFO - Inserted batch 92 (2000 records)
2025-11-27 14:47:38,769 - app.integrations.defender.repository - INFO - Inserted batch 93 (2000 records)
2025-11-27 14:47:39,031 - app.integrations.defender.repository - INFO - Inserted batch 94 (2000 records)
2025-11-27 14:47:39,051 - app.integrations.defender.repository - INFO - Inserted batch 95 (204 records)
2025-11-27 14:47:39,282 - app.integrations.defender.repository - INFO - Successfully inserted 188204 records into temporary table
2025-11-27 14:47:39,282 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-11-27 14:47:39,406 - app.integrations.defender.repository - INFO - Renamed vulnerabilities to vulnerabilities_old
2025-11-27 14:47:39,449 - app.integrations.defender.repository - INFO - Renamed vulnerabilities_temp to vulnerabilities
2025-11-27 14:47:39,503 - app.integrations.defender.repository - INFO - Dropped old table vulnerabilities_old
2025-11-27 14:47:39,505 - app.integrations.defender.repository - INFO - Verifying data was saved correctly...
2025-11-27 14:47:39,575 - app.integrations.defender.repository - INFO - Verification: 188204 records found in vulnerabilities table
2025-11-27 14:47:39,576 - app.integrations.defender.repository - INFO - Data verification successful: 188204 records match expected count
2025-11-27 14:47:39,576 - app.integrations.defender.repository - INFO - Successfully saved 188204 vulnerability records using table switching method
2025-11-27 14:47:39,703 - app.integrations.defender.sync - INFO - Database verification: 188204 records in database after save
2025-11-27 14:47:39,703 - app.integrations.defender.sync - INFO - Device vulnerability details full sync completed, fetched 188204 records, saved 188204 records
2025-11-27 14:47:39,712 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-11-27 14:47:39.703974, type: full, records: 188204
2025-11-27 14:47:39,712 - app.integrations.defender.sync - INFO - Sync time recorded: 2025-11-27 14:47:39.703974, records: 188204
2025-11-27 14:47:39,841 - app.integrations.defender.sync - INFO - Creating snapshot after sync...
2025-11-27 14:47:41,573 - app.integrations.defender.repository - INFO - Recording CVE-Device combinations for snapshot (deduplicating by CVE-Device)...
2025-11-27 14:47:44,012 - app.integrations.defender.repository - INFO - Found 175937 unique CVE-Device combinations after deduplication
2025-11-27 14:47:44,163 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 1 (2000 records)
2025-11-27 14:47:44,239 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 2 (2000 records)
2025-11-27 14:47:44,333 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 3 (2000 records)
2025-11-27 14:47:44,403 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 4 (2000 records)
2025-11-27 14:47:44,477 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 5 (2000 records)
2025-11-27 14:47:44,552 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 6 (2000 records)
2025-11-27 14:47:44,628 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 7 (2000 records)
2025-11-27 14:47:44,704 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 8 (2000 records)
2025-11-27 14:47:44,794 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 9 (2000 records)
2025-11-27 14:47:44,874 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 10 (2000 records)
2025-11-27 14:47:44,958 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 11 (2000 records)
2025-11-27 14:47:45,043 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 12 (2000 records)
2025-11-27 14:47:45,323 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 13 (2000 records)
2025-11-27 14:47:45,433 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 14 (2000 records)
2025-11-27 14:47:45,520 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 15 (2000 records)
2025-11-27 14:47:45,591 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 16 (2000 records)
2025-11-27 14:47:45,666 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 17 (2000 records)
2025-11-27 14:47:45,736 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 18 (2000 records)
2025-11-27 14:47:45,803 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 19 (2000 records)
2025-11-27 14:47:45,874 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 20 (2000 records)
2025-11-27 14:47:45,948 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 21 (2000 records)
2025-11-27 14:47:46,022 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 22 (2000 records)
2025-11-27 14:47:46,097 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 23 (2000 records)
2025-11-27 14:47:46,226 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 24 (2000 records)
2025-11-27 14:47:46,307 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 25 (2000 records)
2025-11-27 14:47:46,379 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 26 (2000 records)
2025-11-27 14:47:46,457 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 27 (2000 records)
2025-11-27 14:47:46,543 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 28 (2000 records)
2025-11-27 14:47:46,640 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 29 (2000 records)
2025-11-27 14:47:46,712 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 30 (2000 records)
2025-11-27 14:47:46,788 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 31 (2000 records)
2025-11-27 14:47:46,861 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 32 (2000 records)
2025-11-27 14:47:46,933 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 33 (2000 records)
2025-11-27 14:47:47,019 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 34 (2000 records)
2025-11-27 14:47:47,104 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 35 (2000 records)
2025-11-27 14:47:47,329 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 36 (2000 records)
2025-11-27 14:47:47,420 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 37 (2000 records)
2025-11-27 14:47:47,494 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 38 (2000 records)
2025-11-27 14:47:47,562 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 39 (2000 records)
2025-11-27 14:47:47,640 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 40 (2000 records)
2025-11-27 14:47:47,712 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 41 (2000 records)
2025-11-27 14:47:47,787 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 42 (2000 records)
2025-11-27 14:47:47,858 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 43 (2000 records)
2025-11-27 14:47:47,942 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 44 (2000 records)
2025-11-27 14:47:48,022 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 45 (2000 records)
2025-11-27 14:47:48,126 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 46 (2000 records)
2025-11-27 14:47:48,271 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 47 (2000 records)
2025-11-27 14:47:48,362 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 48 (2000 records)
2025-11-27 14:47:48,428 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 49 (2000 records)
2025-11-27 14:47:48,500 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 50 (2000 records)
2025-11-27 14:47:48,571 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 51 (2000 records)
2025-11-27 14:47:48,643 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 52 (2000 records)
2025-11-27 14:47:48,718 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 53 (2000 records)
2025-11-27 14:47:48,789 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 54 (2000 records)
2025-11-27 14:47:48,857 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 55 (2000 records)
2025-11-27 14:47:48,925 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 56 (2000 records)
2025-11-27 14:47:48,999 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 57 (2000 records)
2025-11-27 14:47:49,071 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 58 (2000 records)
2025-11-27 14:47:49,262 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 59 (2000 records)
2025-11-27 14:47:49,356 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 60 (2000 records)
2025-11-27 14:47:49,425 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 61 (2000 records)
2025-11-27 14:47:49,499 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 62 (2000 records)
2025-11-27 14:47:49,571 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 63 (2000 records)
2025-11-27 14:47:49,642 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 64 (2000 records)
2025-11-27 14:47:49,713 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 65 (2000 records)
2025-11-27 14:47:49,779 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 66 (2000 records)
2025-11-27 14:47:49,845 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 67 (2000 records)
2025-11-27 14:47:49,912 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 68 (2000 records)
2025-11-27 14:47:49,988 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 69 (2000 records)
2025-11-27 14:47:50,061 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 70 (2000 records)
2025-11-27 14:47:50,268 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 71 (2000 records)
2025-11-27 14:47:50,364 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 72 (2000 records)
2025-11-27 14:47:50,433 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 73 (2000 records)
2025-11-27 14:47:50,508 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 74 (2000 records)
2025-11-27 14:47:50,576 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 75 (2000 records)
2025-11-27 14:47:50,640 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 76 (2000 records)
2025-11-27 14:47:50,711 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 77 (2000 records)
2025-11-27 14:47:50,784 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 78 (2000 records)
2025-11-27 14:47:50,852 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 79 (2000 records)
2025-11-27 14:47:50,925 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 80 (2000 records)
2025-11-27 14:47:51,009 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 81 (2000 records)
2025-11-27 14:47:51,204 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 82 (2000 records)
2025-11-27 14:47:51,515 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 83 (2000 records)
2025-11-27 14:47:51,600 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 84 (2000 records)
2025-11-27 14:47:51,681 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 85 (2000 records)
2025-11-27 14:47:51,754 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 86 (2000 records)
2025-11-27 14:47:51,822 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 87 (2000 records)
2025-11-27 14:47:51,886 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 88 (1937 records)
2025-11-27 14:47:51,943 - app.integrations.defender.repository - INFO - Snapshot recorded successfully, snapshot ID: 7, CVE-Device records: 175937
2025-11-27 14:47:51,983 - app.integrations.defender.sync - INFO - Snapshot created successfully with ID: 7
2025-11-27 14:47:51,984 - app.integrations.defender.sync - INFO - Full sync completed successfully
2025-11-27 14:47:51,984 - app.integrations.defender.sync - INFO - Full sync process completed successfully
2025-11-27 14:47:51,984 - app.integrations.defender.sync - INFO - Database connection closed
2025-11-27 14:47:51,984 - app.integrations.defender.sync - INFO - Vulnerability data sync completed successfully
2025-11-30 21:34:11,140 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-11-30 21:34:11,178 - mysql.connector - INFO - package: mysql.connector.plugins
2025-11-30 21:34:11,178 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-11-30 21:34:11,178 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-11-30 21:34:11,182 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-11-30 21:34:11,182 - app.integrations.defender.sync - INFO - Initializing database...
2025-11-30 21:34:11,188 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-11-30 21:34:11,188 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-11-30 21:34:11,188 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-11-30 21:34:11,190 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-11-30 21:34:11,192 - app.integrations.defender.database - INFO - vulnerabilities table exists, checking for autopatch_covered column...
2025-11-30 21:34:11,192 - app.integrations.defender.database - INFO - vulnerabilities table already has autopatch_covered column
2025-11-30 21:34:11,193 - app.integrations.defender.database - INFO - vulnerabilities already has metasploit_detected column
2025-11-30 21:34:11,194 - app.integrations.defender.database - INFO - vulnerabilities already has nuclei_detected column
2025-11-30 21:34:11,227 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-11-30 21:34:11,227 - app.integrations.defender.sync - INFO - Database initialization completed
2025-11-30 21:34:11,227 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-11-30 21:34:11,227 - app.integrations.defender.sync - INFO - Starting full sync...
2025-11-30 21:34:11,227 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-11-30 21:34:11,227 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-11-30 21:34:12,132 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-11-30 21:34:12,133 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-11-30 21:34:17,724 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-30 21:34:17,726 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0zMC8xMzMxLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMDc1NH0=
2025-11-30 21:34:23,620 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-30 21:34:23,622 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0zMC8xMzMxLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozOTI2N30=
2025-11-30 21:34:29,573 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-11-30 21:34:29,574 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMS0zMC8xMzMxLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4OTI2N30=
2025-11-30 21:34:33,629 - app.integrations.defender.api_client - INFO - Fetched 29401 records
2025-11-30 21:34:33,629 - app.integrations.defender.api_client - INFO - Total fetched 179401 records
2025-11-30 21:34:33,629 - app.integrations.defender.service - INFO - Successfully fetched 179401 vulnerability records
2025-11-30 21:34:33,629 - app.integrations.defender.sync - INFO - API returned 179401 vulnerability records
2025-11-30 21:34:33,629 - app.integrations.defender.sync - INFO - Saving 179401 vulnerability records to database...
2025-11-30 21:34:33,629 - app.integrations.defender.repository - INFO - Starting to save 179401 vulnerability records...
2025-11-30 21:34:33,638 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-11-30 21:34:33,646 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-11-30 21:34:33,646 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-11-30 21:34:33,822 - app.integrations.defender.repository - INFO - Temporary table vulnerabilities_temp created successfully
2025-11-30 21:34:33,822 - app.integrations.defender.repository - INFO - Validating and preparing 179401 records for batch insert...
2025-11-30 21:34:33,932 - app.integrations.defender.repository - INFO - Validated 179401 out of 179401 records
2025-11-30 21:34:36,523 - app.integrations.defender.repository - INFO - Inserting 179401 records in batches of 2000...
2025-11-30 21:34:37,058 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-11-30 21:34:37,347 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-11-30 21:34:37,660 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-11-30 21:34:37,893 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-11-30 21:34:38,161 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-11-30 21:34:38,435 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-11-30 21:34:38,801 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-11-30 21:34:39,076 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-11-30 21:34:39,334 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-11-30 21:34:39,597 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-11-30 21:34:39,842 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-11-30 21:34:40,091 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-11-30 21:34:40,331 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-11-30 21:34:40,564 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-11-30 21:34:40,829 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-11-30 21:34:41,038 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-11-30 21:34:41,242 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-11-30 21:34:41,460 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-11-30 21:34:41,659 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-11-30 21:34:41,943 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-11-30 21:34:42,166 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-11-30 21:34:42,376 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-11-30 21:34:42,611 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-11-30 21:34:42,840 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-11-30 21:34:43,040 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-11-30 21:34:43,234 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-11-30 21:34:43,439 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-11-30 21:34:43,674 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-11-30 21:34:43,943 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-11-30 21:34:44,159 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-11-30 21:34:44,373 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-11-30 21:34:44,565 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-11-30 21:34:44,883 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-11-30 21:34:45,098 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-11-30 21:34:45,304 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-11-30 21:34:45,514 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-11-30 21:34:45,716 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-11-30 21:34:46,027 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-11-30 21:34:46,234 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-11-30 21:34:46,436 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-11-30 21:34:46,644 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-11-30 21:34:46,906 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-11-30 21:34:47,109 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-11-30 21:34:47,311 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-11-30 21:34:47,495 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-11-30 21:34:47,890 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-11-30 21:34:48,085 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-11-30 21:34:48,285 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-11-30 21:34:48,513 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-11-30 21:34:48,827 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-11-30 21:34:49,030 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-11-30 21:34:49,241 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-11-30 21:34:49,437 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-11-30 21:34:49,669 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-11-30 21:34:49,910 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-11-30 21:34:50,119 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-11-30 21:34:50,396 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-11-30 21:34:50,610 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-11-30 21:34:50,912 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-11-30 21:34:51,112 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-11-30 21:34:51,370 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-11-30 21:34:51,577 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-11-30 21:34:51,928 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-11-30 21:34:52,142 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-11-30 21:34:52,358 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-11-30 21:34:52,564 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-11-30 21:34:52,942 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-11-30 21:34:53,164 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-11-30 21:34:53,376 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-11-30 21:34:53,597 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-11-30 21:34:53,925 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-11-30 21:34:54,124 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-11-30 21:34:54,339 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-11-30 21:34:54,554 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-11-30 21:34:54,859 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-11-30 21:34:55,070 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-11-30 21:34:55,270 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-11-30 21:34:55,476 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-11-30 21:34:55,791 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-11-30 21:34:56,036 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-11-30 21:34:56,260 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-11-30 21:34:56,464 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-11-30 21:34:56,866 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-11-30 21:34:57,102 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-11-30 21:34:57,310 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-11-30 21:34:57,527 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-11-30 21:34:57,838 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-11-30 21:34:58,048 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-11-30 21:34:58,268 - app.integrations.defender.repository - INFO - Inserted batch 89 (2000 records)
2025-11-30 21:34:58,523 - app.integrations.defender.repository - INFO - Inserted batch 90 (1401 records)
2025-11-30 21:34:58,809 - app.integrations.defender.repository - INFO - Successfully inserted 179401 records into temporary table
2025-11-30 21:34:58,809 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-11-30 21:34:58,908 - app.integrations.defender.repository - INFO - Renamed vulnerabilities to vulnerabilities_old
2025-11-30 21:34:58,940 - app.integrations.defender.repository - INFO - Renamed vulnerabilities_temp to vulnerabilities
2025-11-30 21:34:58,976 - app.integrations.defender.repository - INFO - Dropped old table vulnerabilities_old
2025-11-30 21:34:58,976 - app.integrations.defender.repository - INFO - Verifying data was saved correctly...
2025-11-30 21:34:59,060 - app.integrations.defender.repository - INFO - Verification: 179401 records found in vulnerabilities table
2025-11-30 21:34:59,060 - app.integrations.defender.repository - INFO - Data verification successful: 179401 records match expected count
2025-11-30 21:34:59,060 - app.integrations.defender.repository - INFO - Successfully saved 179401 vulnerability records using table switching method
2025-11-30 21:34:59,171 - app.integrations.defender.sync - INFO - Database verification: 179401 records in database after save
2025-11-30 21:34:59,171 - app.integrations.defender.sync - INFO - Device vulnerability details full sync completed, fetched 179401 records, saved 179401 records
2025-11-30 21:34:59,233 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-11-30 21:34:59.171448, type: full, records: 179401
2025-11-30 21:34:59,233 - app.integrations.defender.sync - INFO - Sync time recorded: 2025-11-30 21:34:59.171448, records: 179401
2025-11-30 21:34:59,344 - app.integrations.defender.sync - INFO - Creating snapshot after sync...
2025-11-30 21:35:01,101 - app.integrations.defender.repository - INFO - Recording CVE-Device combinations for snapshot (deduplicating by CVE-Device)...
2025-11-30 21:35:03,402 - app.integrations.defender.repository - INFO - Found 156791 unique CVE-Device combinations after deduplication
2025-11-30 21:35:03,549 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 1 (2000 records)
2025-11-30 21:35:03,692 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 2 (2000 records)
2025-11-30 21:35:03,781 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 3 (2000 records)
2025-11-30 21:35:03,862 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 4 (2000 records)
2025-11-30 21:35:03,956 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 5 (2000 records)
2025-11-30 21:35:04,035 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 6 (2000 records)
2025-11-30 21:35:04,120 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 7 (2000 records)
2025-11-30 21:35:04,196 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 8 (2000 records)
2025-11-30 21:35:04,279 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 9 (2000 records)
2025-11-30 21:35:04,368 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 10 (2000 records)
2025-11-30 21:35:04,459 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 11 (2000 records)
2025-11-30 21:35:04,541 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 12 (2000 records)
2025-11-30 21:35:04,751 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 13 (2000 records)
2025-11-30 21:35:04,844 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 14 (2000 records)
2025-11-30 21:35:04,923 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 15 (2000 records)
2025-11-30 21:35:04,999 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 16 (2000 records)
2025-11-30 21:35:05,074 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 17 (2000 records)
2025-11-30 21:35:05,152 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 18 (2000 records)
2025-11-30 21:35:05,229 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 19 (2000 records)
2025-11-30 21:35:05,307 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 20 (2000 records)
2025-11-30 21:35:05,381 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 21 (2000 records)
2025-11-30 21:35:05,454 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 22 (2000 records)
2025-11-30 21:35:05,528 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 23 (2000 records)
2025-11-30 21:35:05,604 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 24 (2000 records)
2025-11-30 21:35:05,746 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 25 (2000 records)
2025-11-30 21:35:05,815 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 26 (2000 records)
2025-11-30 21:35:05,892 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 27 (2000 records)
2025-11-30 21:35:05,970 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 28 (2000 records)
2025-11-30 21:35:06,041 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 29 (2000 records)
2025-11-30 21:35:06,114 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 30 (2000 records)
2025-11-30 21:35:06,195 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 31 (2000 records)
2025-11-30 21:35:06,266 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 32 (2000 records)
2025-11-30 21:35:06,342 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 33 (2000 records)
2025-11-30 21:35:06,423 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 34 (2000 records)
2025-11-30 21:35:06,510 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 35 (2000 records)
2025-11-30 21:35:06,587 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 36 (2000 records)
2025-11-30 21:35:06,759 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 37 (2000 records)
2025-11-30 21:35:06,845 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 38 (2000 records)
2025-11-30 21:35:06,922 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 39 (2000 records)
2025-11-30 21:35:06,994 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 40 (2000 records)
2025-11-30 21:35:07,068 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 41 (2000 records)
2025-11-30 21:35:07,139 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 42 (2000 records)
2025-11-30 21:35:07,215 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 43 (2000 records)
2025-11-30 21:35:07,288 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 44 (2000 records)
2025-11-30 21:35:07,362 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 45 (2000 records)
2025-11-30 21:35:07,434 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 46 (2000 records)
2025-11-30 21:35:07,508 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 47 (2000 records)
2025-11-30 21:35:07,585 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 48 (2000 records)
2025-11-30 21:35:07,711 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 49 (2000 records)
2025-11-30 21:35:07,839 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 50 (2000 records)
2025-11-30 21:35:07,914 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 51 (2000 records)
2025-11-30 21:35:07,983 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 52 (2000 records)
2025-11-30 21:35:08,054 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 53 (2000 records)
2025-11-30 21:35:08,130 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 54 (2000 records)
2025-11-30 21:35:08,201 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 55 (2000 records)
2025-11-30 21:35:08,275 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 56 (2000 records)
2025-11-30 21:35:08,350 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 57 (2000 records)
2025-11-30 21:35:08,423 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 58 (2000 records)
2025-11-30 21:35:08,496 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 59 (2000 records)
2025-11-30 21:35:08,573 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 60 (2000 records)
2025-11-30 21:35:08,677 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 61 (2000 records)
2025-11-30 21:35:08,818 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 62 (2000 records)
2025-11-30 21:35:08,896 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 63 (2000 records)
2025-11-30 21:35:08,970 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 64 (2000 records)
2025-11-30 21:35:09,044 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 65 (2000 records)
2025-11-30 21:35:09,117 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 66 (2000 records)
2025-11-30 21:35:09,197 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 67 (2000 records)
2025-11-30 21:35:09,273 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 68 (2000 records)
2025-11-30 21:35:09,350 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 69 (2000 records)
2025-11-30 21:35:09,420 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 70 (2000 records)
2025-11-30 21:35:09,499 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 71 (2000 records)
2025-11-30 21:35:09,574 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 72 (2000 records)
2025-11-30 21:35:09,658 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 73 (2000 records)
2025-11-30 21:35:09,842 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 74 (2000 records)
2025-11-30 21:35:09,915 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 75 (2000 records)
2025-11-30 21:35:09,990 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 76 (2000 records)
2025-11-30 21:35:10,065 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 77 (2000 records)
2025-11-30 21:35:10,138 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 78 (2000 records)
2025-11-30 21:35:10,167 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 79 (791 records)
2025-11-30 21:35:10,221 - app.integrations.defender.repository - INFO - Snapshot recorded successfully, snapshot ID: 8, CVE-Device records: 156791
2025-11-30 21:35:10,251 - app.integrations.defender.sync - INFO - Snapshot created successfully with ID: 8
2025-11-30 21:35:10,251 - app.integrations.defender.sync - INFO - Full sync completed successfully
2025-11-30 21:35:10,251 - app.integrations.defender.sync - INFO - Full sync process completed successfully
2025-11-30 21:35:10,252 - app.integrations.defender.sync - INFO - Database connection closed
2025-11-30 21:35:10,252 - app.integrations.defender.sync - INFO - Vulnerability data sync completed successfully
2025-12-01 14:15:46,780 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-12-01 14:15:46,807 - mysql.connector - INFO - package: mysql.connector.plugins
2025-12-01 14:15:46,807 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-12-01 14:15:46,807 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-12-01 14:15:46,812 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-12-01 14:15:46,812 - app.integrations.defender.sync - INFO - Initializing database...
2025-12-01 14:15:46,813 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-12-01 14:15:46,814 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-12-01 14:15:46,814 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-12-01 14:15:46,816 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-12-01 14:15:46,818 - app.integrations.defender.database - INFO - vulnerabilities table exists, checking for autopatch_covered column...
2025-12-01 14:15:46,820 - app.integrations.defender.database - INFO - vulnerabilities table already has autopatch_covered column
2025-12-01 14:15:46,821 - app.integrations.defender.database - INFO - vulnerabilities already has metasploit_detected column
2025-12-01 14:15:46,821 - app.integrations.defender.database - INFO - vulnerabilities already has nuclei_detected column
2025-12-01 14:15:46,867 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-12-01 14:15:46,867 - app.integrations.defender.sync - INFO - Database initialization completed
2025-12-01 14:15:46,867 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-12-01 14:15:46,867 - app.integrations.defender.sync - INFO - Starting full sync...
2025-12-01 14:15:46,867 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-12-01 14:15:46,867 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-12-01 14:15:47,555 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-12-01 14:15:47,556 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-12-01 14:15:53,011 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-01 14:15:53,013 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMS8wNDM0LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMDc3N30=
2025-12-01 14:15:58,796 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-01 14:15:58,797 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMS8wNDM0LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozOTI5M30=
2025-12-01 14:16:04,540 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-01 14:16:04,541 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMS8wNDM0LyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4OTI5M30=
2025-12-01 14:16:08,577 - app.integrations.defender.api_client - INFO - Fetched 28726 records
2025-12-01 14:16:08,577 - app.integrations.defender.api_client - INFO - Total fetched 178726 records
2025-12-01 14:16:08,578 - app.integrations.defender.service - INFO - Successfully fetched 178726 vulnerability records
2025-12-01 14:16:08,578 - app.integrations.defender.sync - INFO - API returned 178726 vulnerability records
2025-12-01 14:16:08,578 - app.integrations.defender.sync - INFO - Saving 178726 vulnerability records to database...
2025-12-01 14:16:08,578 - app.integrations.defender.repository - INFO - Starting to save 178726 vulnerability records...
2025-12-01 14:16:08,584 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-12-01 14:16:08,592 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-12-01 14:16:08,592 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-12-01 14:16:08,758 - app.integrations.defender.repository - INFO - Temporary table vulnerabilities_temp created successfully
2025-12-01 14:16:08,758 - app.integrations.defender.repository - INFO - Validating and preparing 178726 records for batch insert...
2025-12-01 14:16:08,823 - app.integrations.defender.repository - INFO - Validated 178726 out of 178726 records
2025-12-01 14:16:11,232 - app.integrations.defender.repository - INFO - Inserting 178726 records in batches of 2000...
2025-12-01 14:16:11,686 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-12-01 14:16:11,962 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-12-01 14:16:12,321 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-12-01 14:16:12,563 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-12-01 14:16:12,787 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-12-01 14:16:13,021 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-12-01 14:16:13,550 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-12-01 14:16:13,792 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-12-01 14:16:14,045 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-12-01 14:16:14,336 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-12-01 14:16:14,597 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-12-01 14:16:14,826 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-12-01 14:16:15,067 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-12-01 14:16:15,370 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-12-01 14:16:15,550 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-12-01 14:16:15,752 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-12-01 14:16:15,951 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-12-01 14:16:16,176 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-12-01 14:16:16,468 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-12-01 14:16:16,666 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-12-01 14:16:16,871 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-12-01 14:16:17,062 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-12-01 14:16:17,275 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-12-01 14:16:17,563 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-12-01 14:16:17,746 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-12-01 14:16:17,923 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-12-01 14:16:18,123 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-12-01 14:16:18,405 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-12-01 14:16:18,605 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-12-01 14:16:18,812 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-12-01 14:16:18,997 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-12-01 14:16:19,187 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-12-01 14:16:19,407 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-12-01 14:16:19,601 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-12-01 14:16:19,791 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-12-01 14:16:19,985 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-12-01 14:16:20,167 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-12-01 14:16:20,441 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-12-01 14:16:20,630 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-12-01 14:16:20,816 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-12-01 14:16:21,005 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-12-01 14:16:21,188 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-12-01 14:16:21,442 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-12-01 14:16:21,631 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-12-01 14:16:21,822 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-12-01 14:16:22,020 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-12-01 14:16:22,215 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-12-01 14:16:22,420 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-12-01 14:16:22,669 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-12-01 14:16:22,861 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-12-01 14:16:23,046 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-12-01 14:16:23,246 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-12-01 14:16:23,479 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-12-01 14:16:23,667 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-12-01 14:16:23,858 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-12-01 14:16:24,052 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-12-01 14:16:24,255 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-12-01 14:16:24,480 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-12-01 14:16:24,685 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-12-01 14:16:24,893 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-12-01 14:16:25,090 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-12-01 14:16:25,325 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-12-01 14:16:25,529 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-12-01 14:16:25,726 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-12-01 14:16:25,921 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-12-01 14:16:26,117 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-12-01 14:16:26,396 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-12-01 14:16:26,594 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-12-01 14:16:26,792 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-12-01 14:16:27,004 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-12-01 14:16:27,191 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-12-01 14:16:27,408 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-12-01 14:16:27,682 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-12-01 14:16:27,873 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-12-01 14:16:28,066 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-12-01 14:16:28,333 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-12-01 14:16:28,553 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-12-01 14:16:28,756 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-12-01 14:16:28,951 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-12-01 14:16:29,150 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-12-01 14:16:29,459 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-12-01 14:16:29,696 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-12-01 14:16:29,892 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-12-01 14:16:30,151 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-12-01 14:16:30,405 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-12-01 14:16:30,601 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-12-01 14:16:30,807 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-12-01 14:16:31,007 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-12-01 14:16:31,321 - app.integrations.defender.repository - INFO - Inserted batch 89 (2000 records)
2025-12-01 14:16:31,467 - app.integrations.defender.repository - INFO - Inserted batch 90 (726 records)
2025-12-01 14:16:31,771 - app.integrations.defender.repository - INFO - Successfully inserted 178726 records into temporary table
2025-12-01 14:16:31,771 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-12-01 14:16:31,823 - app.integrations.defender.repository - INFO - Renamed vulnerabilities to vulnerabilities_old
2025-12-01 14:16:31,847 - app.integrations.defender.repository - INFO - Renamed vulnerabilities_temp to vulnerabilities
2025-12-01 14:16:31,881 - app.integrations.defender.repository - INFO - Dropped old table vulnerabilities_old
2025-12-01 14:16:31,882 - app.integrations.defender.repository - INFO - Verifying data was saved correctly...
2025-12-01 14:16:31,927 - app.integrations.defender.repository - INFO - Verification: 178726 records found in vulnerabilities table
2025-12-01 14:16:31,928 - app.integrations.defender.repository - INFO - Data verification successful: 178726 records match expected count
2025-12-01 14:16:31,928 - app.integrations.defender.repository - INFO - Successfully saved 178726 vulnerability records using table switching method
2025-12-01 14:16:31,995 - app.integrations.defender.sync - INFO - Database verification: 178726 records in database after save
2025-12-01 14:16:31,995 - app.integrations.defender.sync - INFO - Device vulnerability details full sync completed, fetched 178726 records, saved 178726 records
2025-12-01 14:16:32,002 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-12-01 14:16:31.995244, type: full, records: 178726
2025-12-01 14:16:32,002 - app.integrations.defender.sync - INFO - Sync time recorded: 2025-12-01 14:16:31.995244, records: 178726
2025-12-01 14:16:32,101 - app.integrations.defender.sync - INFO - Creating snapshot after sync...
2025-12-01 14:16:33,573 - app.integrations.defender.repository - INFO - Recording CVE-Device combinations for snapshot (deduplicating by CVE-Device)...
2025-12-01 14:16:35,881 - app.integrations.defender.repository - INFO - Found 156205 unique CVE-Device combinations after deduplication
2025-12-01 14:16:36,028 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 1 (2000 records)
2025-12-01 14:16:36,111 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 2 (2000 records)
2025-12-01 14:16:36,184 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 3 (2000 records)
2025-12-01 14:16:36,260 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 4 (2000 records)
2025-12-01 14:16:36,375 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 5 (2000 records)
2025-12-01 14:16:36,445 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 6 (2000 records)
2025-12-01 14:16:36,524 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 7 (2000 records)
2025-12-01 14:16:36,598 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 8 (2000 records)
2025-12-01 14:16:36,679 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 9 (2000 records)
2025-12-01 14:16:36,759 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 10 (2000 records)
2025-12-01 14:16:36,832 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 11 (2000 records)
2025-12-01 14:16:36,903 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 12 (2000 records)
2025-12-01 14:16:37,012 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 13 (2000 records)
2025-12-01 14:16:37,096 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 14 (2000 records)
2025-12-01 14:16:37,167 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 15 (2000 records)
2025-12-01 14:16:37,245 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 16 (2000 records)
2025-12-01 14:16:37,349 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 17 (2000 records)
2025-12-01 14:16:37,453 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 18 (2000 records)
2025-12-01 14:16:37,517 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 19 (2000 records)
2025-12-01 14:16:37,586 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 20 (2000 records)
2025-12-01 14:16:37,649 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 21 (2000 records)
2025-12-01 14:16:37,713 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 22 (2000 records)
2025-12-01 14:16:37,785 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 23 (2000 records)
2025-12-01 14:16:37,851 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 24 (2000 records)
2025-12-01 14:16:37,916 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 25 (2000 records)
2025-12-01 14:16:37,979 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 26 (2000 records)
2025-12-01 14:16:38,045 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 27 (2000 records)
2025-12-01 14:16:38,111 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 28 (2000 records)
2025-12-01 14:16:38,176 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 29 (2000 records)
2025-12-01 14:16:38,248 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 30 (2000 records)
2025-12-01 14:16:38,339 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 31 (2000 records)
2025-12-01 14:16:38,482 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 32 (2000 records)
2025-12-01 14:16:38,552 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 33 (2000 records)
2025-12-01 14:16:38,623 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 34 (2000 records)
2025-12-01 14:16:38,700 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 35 (2000 records)
2025-12-01 14:16:38,767 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 36 (2000 records)
2025-12-01 14:16:38,833 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 37 (2000 records)
2025-12-01 14:16:38,903 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 38 (2000 records)
2025-12-01 14:16:38,968 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 39 (2000 records)
2025-12-01 14:16:39,042 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 40 (2000 records)
2025-12-01 14:16:39,108 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 41 (2000 records)
2025-12-01 14:16:39,178 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 42 (2000 records)
2025-12-01 14:16:39,245 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 43 (2000 records)
2025-12-01 14:16:39,312 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 44 (2000 records)
2025-12-01 14:16:39,440 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 45 (2000 records)
2025-12-01 14:16:39,510 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 46 (2000 records)
2025-12-01 14:16:39,579 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 47 (2000 records)
2025-12-01 14:16:39,643 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 48 (2000 records)
2025-12-01 14:16:39,708 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 49 (2000 records)
2025-12-01 14:16:39,777 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 50 (2000 records)
2025-12-01 14:16:39,842 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 51 (2000 records)
2025-12-01 14:16:39,917 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 52 (2000 records)
2025-12-01 14:16:39,989 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 53 (2000 records)
2025-12-01 14:16:40,054 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 54 (2000 records)
2025-12-01 14:16:40,120 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 55 (2000 records)
2025-12-01 14:16:40,186 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 56 (2000 records)
2025-12-01 14:16:40,265 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 57 (2000 records)
2025-12-01 14:16:40,381 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 58 (2000 records)
2025-12-01 14:16:40,462 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 59 (2000 records)
2025-12-01 14:16:40,526 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 60 (2000 records)
2025-12-01 14:16:40,600 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 61 (2000 records)
2025-12-01 14:16:40,674 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 62 (2000 records)
2025-12-01 14:16:40,745 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 63 (2000 records)
2025-12-01 14:16:40,811 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 64 (2000 records)
2025-12-01 14:16:40,884 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 65 (2000 records)
2025-12-01 14:16:40,948 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 66 (2000 records)
2025-12-01 14:16:41,018 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 67 (2000 records)
2025-12-01 14:16:41,085 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 68 (2000 records)
2025-12-01 14:16:41,152 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 69 (2000 records)
2025-12-01 14:16:41,215 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 70 (2000 records)
2025-12-01 14:16:41,287 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 71 (2000 records)
2025-12-01 14:16:41,432 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 72 (2000 records)
2025-12-01 14:16:41,503 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 73 (2000 records)
2025-12-01 14:16:41,568 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 74 (2000 records)
2025-12-01 14:16:41,639 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 75 (2000 records)
2025-12-01 14:16:41,704 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 76 (2000 records)
2025-12-01 14:16:41,771 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 77 (2000 records)
2025-12-01 14:16:41,834 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 78 (2000 records)
2025-12-01 14:16:41,841 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 79 (205 records)
2025-12-01 14:16:41,892 - app.integrations.defender.repository - INFO - Snapshot recorded successfully, snapshot ID: 9, CVE-Device records: 156205
2025-12-01 14:16:41,918 - app.integrations.defender.sync - INFO - Snapshot created successfully with ID: 9
2025-12-01 14:16:41,918 - app.integrations.defender.sync - INFO - Full sync completed successfully
2025-12-01 14:16:41,918 - app.integrations.defender.sync - INFO - Full sync process completed successfully
2025-12-01 14:16:41,919 - app.integrations.defender.sync - INFO - Database connection closed
2025-12-01 14:16:41,919 - app.integrations.defender.sync - INFO - Vulnerability data sync completed successfully
2025-12-02 14:09:56,484 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-12-02 14:09:56,509 - mysql.connector - INFO - package: mysql.connector.plugins
2025-12-02 14:09:56,509 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-12-02 14:09:56,509 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-12-02 14:09:56,513 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-12-02 14:09:56,513 - app.integrations.defender.sync - INFO - Initializing database...
2025-12-02 14:09:56,515 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-12-02 14:09:56,515 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-12-02 14:09:56,515 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-12-02 14:09:56,517 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-12-02 14:09:56,521 - app.integrations.defender.database - INFO - vulnerabilities table exists, checking for autopatch_covered column...
2025-12-02 14:09:56,522 - app.integrations.defender.database - INFO - vulnerabilities table already has autopatch_covered column
2025-12-02 14:09:56,523 - app.integrations.defender.database - INFO - vulnerabilities already has metasploit_detected column
2025-12-02 14:09:56,524 - app.integrations.defender.database - INFO - vulnerabilities already has nuclei_detected column
2025-12-02 14:09:56,539 - app.integrations.defender.database - INFO - Index idx_cve_epss already exists
2025-12-02 14:09:56,540 - app.integrations.defender.database - INFO - Index idx_cve_published_on already exists
2025-12-02 14:09:56,583 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-12-02 14:09:56,583 - app.integrations.defender.sync - INFO - Database initialization completed
2025-12-02 14:09:56,584 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-12-02 14:09:56,584 - app.integrations.defender.sync - INFO - Starting full sync...
2025-12-02 14:09:56,584 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-12-02 14:09:56,584 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-12-02 14:09:57,202 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-12-02 14:09:57,202 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-12-02 14:10:01,911 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-02 14:10:01,912 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMi8wNTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMDkyOX0=
2025-12-02 14:10:07,419 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-02 14:10:07,420 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMi8wNTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozOTUyNH0=
2025-12-02 14:10:13,880 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-02 14:10:13,881 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMi8wNTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4OTUyNH0=
2025-12-02 14:10:19,413 - app.integrations.defender.api_client - INFO - Fetched 26640 records
2025-12-02 14:10:19,415 - app.integrations.defender.api_client - INFO - Total fetched 176640 records
2025-12-02 14:10:19,416 - app.integrations.defender.service - INFO - Successfully fetched 176640 vulnerability records
2025-12-02 14:10:19,416 - app.integrations.defender.sync - INFO - API returned 176640 vulnerability records
2025-12-02 14:10:19,416 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=200
2025-12-02 14:10:25,214 - app.integrations.defender.api_client - INFO - Fetched 200 catalog records
2025-12-02 14:10:25,215 - app.integrations.defender.api_client - INFO - Total fetched 200 vulnerability catalog records
2025-12-02 14:10:25,217 - app.integrations.defender.service - INFO - Successfully fetched 200 catalog records
2025-12-02 14:10:25,341 - app.integrations.defender.sync - INFO - Attached catalog metadata to 70 out of 176640 vulnerability records
2025-12-02 14:10:25,341 - app.integrations.defender.sync - INFO - Saving 176640 vulnerability records to database...
2025-12-02 14:10:25,341 - app.integrations.defender.repository - INFO - Starting to save 176640 vulnerability records...
2025-12-02 14:10:25,343 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-12-02 14:10:25,346 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-12-02 14:10:25,346 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-12-02 14:10:25,559 - app.integrations.defender.repository - INFO - Temporary table vulnerabilities_temp created successfully
2025-12-02 14:10:25,559 - app.integrations.defender.repository - INFO - Validating and preparing 176640 records for batch insert...
2025-12-02 14:10:25,596 - app.integrations.defender.repository - INFO - Validated 176640 out of 176640 records
2025-12-02 14:10:28,621 - app.integrations.defender.repository - INFO - Inserting 176640 records in batches of 2000...
2025-12-02 14:10:29,294 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-12-02 14:10:29,644 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-12-02 14:10:29,982 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-12-02 14:10:30,368 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-12-02 14:10:30,693 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-12-02 14:10:30,990 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-12-02 14:10:31,409 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-12-02 14:10:31,801 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-12-02 14:10:32,096 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-12-02 14:10:32,454 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-12-02 14:10:32,750 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-12-02 14:10:33,081 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-12-02 14:10:33,417 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-12-02 14:10:33,671 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-12-02 14:10:33,924 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-12-02 14:10:34,265 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-12-02 14:10:34,541 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-12-02 14:10:34,892 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-12-02 14:10:35,138 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-12-02 14:10:35,455 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-12-02 14:10:35,725 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-12-02 14:10:36,002 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-12-02 14:10:36,381 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-12-02 14:10:36,895 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-12-02 14:10:37,235 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-12-02 14:10:37,496 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-12-02 14:10:37,774 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-12-02 14:10:38,042 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-12-02 14:10:38,543 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-12-02 14:10:38,828 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-12-02 14:10:39,096 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-12-02 14:10:39,455 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-12-02 14:10:39,722 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-12-02 14:10:39,985 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-12-02 14:10:40,283 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-12-02 14:10:40,672 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-12-02 14:10:40,916 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-12-02 14:10:41,170 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-12-02 14:10:41,476 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-12-02 14:10:41,742 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-12-02 14:10:41,990 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-12-02 14:10:42,419 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-12-02 14:10:42,739 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-12-02 14:10:42,992 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-12-02 14:10:43,264 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-12-02 14:10:43,534 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-12-02 14:10:43,799 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-12-02 14:10:44,057 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-12-02 14:10:44,527 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-12-02 14:10:44,789 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-12-02 14:10:45,053 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-12-02 14:10:45,464 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-12-02 14:10:45,781 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-12-02 14:10:46,048 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-12-02 14:10:46,355 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-12-02 14:10:46,738 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-12-02 14:10:47,011 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-12-02 14:10:47,327 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-12-02 14:10:47,603 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-12-02 14:10:47,861 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-12-02 14:10:48,111 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-12-02 14:10:48,658 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-12-02 14:10:48,967 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-12-02 14:10:49,245 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-12-02 14:10:49,705 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-12-02 14:10:49,975 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-12-02 14:10:50,304 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-12-02 14:10:50,611 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-12-02 14:10:50,873 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-12-02 14:10:51,142 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-12-02 14:10:51,477 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-12-02 14:10:51,765 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-12-02 14:10:52,027 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-12-02 14:10:52,326 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-12-02 14:10:52,604 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-12-02 14:10:52,879 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-12-02 14:10:53,138 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-12-02 14:10:53,521 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-12-02 14:10:53,777 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-12-02 14:10:54,044 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-12-02 14:10:54,340 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-12-02 14:10:54,618 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-12-02 14:10:54,884 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-12-02 14:10:55,149 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-12-02 14:10:55,495 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-12-02 14:10:55,759 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-12-02 14:10:56,021 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-12-02 14:10:56,341 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-12-02 14:10:56,444 - app.integrations.defender.repository - INFO - Inserted batch 89 (640 records)
2025-12-02 14:10:56,718 - app.integrations.defender.repository - INFO - Successfully inserted 176640 records into temporary table
2025-12-02 14:10:56,718 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-12-02 14:10:56,845 - app.integrations.defender.repository - INFO - Renamed vulnerabilities to vulnerabilities_old
2025-12-02 14:10:56,861 - app.integrations.defender.repository - INFO - Renamed vulnerabilities_temp to vulnerabilities
2025-12-02 14:10:56,908 - app.integrations.defender.repository - INFO - Dropped old table vulnerabilities_old
2025-12-02 14:10:56,909 - app.integrations.defender.repository - INFO - Verifying data was saved correctly...
2025-12-02 14:10:56,976 - app.integrations.defender.repository - INFO - Verification: 176640 records found in vulnerabilities table
2025-12-02 14:10:56,977 - app.integrations.defender.repository - INFO - Data verification successful: 176640 records match expected count
2025-12-02 14:10:56,977 - app.integrations.defender.repository - INFO - Successfully saved 176640 vulnerability records using table switching method
2025-12-02 14:10:57,102 - app.integrations.defender.sync - INFO - Database verification: 176640 records in database after save
2025-12-02 14:10:57,103 - app.integrations.defender.sync - INFO - Device vulnerability details full sync completed, fetched 176640 records, saved 176640 records
2025-12-02 14:10:57,108 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-12-02 14:10:57.103180, type: full, records: 176640
2025-12-02 14:10:57,108 - app.integrations.defender.sync - INFO - Sync time recorded: 2025-12-02 14:10:57.103180, records: 176640
2025-12-02 14:10:57,207 - app.integrations.defender.sync - INFO - Creating snapshot after sync...
2025-12-02 14:10:59,696 - app.integrations.defender.repository - INFO - Recording CVE-Device combinations for snapshot (deduplicating by CVE-Device)...
2025-12-02 14:11:02,024 - app.integrations.defender.repository - INFO - Found 154301 unique CVE-Device combinations after deduplication
2025-12-02 14:11:02,179 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 1 (2000 records)
2025-12-02 14:11:02,312 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 2 (2000 records)
2025-12-02 14:11:02,396 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 3 (2000 records)
2025-12-02 14:11:02,472 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 4 (2000 records)
2025-12-02 14:11:02,550 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 5 (2000 records)
2025-12-02 14:11:02,627 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 6 (2000 records)
2025-12-02 14:11:02,706 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 7 (2000 records)
2025-12-02 14:11:02,790 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 8 (2000 records)
2025-12-02 14:11:02,875 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 9 (2000 records)
2025-12-02 14:11:02,962 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 10 (2000 records)
2025-12-02 14:11:03,049 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 11 (2000 records)
2025-12-02 14:11:03,126 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 12 (2000 records)
2025-12-02 14:11:03,432 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 13 (2000 records)
2025-12-02 14:11:03,542 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 14 (2000 records)
2025-12-02 14:11:03,633 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 15 (2000 records)
2025-12-02 14:11:03,719 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 16 (2000 records)
2025-12-02 14:11:03,797 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 17 (2000 records)
2025-12-02 14:11:03,884 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 18 (2000 records)
2025-12-02 14:11:03,958 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 19 (2000 records)
2025-12-02 14:11:04,048 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 20 (2000 records)
2025-12-02 14:11:04,130 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 21 (2000 records)
2025-12-02 14:11:04,216 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 22 (2000 records)
2025-12-02 14:11:04,356 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 23 (2000 records)
2025-12-02 14:11:04,500 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 24 (2000 records)
2025-12-02 14:11:04,588 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 25 (2000 records)
2025-12-02 14:11:04,661 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 26 (2000 records)
2025-12-02 14:11:04,735 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 27 (2000 records)
2025-12-02 14:11:04,810 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 28 (2000 records)
2025-12-02 14:11:04,885 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 29 (2000 records)
2025-12-02 14:11:04,955 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 30 (2000 records)
2025-12-02 14:11:05,032 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 31 (2000 records)
2025-12-02 14:11:05,108 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 32 (2000 records)
2025-12-02 14:11:05,188 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 33 (2000 records)
2025-12-02 14:11:05,357 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 34 (2000 records)
2025-12-02 14:11:05,433 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 35 (2000 records)
2025-12-02 14:11:05,509 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 36 (2000 records)
2025-12-02 14:11:05,584 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 37 (2000 records)
2025-12-02 14:11:05,660 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 38 (2000 records)
2025-12-02 14:11:05,735 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 39 (2000 records)
2025-12-02 14:11:05,812 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 40 (2000 records)
2025-12-02 14:11:05,895 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 41 (2000 records)
2025-12-02 14:11:05,977 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 42 (2000 records)
2025-12-02 14:11:06,049 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 43 (2000 records)
2025-12-02 14:11:06,120 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 44 (2000 records)
2025-12-02 14:11:06,194 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 45 (2000 records)
2025-12-02 14:11:06,364 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 46 (2000 records)
2025-12-02 14:11:06,440 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 47 (2000 records)
2025-12-02 14:11:06,514 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 48 (2000 records)
2025-12-02 14:11:06,590 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 49 (2000 records)
2025-12-02 14:11:06,662 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 50 (2000 records)
2025-12-02 14:11:06,739 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 51 (2000 records)
2025-12-02 14:11:06,810 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 52 (2000 records)
2025-12-02 14:11:06,887 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 53 (2000 records)
2025-12-02 14:11:06,956 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 54 (2000 records)
2025-12-02 14:11:07,029 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 55 (2000 records)
2025-12-02 14:11:07,108 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 56 (2000 records)
2025-12-02 14:11:07,182 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 57 (2000 records)
2025-12-02 14:11:07,454 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 58 (2000 records)
2025-12-02 14:11:07,530 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 59 (2000 records)
2025-12-02 14:11:07,601 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 60 (2000 records)
2025-12-02 14:11:07,676 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 61 (2000 records)
2025-12-02 14:11:07,750 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 62 (2000 records)
2025-12-02 14:11:07,825 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 63 (2000 records)
2025-12-02 14:11:07,901 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 64 (2000 records)
2025-12-02 14:11:07,979 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 65 (2000 records)
2025-12-02 14:11:08,061 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 66 (2000 records)
2025-12-02 14:11:08,133 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 67 (2000 records)
2025-12-02 14:11:08,218 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 68 (2000 records)
2025-12-02 14:11:08,377 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 69 (2000 records)
2025-12-02 14:11:08,450 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 70 (2000 records)
2025-12-02 14:11:08,520 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 71 (2000 records)
2025-12-02 14:11:08,709 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 72 (2000 records)
2025-12-02 14:11:08,783 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 73 (2000 records)
2025-12-02 14:11:08,856 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 74 (2000 records)
2025-12-02 14:11:08,933 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 75 (2000 records)
2025-12-02 14:11:09,061 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 76 (2000 records)
2025-12-02 14:11:09,140 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 77 (2000 records)
2025-12-02 14:11:09,151 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 78 (301 records)
2025-12-02 14:11:09,227 - app.integrations.defender.repository - INFO - Snapshot recorded successfully, snapshot ID: 10, CVE-Device records: 154301
2025-12-02 14:11:09,252 - app.integrations.defender.sync - INFO - Snapshot created successfully with ID: 10
2025-12-02 14:11:09,252 - app.integrations.defender.sync - INFO - Full sync completed successfully
2025-12-02 14:11:09,252 - app.integrations.defender.sync - INFO - Full sync process completed successfully
2025-12-02 14:11:09,256 - app.integrations.defender.sync - INFO - Database connection closed
2025-12-02 14:11:09,256 - app.integrations.defender.sync - INFO - Vulnerability data sync completed successfully
2025-12-02 14:39:48,033 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-12-02 14:39:48,052 - mysql.connector - INFO - package: mysql.connector.plugins
2025-12-02 14:39:48,052 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-12-02 14:39:48,053 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-12-02 14:39:48,055 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-12-02 14:39:48,055 - app.integrations.defender.sync - INFO - Initializing database...
2025-12-02 14:39:48,057 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-12-02 14:39:48,057 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-12-02 14:39:48,057 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-12-02 14:39:48,059 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-12-02 14:39:48,061 - app.integrations.defender.database - INFO - vulnerabilities table exists, checking for autopatch_covered column...
2025-12-02 14:39:48,063 - app.integrations.defender.database - INFO - vulnerabilities table already has autopatch_covered column
2025-12-02 14:39:48,066 - app.integrations.defender.database - INFO - vulnerabilities already has metasploit_detected column
2025-12-02 14:39:48,067 - app.integrations.defender.database - INFO - vulnerabilities already has nuclei_detected column
2025-12-02 14:39:48,137 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-12-02 14:39:48,137 - app.integrations.defender.sync - INFO - Database initialization completed
2025-12-02 14:39:48,137 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-12-02 14:39:48,137 - app.integrations.defender.sync - INFO - Starting full sync...
2025-12-02 14:39:48,137 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-12-02 14:39:48,137 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-12-02 14:39:48,763 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-12-02 14:39:48,764 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-12-02 14:39:54,803 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-02 14:39:54,804 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMi8wNTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMDkyOX0=
2025-12-02 14:40:00,451 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-02 14:40:00,451 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMi8wNTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozOTUyNH0=
2025-12-02 14:40:06,437 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-02 14:40:06,438 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMi8wNTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4OTUyNH0=
2025-12-02 14:40:10,569 - app.integrations.defender.api_client - INFO - Fetched 26640 records
2025-12-02 14:40:10,569 - app.integrations.defender.api_client - INFO - Total fetched 176640 records
2025-12-02 14:40:10,570 - app.integrations.defender.service - INFO - Successfully fetched 176640 vulnerability records
2025-12-02 14:40:10,570 - app.integrations.defender.sync - INFO - API returned 176640 vulnerability records
2025-12-02 14:40:10,570 - app.integrations.defender.sync - INFO - Saving 176640 vulnerability records to database...
2025-12-02 14:40:10,570 - app.integrations.defender.repository - INFO - Starting to save 176640 vulnerability records...
2025-12-02 14:40:10,577 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-12-02 14:40:10,591 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-12-02 14:40:10,591 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-12-02 14:40:10,767 - app.integrations.defender.repository - INFO - Temporary table vulnerabilities_temp created successfully
2025-12-02 14:40:10,767 - app.integrations.defender.repository - INFO - Validating and preparing 176640 records for batch insert...
2025-12-02 14:40:10,840 - app.integrations.defender.repository - INFO - Validated 176640 out of 176640 records
2025-12-02 14:40:13,331 - app.integrations.defender.repository - INFO - Inserting 176640 records in batches of 2000...
2025-12-02 14:40:13,765 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-12-02 14:40:14,141 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-12-02 14:40:14,523 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-12-02 14:40:14,791 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-12-02 14:40:15,107 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-12-02 14:40:15,404 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-12-02 14:40:15,701 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-12-02 14:40:16,200 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-12-02 14:40:16,476 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-12-02 14:40:16,993 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-12-02 14:40:17,285 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-12-02 14:40:17,597 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-12-02 14:40:17,822 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-12-02 14:40:18,146 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-12-02 14:40:18,380 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-12-02 14:40:18,610 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-12-02 14:40:18,842 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-12-02 14:40:19,130 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-12-02 14:40:19,357 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-12-02 14:40:19,582 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-12-02 14:40:19,850 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-12-02 14:40:20,125 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-12-02 14:40:20,451 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-12-02 14:40:20,750 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-12-02 14:40:21,124 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-12-02 14:40:21,364 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-12-02 14:40:21,613 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-12-02 14:40:21,929 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-12-02 14:40:22,309 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-12-02 14:40:22,543 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-12-02 14:40:22,806 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-12-02 14:40:23,119 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-12-02 14:40:23,421 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-12-02 14:40:23,661 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-12-02 14:40:23,885 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-12-02 14:40:24,209 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-12-02 14:40:24,425 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-12-02 14:40:24,634 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-12-02 14:40:24,858 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-12-02 14:40:25,209 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-12-02 14:40:25,425 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-12-02 14:40:25,643 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-12-02 14:40:25,882 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-12-02 14:40:26,263 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-12-02 14:40:26,517 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-12-02 14:40:26,748 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-12-02 14:40:26,980 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-12-02 14:40:27,213 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-12-02 14:40:27,443 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-12-02 14:40:27,692 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-12-02 14:40:27,931 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-12-02 14:40:28,333 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-12-02 14:40:28,565 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-12-02 14:40:28,792 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-12-02 14:40:29,099 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-12-02 14:40:29,342 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-12-02 14:40:29,590 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-12-02 14:40:29,811 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-12-02 14:40:30,085 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-12-02 14:40:30,381 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-12-02 14:40:30,626 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-12-02 14:40:30,866 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-12-02 14:40:31,272 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-12-02 14:40:31,546 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-12-02 14:40:31,779 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-12-02 14:40:32,065 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-12-02 14:40:32,303 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-12-02 14:40:32,527 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-12-02 14:40:32,818 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-12-02 14:40:33,122 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-12-02 14:40:33,385 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-12-02 14:40:33,627 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-12-02 14:40:33,876 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-12-02 14:40:34,153 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-12-02 14:40:34,462 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-12-02 14:40:34,693 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-12-02 14:40:34,995 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-12-02 14:40:35,369 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-12-02 14:40:35,623 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-12-02 14:40:35,859 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-12-02 14:40:36,168 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-12-02 14:40:36,468 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-12-02 14:40:36,737 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-12-02 14:40:37,155 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-12-02 14:40:37,432 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-12-02 14:40:37,722 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-12-02 14:40:37,970 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-12-02 14:40:38,312 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-12-02 14:40:38,429 - app.integrations.defender.repository - INFO - Inserted batch 89 (640 records)
2025-12-02 14:40:38,746 - app.integrations.defender.repository - INFO - Successfully inserted 176640 records into temporary table
2025-12-02 14:40:38,747 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-12-02 14:40:38,833 - app.integrations.defender.repository - INFO - Renamed vulnerabilities to vulnerabilities_old
2025-12-02 14:40:38,863 - app.integrations.defender.repository - INFO - Renamed vulnerabilities_temp to vulnerabilities
2025-12-02 14:40:38,896 - app.integrations.defender.repository - INFO - Dropped old table vulnerabilities_old
2025-12-02 14:40:38,897 - app.integrations.defender.repository - INFO - Verifying data was saved correctly...
2025-12-02 14:40:38,942 - app.integrations.defender.repository - INFO - Verification: 176640 records found in vulnerabilities table
2025-12-02 14:40:38,943 - app.integrations.defender.repository - INFO - Data verification successful: 176640 records match expected count
2025-12-02 14:40:38,943 - app.integrations.defender.repository - INFO - Successfully saved 176640 vulnerability records using table switching method
2025-12-02 14:40:39,098 - app.integrations.defender.sync - INFO - Database verification: 176640 records in database after save
2025-12-02 14:40:39,098 - app.integrations.defender.sync - INFO - Device vulnerability details full sync completed, fetched 176640 records, saved 176640 records
2025-12-02 14:40:39,112 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-12-02 14:40:39.098234, type: full, records: 176640
2025-12-02 14:40:39,112 - app.integrations.defender.sync - INFO - Sync time recorded: 2025-12-02 14:40:39.098234, records: 176640
2025-12-02 14:40:39,215 - app.integrations.defender.sync - INFO - Starting vulnerability catalog sync...
2025-12-02 14:40:39,215 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=200
2025-12-02 14:41:07,252 - app.integrations.defender.api_client - INFO - Fetched 200 catalog records
2025-12-02 14:41:07,253 - app.integrations.defender.api_client - INFO - Total fetched 200 vulnerability catalog records
2025-12-02 14:41:07,254 - app.integrations.defender.service - INFO - Successfully fetched 200 catalog records
2025-12-02 14:41:07,254 - app.integrations.defender.sync - INFO - Catalog API returned 200 records
2025-12-02 14:41:07,381 - app.integrations.defender.repository - INFO - Saved/updated 200 catalog records
2025-12-02 14:41:07,385 - app.integrations.defender.sync - INFO - Catalog sync completed, 200 records saved
2025-12-02 14:41:07,386 - app.integrations.defender.sync - INFO - Creating snapshot after sync...
2025-12-02 14:41:09,210 - app.integrations.defender.repository - INFO - Recording CVE-Device combinations for snapshot (deduplicating by CVE-Device)...
2025-12-02 14:41:11,541 - app.integrations.defender.repository - INFO - Found 154301 unique CVE-Device combinations after deduplication
2025-12-02 14:41:11,988 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 1 (2000 records)
2025-12-02 14:41:12,167 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 2 (2000 records)
2025-12-02 14:41:12,414 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 3 (2000 records)
2025-12-02 14:41:12,503 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 4 (2000 records)
2025-12-02 14:41:12,591 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 5 (2000 records)
2025-12-02 14:41:12,683 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 6 (2000 records)
2025-12-02 14:41:12,809 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 7 (2000 records)
2025-12-02 14:41:12,960 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 8 (2000 records)
2025-12-02 14:41:13,074 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 9 (2000 records)
2025-12-02 14:41:13,190 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 10 (2000 records)
2025-12-02 14:41:13,356 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 11 (2000 records)
2025-12-02 14:41:13,456 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 12 (2000 records)
2025-12-02 14:41:13,632 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 13 (2000 records)
2025-12-02 14:41:13,726 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 14 (2000 records)
2025-12-02 14:41:13,817 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 15 (2000 records)
2025-12-02 14:41:13,899 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 16 (2000 records)
2025-12-02 14:41:13,980 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 17 (2000 records)
2025-12-02 14:41:14,061 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 18 (2000 records)
2025-12-02 14:41:14,141 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 19 (2000 records)
2025-12-02 14:41:14,260 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 20 (2000 records)
2025-12-02 14:41:14,395 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 21 (2000 records)
2025-12-02 14:41:14,483 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 22 (2000 records)
2025-12-02 14:41:14,573 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 23 (2000 records)
2025-12-02 14:41:14,655 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 24 (2000 records)
2025-12-02 14:41:14,727 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 25 (2000 records)
2025-12-02 14:41:14,801 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 26 (2000 records)
2025-12-02 14:41:14,889 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 27 (2000 records)
2025-12-02 14:41:14,974 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 28 (2000 records)
2025-12-02 14:41:15,045 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 29 (2000 records)
2025-12-02 14:41:15,137 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 30 (2000 records)
2025-12-02 14:41:15,248 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 31 (2000 records)
2025-12-02 14:41:15,464 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 32 (2000 records)
2025-12-02 14:41:15,553 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 33 (2000 records)
2025-12-02 14:41:15,633 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 34 (2000 records)
2025-12-02 14:41:15,761 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 35 (2000 records)
2025-12-02 14:41:15,836 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 36 (2000 records)
2025-12-02 14:41:15,912 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 37 (2000 records)
2025-12-02 14:41:15,990 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 38 (2000 records)
2025-12-02 14:41:16,064 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 39 (2000 records)
2025-12-02 14:41:16,137 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 40 (2000 records)
2025-12-02 14:41:16,331 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 41 (2000 records)
2025-12-02 14:41:16,405 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 42 (2000 records)
2025-12-02 14:41:16,482 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 43 (2000 records)
2025-12-02 14:41:16,549 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 44 (2000 records)
2025-12-02 14:41:16,622 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 45 (2000 records)
2025-12-02 14:41:16,694 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 46 (2000 records)
2025-12-02 14:41:16,769 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 47 (2000 records)
2025-12-02 14:41:16,845 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 48 (2000 records)
2025-12-02 14:41:16,915 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 49 (2000 records)
2025-12-02 14:41:16,989 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 50 (2000 records)
2025-12-02 14:41:17,069 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 51 (2000 records)
2025-12-02 14:41:17,145 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 52 (2000 records)
2025-12-02 14:41:17,342 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 53 (2000 records)
2025-12-02 14:41:17,448 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 54 (2000 records)
2025-12-02 14:41:17,524 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 55 (2000 records)
2025-12-02 14:41:17,595 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 56 (2000 records)
2025-12-02 14:41:17,672 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 57 (2000 records)
2025-12-02 14:41:17,748 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 58 (2000 records)
2025-12-02 14:41:17,822 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 59 (2000 records)
2025-12-02 14:41:17,897 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 60 (2000 records)
2025-12-02 14:41:17,971 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 61 (2000 records)
2025-12-02 14:41:18,047 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 62 (2000 records)
2025-12-02 14:41:18,118 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 63 (2000 records)
2025-12-02 14:41:18,195 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 64 (2000 records)
2025-12-02 14:41:18,378 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 65 (2000 records)
2025-12-02 14:41:18,453 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 66 (2000 records)
2025-12-02 14:41:18,525 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 67 (2000 records)
2025-12-02 14:41:18,611 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 68 (2000 records)
2025-12-02 14:41:18,684 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 69 (2000 records)
2025-12-02 14:41:18,765 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 70 (2000 records)
2025-12-02 14:41:18,836 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 71 (2000 records)
2025-12-02 14:41:18,910 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 72 (2000 records)
2025-12-02 14:41:18,982 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 73 (2000 records)
2025-12-02 14:41:19,056 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 74 (2000 records)
2025-12-02 14:41:19,132 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 75 (2000 records)
2025-12-02 14:41:19,299 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 76 (2000 records)
2025-12-02 14:41:19,377 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 77 (2000 records)
2025-12-02 14:41:19,389 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 78 (301 records)
2025-12-02 14:41:19,446 - app.integrations.defender.repository - INFO - Snapshot recorded successfully, snapshot ID: 11, CVE-Device records: 154301
2025-12-02 14:41:19,478 - app.integrations.defender.sync - INFO - Snapshot created successfully with ID: 11
2025-12-02 14:41:19,478 - app.integrations.defender.sync - INFO - Full sync completed successfully
2025-12-02 14:41:19,478 - app.integrations.defender.sync - INFO - Full sync process completed successfully
2025-12-02 14:41:19,480 - app.integrations.defender.sync - INFO - Database connection closed
2025-12-02 14:41:19,480 - app.integrations.defender.sync - INFO - Vulnerability data sync completed successfully
2025-12-02 14:48:49,356 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-12-02 14:48:49,404 - mysql.connector - INFO - package: mysql.connector.plugins
2025-12-02 14:48:49,404 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-12-02 14:48:49,404 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-12-02 14:48:49,411 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-12-02 14:48:49,411 - app.integrations.defender.sync - INFO - Initializing database...
2025-12-02 14:48:49,417 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-12-02 14:48:49,417 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-12-02 14:48:49,417 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-12-02 14:48:49,420 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-12-02 14:48:49,421 - app.integrations.defender.database - INFO - vulnerabilities table exists, checking for autopatch_covered column...
2025-12-02 14:48:49,421 - app.integrations.defender.database - INFO - vulnerabilities table already has autopatch_covered column
2025-12-02 14:48:49,422 - app.integrations.defender.database - INFO - vulnerabilities already has metasploit_detected column
2025-12-02 14:48:49,423 - app.integrations.defender.database - INFO - vulnerabilities already has nuclei_detected column
2025-12-02 14:48:49,502 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-12-02 14:48:49,502 - app.integrations.defender.sync - INFO - Database initialization completed
2025-12-02 14:48:49,502 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-12-02 14:48:49,502 - app.integrations.defender.sync - INFO - Starting full sync...
2025-12-02 14:48:49,502 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-12-02 14:48:49,502 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-12-02 14:48:50,177 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-12-02 14:48:50,177 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-12-02 14:48:56,154 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-02 14:48:56,155 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMi8wNTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMDkyOX0=
2025-12-02 14:49:01,524 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-02 14:49:01,524 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMi8wNTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozOTUyNH0=
2025-12-02 14:49:07,023 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-02 14:49:07,024 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMi8wNTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4OTUyNH0=
2025-12-02 14:49:10,945 - app.integrations.defender.api_client - INFO - Fetched 26640 records
2025-12-02 14:49:10,946 - app.integrations.defender.api_client - INFO - Total fetched 176640 records
2025-12-02 14:49:10,946 - app.integrations.defender.service - INFO - Successfully fetched 176640 vulnerability records
2025-12-02 14:49:10,946 - app.integrations.defender.sync - INFO - API returned 176640 vulnerability records
2025-12-02 14:49:10,946 - app.integrations.defender.sync - INFO - Saving 176640 vulnerability records to database...
2025-12-02 14:49:10,946 - app.integrations.defender.repository - INFO - Starting to save 176640 vulnerability records...
2025-12-02 14:49:10,956 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-12-02 14:49:10,964 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-12-02 14:49:10,964 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-12-02 14:49:11,204 - app.integrations.defender.repository - INFO - Temporary table vulnerabilities_temp created successfully
2025-12-02 14:49:11,204 - app.integrations.defender.repository - INFO - Validating and preparing 176640 records for batch insert...
2025-12-02 14:49:11,294 - app.integrations.defender.repository - INFO - Validated 176640 out of 176640 records
2025-12-02 14:49:13,950 - app.integrations.defender.repository - INFO - Inserting 176640 records in batches of 2000...
2025-12-02 14:49:14,381 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-12-02 14:49:14,664 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-12-02 14:49:14,935 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-12-02 14:49:15,175 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-12-02 14:49:15,388 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-12-02 14:49:15,703 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-12-02 14:49:15,924 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-12-02 14:49:16,142 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-12-02 14:49:16,365 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-12-02 14:49:16,643 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-12-02 14:49:16,881 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-12-02 14:49:17,123 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-12-02 14:49:17,348 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-12-02 14:49:17,636 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-12-02 14:49:17,848 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-12-02 14:49:18,075 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-12-02 14:49:18,298 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-12-02 14:49:18,712 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-12-02 14:49:18,923 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-12-02 14:49:19,132 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-12-02 14:49:19,378 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-12-02 14:49:19,693 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-12-02 14:49:19,966 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-12-02 14:49:20,192 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-12-02 14:49:20,480 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-12-02 14:49:20,701 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-12-02 14:49:20,953 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-12-02 14:49:21,181 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-12-02 14:49:21,413 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-12-02 14:49:21,760 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-12-02 14:49:21,977 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-12-02 14:49:22,203 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-12-02 14:49:22,419 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-12-02 14:49:22,755 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-12-02 14:49:22,972 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-12-02 14:49:23,200 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-12-02 14:49:23,418 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-12-02 14:49:23,717 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-12-02 14:49:23,947 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-12-02 14:49:24,189 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-12-02 14:49:24,408 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-12-02 14:49:24,723 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-12-02 14:49:24,945 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-12-02 14:49:25,155 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-12-02 14:49:25,374 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-12-02 14:49:25,759 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-12-02 14:49:26,012 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-12-02 14:49:26,241 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-12-02 14:49:26,483 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-12-02 14:49:26,845 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-12-02 14:49:27,119 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-12-02 14:49:27,348 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-12-02 14:49:27,713 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-12-02 14:49:27,940 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-12-02 14:49:28,168 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-12-02 14:49:28,386 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-12-02 14:49:28,656 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-12-02 14:49:28,924 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-12-02 14:49:29,147 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-12-02 14:49:29,394 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-12-02 14:49:29,659 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-12-02 14:49:30,002 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-12-02 14:49:30,232 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-12-02 14:49:30,459 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-12-02 14:49:30,818 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-12-02 14:49:31,059 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-12-02 14:49:31,292 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-12-02 14:49:31,520 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-12-02 14:49:31,799 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-12-02 14:49:32,101 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-12-02 14:49:32,318 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-12-02 14:49:32,614 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-12-02 14:49:32,846 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-12-02 14:49:33,132 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-12-02 14:49:33,364 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-12-02 14:49:33,624 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-12-02 14:49:33,902 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-12-02 14:49:34,152 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-12-02 14:49:34,503 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-12-02 14:49:34,811 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-12-02 14:49:35,187 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-12-02 14:49:35,405 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-12-02 14:49:35,754 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-12-02 14:49:35,979 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-12-02 14:49:36,250 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-12-02 14:49:36,542 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-12-02 14:49:36,916 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-12-02 14:49:37,172 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-12-02 14:49:37,337 - app.integrations.defender.repository - INFO - Inserted batch 89 (640 records)
2025-12-02 14:49:37,627 - app.integrations.defender.repository - INFO - Successfully inserted 176640 records into temporary table
2025-12-02 14:49:37,628 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-12-02 14:49:37,814 - app.integrations.defender.repository - INFO - Renamed vulnerabilities to vulnerabilities_old
2025-12-02 14:49:37,855 - app.integrations.defender.repository - INFO - Renamed vulnerabilities_temp to vulnerabilities
2025-12-02 14:49:37,904 - app.integrations.defender.repository - INFO - Dropped old table vulnerabilities_old
2025-12-02 14:49:37,905 - app.integrations.defender.repository - INFO - Verifying data was saved correctly...
2025-12-02 14:49:37,958 - app.integrations.defender.repository - INFO - Verification: 176640 records found in vulnerabilities table
2025-12-02 14:49:37,958 - app.integrations.defender.repository - INFO - Data verification successful: 176640 records match expected count
2025-12-02 14:49:37,958 - app.integrations.defender.repository - INFO - Successfully saved 176640 vulnerability records using table switching method
2025-12-02 14:49:38,133 - app.integrations.defender.sync - INFO - Database verification: 176640 records in database after save
2025-12-02 14:49:38,133 - app.integrations.defender.sync - INFO - Device vulnerability details full sync completed, fetched 176640 records, saved 176640 records
2025-12-02 14:49:38,141 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-12-02 14:49:38.133288, type: full, records: 176640
2025-12-02 14:49:38,142 - app.integrations.defender.sync - INFO - Sync time recorded: 2025-12-02 14:49:38.133288, records: 176640
2025-12-02 14:49:38,253 - app.integrations.defender.sync - INFO - Starting vulnerability catalog sync...
2025-12-02 14:49:38,253 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=0
2025-12-02 14:49:45,908 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=0)
2025-12-02 14:49:45,908 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=8000
2025-12-02 14:49:53,917 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=8000)
2025-12-02 14:49:53,917 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=16000
2025-12-02 14:50:02,750 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=16000)
2025-12-02 14:50:02,750 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=24000
2025-12-02 14:50:10,311 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=24000)
2025-12-02 14:50:10,311 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=32000
2025-12-02 14:50:19,528 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=32000)
2025-12-02 14:50:19,528 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=40000
2025-12-02 14:50:26,991 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=40000)
2025-12-02 14:50:26,991 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=48000
2025-12-02 14:50:34,535 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=48000)
2025-12-02 14:50:34,536 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=56000
2025-12-02 14:50:43,090 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=56000)
2025-12-02 14:50:43,090 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=64000
2025-12-02 14:50:51,761 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=64000)
2025-12-02 14:50:51,761 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=72000
2025-12-02 14:50:58,905 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=72000)
2025-12-02 14:50:58,905 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=80000
2025-12-02 14:51:07,102 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=80000)
2025-12-02 14:51:07,103 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=88000
2025-12-02 14:51:11,853 - app.integrations.defender.sync - INFO - Database connection closed
2025-12-02 14:55:04,147 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-12-02 14:55:04,199 - mysql.connector - INFO - package: mysql.connector.plugins
2025-12-02 14:55:04,199 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-12-02 14:55:04,199 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-12-02 14:55:04,206 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-12-02 14:55:04,206 - app.integrations.defender.sync - INFO - Initializing database...
2025-12-02 14:55:04,210 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-12-02 14:55:04,210 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-12-02 14:55:04,210 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-12-02 14:55:04,212 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-12-02 14:55:04,215 - app.integrations.defender.database - INFO - vulnerabilities table exists, checking for autopatch_covered column...
2025-12-02 14:55:04,215 - app.integrations.defender.database - INFO - vulnerabilities table already has autopatch_covered column
2025-12-02 14:55:04,216 - app.integrations.defender.database - INFO - vulnerabilities already has metasploit_detected column
2025-12-02 14:55:04,217 - app.integrations.defender.database - INFO - vulnerabilities already has nuclei_detected column
2025-12-02 14:55:04,268 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-12-02 14:55:04,268 - app.integrations.defender.sync - INFO - Database initialization completed
2025-12-02 14:55:04,268 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-12-02 14:55:04,268 - app.integrations.defender.sync - INFO - Starting full sync...
2025-12-02 14:55:04,268 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-12-02 14:55:04,268 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-12-02 14:55:04,876 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-12-02 14:55:04,876 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-12-02 14:55:10,572 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-02 14:55:10,572 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMi8wNTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMDkyOX0=
2025-12-02 14:55:16,196 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-02 14:55:16,197 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMi8wNTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozOTUyNH0=
2025-12-02 14:55:22,753 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-02 14:55:22,754 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMi8wNTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4OTUyNH0=
2025-12-02 14:55:26,437 - app.integrations.defender.api_client - INFO - Fetched 26640 records
2025-12-02 14:55:26,437 - app.integrations.defender.api_client - INFO - Total fetched 176640 records
2025-12-02 14:55:26,438 - app.integrations.defender.service - INFO - Successfully fetched 176640 vulnerability records
2025-12-02 14:55:26,438 - app.integrations.defender.sync - INFO - API returned 176640 vulnerability records
2025-12-02 14:55:26,438 - app.integrations.defender.sync - INFO - Saving 176640 vulnerability records to database...
2025-12-02 14:55:26,438 - app.integrations.defender.repository - INFO - Starting to save 176640 vulnerability records...
2025-12-02 14:55:26,439 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-12-02 14:55:26,441 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-12-02 14:55:26,441 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-12-02 14:55:26,646 - app.integrations.defender.repository - INFO - Temporary table vulnerabilities_temp created successfully
2025-12-02 14:55:26,646 - app.integrations.defender.repository - INFO - Validating and preparing 176640 records for batch insert...
2025-12-02 14:55:26,727 - app.integrations.defender.repository - INFO - Validated 176640 out of 176640 records
2025-12-02 14:55:30,023 - app.integrations.defender.repository - INFO - Inserting 176640 records in batches of 2000...
2025-12-02 14:55:30,475 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-12-02 14:55:30,716 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-12-02 14:55:30,951 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-12-02 14:55:31,162 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-12-02 14:55:31,377 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-12-02 14:55:31,807 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-12-02 14:55:32,060 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-12-02 14:55:32,318 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-12-02 14:55:32,698 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-12-02 14:55:32,938 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-12-02 14:55:33,267 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-12-02 14:55:33,581 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-12-02 14:55:33,798 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-12-02 14:55:34,017 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-12-02 14:55:34,241 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-12-02 14:55:34,477 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-12-02 14:55:34,859 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-12-02 14:55:35,095 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-12-02 14:55:35,293 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-12-02 14:55:35,520 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-12-02 14:55:35,805 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-12-02 14:55:36,012 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-12-02 14:55:36,309 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-12-02 14:55:36,809 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-12-02 14:55:37,075 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-12-02 14:55:37,327 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-12-02 14:55:37,630 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-12-02 14:55:37,889 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-12-02 14:55:38,127 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-12-02 14:55:38,371 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-12-02 14:55:38,606 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-12-02 14:55:38,964 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-12-02 14:55:39,179 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-12-02 14:55:39,401 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-12-02 14:55:39,626 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-12-02 14:55:39,971 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-12-02 14:55:40,199 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-12-02 14:55:40,434 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-12-02 14:55:40,789 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-12-02 14:55:41,013 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-12-02 14:55:41,229 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-12-02 14:55:41,454 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-12-02 14:55:41,681 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-12-02 14:55:42,016 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-12-02 14:55:42,232 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-12-02 14:55:42,460 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-12-02 14:55:42,808 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-12-02 14:55:43,030 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-12-02 14:55:43,266 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-12-02 14:55:43,550 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-12-02 14:55:43,915 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-12-02 14:55:44,142 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-12-02 14:55:44,373 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-12-02 14:55:44,605 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-12-02 14:55:44,902 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-12-02 14:55:45,120 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-12-02 14:55:45,351 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-12-02 14:55:45,577 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-12-02 14:55:45,890 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-12-02 14:55:46,124 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-12-02 14:55:46,363 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-12-02 14:55:46,696 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-12-02 14:55:46,987 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-12-02 14:55:47,211 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-12-02 14:55:47,444 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-12-02 14:55:47,714 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-12-02 14:55:47,958 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-12-02 14:55:48,199 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-12-02 14:55:48,434 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-12-02 14:55:48,796 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-12-02 14:55:49,067 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-12-02 14:55:49,320 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-12-02 14:55:49,688 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-12-02 14:55:50,120 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-12-02 14:55:50,450 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-12-02 14:55:50,807 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-12-02 14:55:51,054 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-12-02 14:55:51,746 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-12-02 14:55:52,018 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-12-02 14:55:52,291 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-12-02 14:55:52,536 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-12-02 14:55:52,809 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-12-02 14:55:53,066 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-12-02 14:55:53,302 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-12-02 14:55:53,585 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-12-02 14:55:53,835 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-12-02 14:55:54,104 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-12-02 14:55:54,398 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-12-02 14:55:54,478 - app.integrations.defender.repository - INFO - Inserted batch 89 (640 records)
2025-12-02 14:55:54,698 - app.integrations.defender.repository - INFO - Successfully inserted 176640 records into temporary table
2025-12-02 14:55:54,698 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-12-02 14:55:54,798 - app.integrations.defender.repository - INFO - Renamed vulnerabilities to vulnerabilities_old
2025-12-02 14:55:54,943 - app.integrations.defender.repository - INFO - Renamed vulnerabilities_temp to vulnerabilities
2025-12-02 14:55:54,973 - app.integrations.defender.repository - INFO - Dropped old table vulnerabilities_old
2025-12-02 14:55:54,973 - app.integrations.defender.repository - INFO - Verifying data was saved correctly...
2025-12-02 14:55:55,046 - app.integrations.defender.repository - INFO - Verification: 176640 records found in vulnerabilities table
2025-12-02 14:55:55,046 - app.integrations.defender.repository - INFO - Data verification successful: 176640 records match expected count
2025-12-02 14:55:55,046 - app.integrations.defender.repository - INFO - Successfully saved 176640 vulnerability records using table switching method
2025-12-02 14:55:55,197 - app.integrations.defender.sync - INFO - Database verification: 176640 records in database after save
2025-12-02 14:55:55,197 - app.integrations.defender.sync - INFO - Device vulnerability details full sync completed, fetched 176640 records, saved 176640 records
2025-12-02 14:55:55,207 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-12-02 14:55:55.197595, type: full, records: 176640
2025-12-02 14:55:55,207 - app.integrations.defender.sync - INFO - Sync time recorded: 2025-12-02 14:55:55.197595, records: 176640
2025-12-02 14:55:55,310 - app.integrations.defender.sync - INFO - Starting vulnerability catalog sync...
2025-12-02 14:55:55,310 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=0&$count=true
2025-12-02 14:56:03,860 - app.integrations.defender.api_client - INFO - Catalog total count reported: 8000
2025-12-02 14:56:03,861 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=0)
2025-12-02 14:56:03,861 - app.integrations.defender.api_client - INFO - Reached reported catalog total count (8000), stopping
2025-12-02 14:56:03,861 - app.integrations.defender.api_client - INFO - Total fetched 8000 vulnerability catalog records
2025-12-02 14:56:03,862 - app.integrations.defender.service - INFO - Successfully fetched 8000 catalog records
2025-12-02 14:56:03,862 - app.integrations.defender.sync - INFO - Catalog API returned 8000 records
2025-12-02 14:56:04,631 - app.integrations.defender.repository - INFO - Saved/updated 8000 catalog records
2025-12-02 14:56:04,637 - app.integrations.defender.sync - INFO - Catalog sync completed, 8000 records saved
2025-12-02 14:56:04,639 - app.integrations.defender.sync - INFO - Creating snapshot after sync...
2025-12-02 14:56:06,388 - app.integrations.defender.repository - INFO - Recording CVE-Device combinations for snapshot (deduplicating by CVE-Device)...
2025-12-02 14:56:08,921 - app.integrations.defender.repository - INFO - Found 154301 unique CVE-Device combinations after deduplication
2025-12-02 14:56:09,083 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 1 (2000 records)
2025-12-02 14:56:09,181 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 2 (2000 records)
2025-12-02 14:56:09,258 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 3 (2000 records)
2025-12-02 14:56:09,335 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 4 (2000 records)
2025-12-02 14:56:09,414 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 5 (2000 records)
2025-12-02 14:56:09,503 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 6 (2000 records)
2025-12-02 14:56:09,590 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 7 (2000 records)
2025-12-02 14:56:09,750 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 8 (2000 records)
2025-12-02 14:56:09,841 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 9 (2000 records)
2025-12-02 14:56:09,957 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 10 (2000 records)
2025-12-02 14:56:10,041 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 11 (2000 records)
2025-12-02 14:56:10,129 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 12 (2000 records)
2025-12-02 14:56:10,266 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 13 (2000 records)
2025-12-02 14:56:10,350 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 14 (2000 records)
2025-12-02 14:56:10,431 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 15 (2000 records)
2025-12-02 14:56:10,511 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 16 (2000 records)
2025-12-02 14:56:10,585 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 17 (2000 records)
2025-12-02 14:56:10,741 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 18 (2000 records)
2025-12-02 14:56:10,843 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 19 (2000 records)
2025-12-02 14:56:10,920 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 20 (2000 records)
2025-12-02 14:56:10,996 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 21 (2000 records)
2025-12-02 14:56:11,072 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 22 (2000 records)
2025-12-02 14:56:11,151 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 23 (2000 records)
2025-12-02 14:56:11,227 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 24 (2000 records)
2025-12-02 14:56:11,300 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 25 (2000 records)
2025-12-02 14:56:11,368 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 26 (2000 records)
2025-12-02 14:56:11,442 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 27 (2000 records)
2025-12-02 14:56:11,516 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 28 (2000 records)
2025-12-02 14:56:11,588 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 29 (2000 records)
2025-12-02 14:56:11,789 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 30 (2000 records)
2025-12-02 14:56:11,890 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 31 (2000 records)
2025-12-02 14:56:11,964 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 32 (2000 records)
2025-12-02 14:56:12,050 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 33 (2000 records)
2025-12-02 14:56:12,123 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 34 (2000 records)
2025-12-02 14:56:12,194 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 35 (2000 records)
2025-12-02 14:56:12,266 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 36 (2000 records)
2025-12-02 14:56:12,343 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 37 (2000 records)
2025-12-02 14:56:12,420 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 38 (2000 records)
2025-12-02 14:56:12,493 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 39 (2000 records)
2025-12-02 14:56:12,568 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 40 (2000 records)
2025-12-02 14:56:12,740 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 41 (2000 records)
2025-12-02 14:56:12,822 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 42 (2000 records)
2025-12-02 14:56:12,905 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 43 (2000 records)
2025-12-02 14:56:12,980 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 44 (2000 records)
2025-12-02 14:56:13,053 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 45 (2000 records)
2025-12-02 14:56:13,143 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 46 (2000 records)
2025-12-02 14:56:13,221 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 47 (2000 records)
2025-12-02 14:56:13,294 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 48 (2000 records)
2025-12-02 14:56:13,364 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 49 (2000 records)
2025-12-02 14:56:13,438 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 50 (2000 records)
2025-12-02 14:56:13,509 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 51 (2000 records)
2025-12-02 14:56:13,581 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 52 (2000 records)
2025-12-02 14:56:13,787 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 53 (2000 records)
2025-12-02 14:56:13,865 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 54 (2000 records)
2025-12-02 14:56:13,938 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 55 (2000 records)
2025-12-02 14:56:14,010 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 56 (2000 records)
2025-12-02 14:56:14,081 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 57 (2000 records)
2025-12-02 14:56:14,152 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 58 (2000 records)
2025-12-02 14:56:14,224 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 59 (2000 records)
2025-12-02 14:56:14,301 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 60 (2000 records)
2025-12-02 14:56:14,372 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 61 (2000 records)
2025-12-02 14:56:14,443 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 62 (2000 records)
2025-12-02 14:56:14,515 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 63 (2000 records)
2025-12-02 14:56:14,601 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 64 (2000 records)
2025-12-02 14:56:14,751 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 65 (2000 records)
2025-12-02 14:56:14,827 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 66 (2000 records)
2025-12-02 14:56:14,899 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 67 (2000 records)
2025-12-02 14:56:14,982 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 68 (2000 records)
2025-12-02 14:56:15,059 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 69 (2000 records)
2025-12-02 14:56:15,129 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 70 (2000 records)
2025-12-02 14:56:15,199 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 71 (2000 records)
2025-12-02 14:56:15,271 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 72 (2000 records)
2025-12-02 14:56:15,342 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 73 (2000 records)
2025-12-02 14:56:15,414 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 74 (2000 records)
2025-12-02 14:56:15,493 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 75 (2000 records)
2025-12-02 14:56:15,568 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 76 (2000 records)
2025-12-02 14:56:15,672 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 77 (2000 records)
2025-12-02 14:56:15,713 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 78 (301 records)
2025-12-02 14:56:15,775 - app.integrations.defender.repository - INFO - Snapshot recorded successfully, snapshot ID: 12, CVE-Device records: 154301
2025-12-02 14:56:15,797 - app.integrations.defender.sync - INFO - Snapshot created successfully with ID: 12
2025-12-02 14:56:15,797 - app.integrations.defender.sync - INFO - Full sync completed successfully
2025-12-02 14:56:15,797 - app.integrations.defender.sync - INFO - Full sync process completed successfully
2025-12-02 14:56:15,798 - app.integrations.defender.sync - INFO - Database connection closed
2025-12-02 14:56:15,798 - app.integrations.defender.sync - INFO - Vulnerability data sync completed successfully
2025-12-02 15:58:25,912 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-12-02 15:58:25,947 - mysql.connector - INFO - package: mysql.connector.plugins
2025-12-02 15:58:25,948 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-12-02 15:58:25,948 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-12-02 15:58:25,954 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-12-02 15:58:25,955 - app.integrations.defender.sync - INFO - Initializing database...
2025-12-02 15:58:26,033 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-12-02 15:58:26,033 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-12-02 15:58:26,033 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-12-02 15:58:26,068 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-12-02 15:58:26,071 - app.integrations.defender.database - INFO - vulnerabilities table exists, checking for autopatch_covered column...
2025-12-02 15:58:26,072 - app.integrations.defender.database - INFO - vulnerabilities table already has autopatch_covered column
2025-12-02 15:58:26,074 - app.integrations.defender.database - INFO - vulnerabilities already has metasploit_detected column
2025-12-02 15:58:26,076 - app.integrations.defender.database - INFO - vulnerabilities already has nuclei_detected column
2025-12-02 15:58:26,077 - app.integrations.defender.database - INFO - vulnerabilities already has recordfuture_detected column
2025-12-02 15:58:26,150 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-12-02 15:58:26,151 - app.integrations.defender.sync - INFO - Database initialization completed
2025-12-02 15:58:26,151 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-12-02 15:58:26,151 - app.integrations.defender.sync - INFO - Starting full sync...
2025-12-02 15:58:26,151 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-12-02 15:58:26,151 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-12-02 15:58:26,710 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-12-02 15:58:26,711 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-12-02 15:58:32,532 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-02 15:58:32,532 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMi8wNTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMDkyOX0=
2025-12-02 15:58:38,310 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-02 15:58:38,311 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMi8wNTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozOTUyNH0=
2025-12-02 15:58:44,524 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-02 15:58:44,525 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMi8wNTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4OTUyNH0=
2025-12-02 15:58:48,483 - app.integrations.defender.api_client - INFO - Fetched 26640 records
2025-12-02 15:58:48,484 - app.integrations.defender.api_client - INFO - Total fetched 176640 records
2025-12-02 15:58:48,485 - app.integrations.defender.service - INFO - Successfully fetched 176640 vulnerability records
2025-12-02 15:58:48,486 - app.integrations.defender.sync - INFO - API returned 176640 vulnerability records
2025-12-02 15:58:48,486 - app.integrations.defender.sync - INFO - Saving 176640 vulnerability records to database...
2025-12-02 15:58:48,486 - app.integrations.defender.repository - INFO - Starting to save 176640 vulnerability records...
2025-12-02 15:58:48,489 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-12-02 15:58:48,499 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-12-02 15:58:48,502 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-12-02 15:58:48,815 - app.integrations.defender.repository - INFO - Temporary table vulnerabilities_temp created successfully
2025-12-02 15:58:48,815 - app.integrations.defender.repository - INFO - Validating and preparing 176640 records for batch insert...
2025-12-02 15:58:49,015 - app.integrations.defender.repository - INFO - Validated 176640 out of 176640 records
2025-12-02 15:58:52,615 - app.integrations.defender.repository - INFO - Inserting 176640 records in batches of 2000...
2025-12-02 15:58:53,075 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-12-02 15:58:53,410 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-12-02 15:58:53,759 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-12-02 15:58:54,140 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-12-02 15:58:54,464 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-12-02 15:58:54,750 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-12-02 15:58:55,233 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-12-02 15:58:55,491 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-12-02 15:58:55,765 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-12-02 15:58:56,112 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-12-02 15:58:56,379 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-12-02 15:58:56,640 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-12-02 15:58:56,893 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-12-02 15:58:57,155 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-12-02 15:58:57,390 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-12-02 15:58:57,642 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-12-02 15:58:57,882 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-12-02 15:58:58,287 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-12-02 15:58:58,498 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-12-02 15:58:58,740 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-12-02 15:58:59,027 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-12-02 15:58:59,294 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-12-02 15:58:59,525 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-12-02 15:58:59,761 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-12-02 15:59:00,189 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-12-02 15:59:00,525 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-12-02 15:59:00,782 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-12-02 15:59:01,222 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-12-02 15:59:01,483 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-12-02 15:59:01,732 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-12-02 15:59:01,985 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-12-02 15:59:02,335 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-12-02 15:59:02,610 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-12-02 15:59:02,852 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-12-02 15:59:03,114 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-12-02 15:59:03,370 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-12-02 15:59:03,603 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-12-02 15:59:03,858 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-12-02 15:59:04,291 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-12-02 15:59:04,570 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-12-02 15:59:04,792 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-12-02 15:59:05,048 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-12-02 15:59:05,373 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-12-02 15:59:05,603 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-12-02 15:59:05,842 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-12-02 15:59:06,195 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-12-02 15:59:06,433 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-12-02 15:59:06,672 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-12-02 15:59:06,920 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-12-02 15:59:07,343 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-12-02 15:59:07,578 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-12-02 15:59:07,811 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-12-02 15:59:08,218 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-12-02 15:59:08,466 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-12-02 15:59:08,735 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-12-02 15:59:09,112 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-12-02 15:59:09,347 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-12-02 15:59:09,575 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-12-02 15:59:09,826 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-12-02 15:59:10,152 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-12-02 15:59:10,557 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-12-02 15:59:10,820 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-12-02 15:59:11,194 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-12-02 15:59:11,765 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-12-02 15:59:12,464 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-12-02 15:59:13,388 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-12-02 15:59:14,199 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-12-02 15:59:14,777 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-12-02 15:59:15,894 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-12-02 15:59:16,483 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-12-02 15:59:16,801 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-12-02 15:59:17,216 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-12-02 15:59:17,598 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-12-02 15:59:17,951 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-12-02 15:59:18,308 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-12-02 15:59:18,611 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-12-02 15:59:18,913 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-12-02 15:59:19,232 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-12-02 15:59:19,841 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-12-02 15:59:20,331 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-12-02 15:59:20,604 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-12-02 15:59:20,875 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-12-02 15:59:21,385 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-12-02 15:59:21,631 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-12-02 15:59:21,893 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-12-02 15:59:22,271 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-12-02 15:59:22,734 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-12-02 15:59:23,145 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-12-02 15:59:23,373 - app.integrations.defender.repository - INFO - Inserted batch 89 (640 records)
2025-12-02 15:59:23,730 - app.integrations.defender.repository - INFO - Successfully inserted 176640 records into temporary table
2025-12-02 15:59:23,730 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-12-02 15:59:23,796 - app.integrations.defender.repository - INFO - Renamed vulnerabilities to vulnerabilities_old
2025-12-02 15:59:23,829 - app.integrations.defender.repository - INFO - Renamed vulnerabilities_temp to vulnerabilities
2025-12-02 15:59:23,869 - app.integrations.defender.repository - INFO - Dropped old table vulnerabilities_old
2025-12-02 15:59:23,869 - app.integrations.defender.repository - INFO - Verifying data was saved correctly...
2025-12-02 15:59:24,029 - app.integrations.defender.repository - INFO - Verification: 176640 records found in vulnerabilities table
2025-12-02 15:59:24,029 - app.integrations.defender.repository - INFO - Data verification successful: 176640 records match expected count
2025-12-02 15:59:24,029 - app.integrations.defender.repository - INFO - Successfully saved 176640 vulnerability records using table switching method
2025-12-02 15:59:24,268 - app.integrations.defender.sync - INFO - Database verification: 176640 records in database after save
2025-12-02 15:59:24,268 - app.integrations.defender.sync - INFO - Device vulnerability details full sync completed, fetched 176640 records, saved 176640 records
2025-12-02 15:59:24,277 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-12-02 15:59:24.268552, type: full, records: 176640
2025-12-02 15:59:24,277 - app.integrations.defender.sync - INFO - Sync time recorded: 2025-12-02 15:59:24.268552, records: 176640
2025-12-02 15:59:24,426 - app.integrations.defender.sync - INFO - Starting vulnerability catalog sync...
2025-12-02 15:59:24,426 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=0
2025-12-02 15:59:31,461 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=0)
2025-12-02 15:59:31,461 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=8000
2025-12-02 15:59:39,111 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=8000)
2025-12-02 15:59:39,113 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=16000
2025-12-02 15:59:46,672 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=16000)
2025-12-02 15:59:46,672 - app.integrations.defender.api_client - INFO - Total fetched 24000 vulnerability catalog records
2025-12-02 15:59:46,674 - app.integrations.defender.service - INFO - Successfully fetched 24000 catalog records
2025-12-02 15:59:46,674 - app.integrations.defender.sync - INFO - Catalog API returned 24000 records
2025-12-02 15:59:48,539 - app.integrations.defender.repository - INFO - Saved/updated 24000 catalog records
2025-12-02 15:59:48,544 - app.integrations.defender.sync - INFO - Catalog sync completed, 24000 records saved
2025-12-02 15:59:48,552 - app.integrations.defender.sync - INFO - Creating snapshot after sync...
2025-12-02 15:59:51,272 - app.integrations.defender.repository - INFO - Recording CVE-Device combinations for snapshot (deduplicating by CVE-Device)...
2025-12-02 15:59:54,043 - app.integrations.defender.repository - INFO - Found 154301 unique CVE-Device combinations after deduplication
2025-12-02 15:59:54,210 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 1 (2000 records)
2025-12-02 15:59:54,361 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 2 (2000 records)
2025-12-02 15:59:54,482 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 3 (2000 records)
2025-12-02 15:59:54,569 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 4 (2000 records)
2025-12-02 15:59:54,681 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 5 (2000 records)
2025-12-02 15:59:54,769 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 6 (2000 records)
2025-12-02 15:59:54,965 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 7 (2000 records)
2025-12-02 15:59:55,099 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 8 (2000 records)
2025-12-02 15:59:55,476 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 9 (2000 records)
2025-12-02 15:59:55,671 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 10 (2000 records)
2025-12-02 15:59:55,776 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 11 (2000 records)
2025-12-02 15:59:55,874 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 12 (2000 records)
2025-12-02 15:59:56,191 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 13 (2000 records)
2025-12-02 15:59:56,281 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 14 (2000 records)
2025-12-02 15:59:56,366 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 15 (2000 records)
2025-12-02 15:59:56,448 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 16 (2000 records)
2025-12-02 15:59:56,522 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 17 (2000 records)
2025-12-02 15:59:56,608 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 18 (2000 records)
2025-12-02 15:59:56,686 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 19 (2000 records)
2025-12-02 15:59:56,764 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 20 (2000 records)
2025-12-02 15:59:56,841 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 21 (2000 records)
2025-12-02 15:59:56,930 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 22 (2000 records)
2025-12-02 15:59:57,007 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 23 (2000 records)
2025-12-02 15:59:57,101 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 24 (2000 records)
2025-12-02 15:59:57,208 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 25 (2000 records)
2025-12-02 15:59:57,346 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 26 (2000 records)
2025-12-02 15:59:57,423 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 27 (2000 records)
2025-12-02 15:59:57,505 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 28 (2000 records)
2025-12-02 15:59:57,588 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 29 (2000 records)
2025-12-02 15:59:57,669 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 30 (2000 records)
2025-12-02 15:59:57,744 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 31 (2000 records)
2025-12-02 15:59:57,827 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 32 (2000 records)
2025-12-02 15:59:57,904 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 33 (2000 records)
2025-12-02 15:59:57,982 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 34 (2000 records)
2025-12-02 15:59:58,089 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 35 (2000 records)
2025-12-02 15:59:58,264 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 36 (2000 records)
2025-12-02 15:59:58,342 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 37 (2000 records)
2025-12-02 15:59:58,421 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 38 (2000 records)
2025-12-02 15:59:58,503 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 39 (2000 records)
2025-12-02 15:59:58,585 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 40 (2000 records)
2025-12-02 15:59:58,661 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 41 (2000 records)
2025-12-02 15:59:58,737 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 42 (2000 records)
2025-12-02 15:59:58,816 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 43 (2000 records)
2025-12-02 15:59:58,893 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 44 (2000 records)
2025-12-02 15:59:58,968 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 45 (2000 records)
2025-12-02 15:59:59,058 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 46 (2000 records)
2025-12-02 15:59:59,244 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 47 (2000 records)
2025-12-02 15:59:59,319 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 48 (2000 records)
2025-12-02 15:59:59,394 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 49 (2000 records)
2025-12-02 15:59:59,470 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 50 (2000 records)
2025-12-02 15:59:59,543 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 51 (2000 records)
2025-12-02 15:59:59,619 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 52 (2000 records)
2025-12-02 15:59:59,695 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 53 (2000 records)
2025-12-02 15:59:59,770 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 54 (2000 records)
2025-12-02 15:59:59,847 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 55 (2000 records)
2025-12-02 15:59:59,923 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 56 (2000 records)
2025-12-02 16:00:00,004 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 57 (2000 records)
2025-12-02 16:00:00,202 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 58 (2000 records)
2025-12-02 16:00:00,332 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 59 (2000 records)
2025-12-02 16:00:00,407 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 60 (2000 records)
2025-12-02 16:00:00,483 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 61 (2000 records)
2025-12-02 16:00:00,555 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 62 (2000 records)
2025-12-02 16:00:00,630 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 63 (2000 records)
2025-12-02 16:00:00,708 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 64 (2000 records)
2025-12-02 16:00:00,783 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 65 (2000 records)
2025-12-02 16:00:00,864 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 66 (2000 records)
2025-12-02 16:00:00,941 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 67 (2000 records)
2025-12-02 16:00:01,025 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 68 (2000 records)
2025-12-02 16:00:01,367 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 69 (2000 records)
2025-12-02 16:00:01,453 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 70 (2000 records)
2025-12-02 16:00:01,526 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 71 (2000 records)
2025-12-02 16:00:01,601 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 72 (2000 records)
2025-12-02 16:00:01,674 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 73 (2000 records)
2025-12-02 16:00:01,761 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 74 (2000 records)
2025-12-02 16:00:01,839 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 75 (2000 records)
2025-12-02 16:00:01,925 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 76 (2000 records)
2025-12-02 16:00:01,997 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 77 (2000 records)
2025-12-02 16:00:02,013 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 78 (301 records)
2025-12-02 16:00:02,119 - app.integrations.defender.repository - INFO - Snapshot recorded successfully, snapshot ID: 13, CVE-Device records: 154301
2025-12-02 16:00:02,153 - app.integrations.defender.sync - INFO - Snapshot created successfully with ID: 13
2025-12-02 16:00:02,154 - app.integrations.defender.sync - INFO - Full sync completed successfully
2025-12-02 16:00:02,154 - app.integrations.defender.sync - INFO - Full sync process completed successfully
2025-12-02 16:00:02,154 - app.integrations.defender.sync - INFO - Database connection closed
2025-12-02 16:00:02,154 - app.integrations.defender.sync - INFO - Vulnerability data sync completed successfully
2025-12-03 13:53:13,792 - app.integrations.defender.sync - INFO - Starting Defender vulnerability data sync...
2025-12-03 13:53:13,811 - mysql.connector - INFO - package: mysql.connector.plugins
2025-12-03 13:53:13,812 - mysql.connector - INFO - plugin_name: caching_sha2_password
2025-12-03 13:53:13,812 - mysql.connector - INFO - AUTHENTICATION_PLUGIN_CLASS: MySQLCachingSHA2PasswordAuthPlugin
2025-12-03 13:53:13,813 - app.integrations.defender.database - INFO - Successfully connected to MySQL database
2025-12-03 13:53:13,813 - app.integrations.defender.sync - INFO - Initializing database...
2025-12-03 13:53:13,815 - app.integrations.defender.database - INFO - sync_state table exists, checking structure...
2025-12-03 13:53:13,815 - app.integrations.defender.database - INFO - Adding records_count column to sync_state table...
2025-12-03 13:53:13,815 - app.integrations.defender.database - WARNING - Error adding records_count column: Unread result found
2025-12-03 13:53:13,816 - app.integrations.defender.database - INFO - data_source column doesn't exist, no need to remove
2025-12-03 13:53:13,818 - app.integrations.defender.database - INFO - vulnerabilities table exists, checking for autopatch_covered column...
2025-12-03 13:53:13,819 - app.integrations.defender.database - INFO - vulnerabilities table already has autopatch_covered column
2025-12-03 13:53:13,819 - app.integrations.defender.database - INFO - vulnerabilities already has metasploit_detected column
2025-12-03 13:53:13,819 - app.integrations.defender.database - INFO - vulnerabilities already has nuclei_detected column
2025-12-03 13:53:13,819 - app.integrations.defender.database - INFO - vulnerabilities already has recordfuture_detected column
2025-12-03 13:53:13,853 - app.integrations.defender.database - INFO - Database table structure initialized successfully
2025-12-03 13:53:13,853 - app.integrations.defender.sync - INFO - Database initialization completed
2025-12-03 13:53:13,853 - app.integrations.defender.sync - INFO - Starting full sync process...
2025-12-03 13:53:13,853 - app.integrations.defender.sync - INFO - Starting full sync...
2025-12-03 13:53:13,853 - app.integrations.defender.sync - INFO - Starting device vulnerability details full sync...
2025-12-03 13:53:13,853 - app.integrations.defender.sync - INFO - Fetching vulnerabilities from Microsoft Defender API...
2025-12-03 13:53:14,415 - app.integrations.defender.auth - INFO - Successfully obtained access token
2025-12-03 13:53:14,415 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pageSize=50000
2025-12-03 13:53:20,803 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-03 13:53:20,803 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMy8wMTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjMsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjoxMDE1M30=
2025-12-03 13:53:26,547 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-03 13:53:26,547 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMy8wMTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0IjozODQzNn0=
2025-12-03 13:53:32,644 - app.integrations.defender.api_client - INFO - Fetched 50000 records
2025-12-03 13:53:32,645 - app.integrations.defender.api_client - INFO - Requesting: https://us.api.security.microsoft.com/api/machines/SoftwareVulnerabilitiesByMachine?pagesize=50000&$skiptoken=eyJFeHBvcnREZWZpbml0aW9uIjp7IlRpbWVQYXRoIjoiMjAyNS0xMi0wMy8wMTQwLyJ9LCJFeHBvcnRGaWxlSW5kZXgiOjcsIkV4cG9ydEZpbGVOYW1lIjpudWxsLCJMaW5lU3RvcHBlZEF0Ijo4ODQzNn0=
2025-12-03 13:53:37,129 - app.integrations.defender.api_client - INFO - Fetched 35267 records
2025-12-03 13:53:37,129 - app.integrations.defender.api_client - INFO - Total fetched 185267 records
2025-12-03 13:53:37,130 - app.integrations.defender.service - INFO - Successfully fetched 185267 vulnerability records
2025-12-03 13:53:37,130 - app.integrations.defender.sync - INFO - API returned 185267 vulnerability records
2025-12-03 13:53:37,130 - app.integrations.defender.sync - INFO - Saving 185267 vulnerability records to database...
2025-12-03 13:53:37,130 - app.integrations.defender.repository - INFO - Starting to save 185267 vulnerability records...
2025-12-03 13:53:37,133 - app.integrations.defender.repository - INFO - Checking if vulnerabilities table exists...
2025-12-03 13:53:37,136 - app.integrations.defender.repository - INFO - vulnerabilities table exists
2025-12-03 13:53:37,136 - app.integrations.defender.repository - INFO - Creating temporary table for data insertion...
2025-12-03 13:53:37,344 - app.integrations.defender.repository - INFO - Temporary table vulnerabilities_temp created successfully
2025-12-03 13:53:37,345 - app.integrations.defender.repository - INFO - Validating and preparing 185267 records for batch insert...
2025-12-03 13:53:37,409 - app.integrations.defender.repository - INFO - Validated 185267 out of 185267 records
2025-12-03 13:53:39,956 - app.integrations.defender.repository - INFO - Inserting 185267 records in batches of 2000...
2025-12-03 13:53:40,530 - app.integrations.defender.repository - INFO - Inserted batch 1 (2000 records)
2025-12-03 13:53:40,824 - app.integrations.defender.repository - INFO - Inserted batch 2 (2000 records)
2025-12-03 13:53:41,197 - app.integrations.defender.repository - INFO - Inserted batch 3 (2000 records)
2025-12-03 13:53:41,611 - app.integrations.defender.repository - INFO - Inserted batch 4 (2000 records)
2025-12-03 13:53:41,897 - app.integrations.defender.repository - INFO - Inserted batch 5 (2000 records)
2025-12-03 13:53:42,174 - app.integrations.defender.repository - INFO - Inserted batch 6 (2000 records)
2025-12-03 13:53:42,471 - app.integrations.defender.repository - INFO - Inserted batch 7 (2000 records)
2025-12-03 13:53:42,915 - app.integrations.defender.repository - INFO - Inserted batch 8 (2000 records)
2025-12-03 13:53:43,209 - app.integrations.defender.repository - INFO - Inserted batch 9 (2000 records)
2025-12-03 13:53:43,512 - app.integrations.defender.repository - INFO - Inserted batch 10 (2000 records)
2025-12-03 13:53:43,759 - app.integrations.defender.repository - INFO - Inserted batch 11 (2000 records)
2025-12-03 13:53:44,015 - app.integrations.defender.repository - INFO - Inserted batch 12 (2000 records)
2025-12-03 13:53:44,228 - app.integrations.defender.repository - INFO - Inserted batch 13 (2000 records)
2025-12-03 13:53:44,446 - app.integrations.defender.repository - INFO - Inserted batch 14 (2000 records)
2025-12-03 13:53:44,746 - app.integrations.defender.repository - INFO - Inserted batch 15 (2000 records)
2025-12-03 13:53:44,969 - app.integrations.defender.repository - INFO - Inserted batch 16 (2000 records)
2025-12-03 13:53:45,183 - app.integrations.defender.repository - INFO - Inserted batch 17 (2000 records)
2025-12-03 13:53:45,438 - app.integrations.defender.repository - INFO - Inserted batch 18 (2000 records)
2025-12-03 13:53:45,786 - app.integrations.defender.repository - INFO - Inserted batch 19 (2000 records)
2025-12-03 13:53:46,030 - app.integrations.defender.repository - INFO - Inserted batch 20 (2000 records)
2025-12-03 13:53:46,254 - app.integrations.defender.repository - INFO - Inserted batch 21 (2000 records)
2025-12-03 13:53:46,475 - app.integrations.defender.repository - INFO - Inserted batch 22 (2000 records)
2025-12-03 13:53:46,773 - app.integrations.defender.repository - INFO - Inserted batch 23 (2000 records)
2025-12-03 13:53:47,015 - app.integrations.defender.repository - INFO - Inserted batch 24 (2000 records)
2025-12-03 13:53:47,239 - app.integrations.defender.repository - INFO - Inserted batch 25 (2000 records)
2025-12-03 13:53:47,476 - app.integrations.defender.repository - INFO - Inserted batch 26 (2000 records)
2025-12-03 13:53:47,807 - app.integrations.defender.repository - INFO - Inserted batch 27 (2000 records)
2025-12-03 13:53:48,011 - app.integrations.defender.repository - INFO - Inserted batch 28 (2000 records)
2025-12-03 13:53:48,231 - app.integrations.defender.repository - INFO - Inserted batch 29 (2000 records)
2025-12-03 13:53:48,465 - app.integrations.defender.repository - INFO - Inserted batch 30 (2000 records)
2025-12-03 13:53:48,788 - app.integrations.defender.repository - INFO - Inserted batch 31 (2000 records)
2025-12-03 13:53:49,015 - app.integrations.defender.repository - INFO - Inserted batch 32 (2000 records)
2025-12-03 13:53:49,232 - app.integrations.defender.repository - INFO - Inserted batch 33 (2000 records)
2025-12-03 13:53:49,450 - app.integrations.defender.repository - INFO - Inserted batch 34 (2000 records)
2025-12-03 13:53:49,772 - app.integrations.defender.repository - INFO - Inserted batch 35 (2000 records)
2025-12-03 13:53:50,005 - app.integrations.defender.repository - INFO - Inserted batch 36 (2000 records)
2025-12-03 13:53:50,267 - app.integrations.defender.repository - INFO - Inserted batch 37 (2000 records)
2025-12-03 13:53:50,530 - app.integrations.defender.repository - INFO - Inserted batch 38 (2000 records)
2025-12-03 13:53:50,758 - app.integrations.defender.repository - INFO - Inserted batch 39 (2000 records)
2025-12-03 13:53:50,971 - app.integrations.defender.repository - INFO - Inserted batch 40 (2000 records)
2025-12-03 13:53:51,185 - app.integrations.defender.repository - INFO - Inserted batch 41 (2000 records)
2025-12-03 13:53:51,423 - app.integrations.defender.repository - INFO - Inserted batch 42 (2000 records)
2025-12-03 13:53:51,824 - app.integrations.defender.repository - INFO - Inserted batch 43 (2000 records)
2025-12-03 13:53:52,049 - app.integrations.defender.repository - INFO - Inserted batch 44 (2000 records)
2025-12-03 13:53:52,262 - app.integrations.defender.repository - INFO - Inserted batch 45 (2000 records)
2025-12-03 13:53:52,499 - app.integrations.defender.repository - INFO - Inserted batch 46 (2000 records)
2025-12-03 13:53:52,861 - app.integrations.defender.repository - INFO - Inserted batch 47 (2000 records)
2025-12-03 13:53:53,099 - app.integrations.defender.repository - INFO - Inserted batch 48 (2000 records)
2025-12-03 13:53:53,327 - app.integrations.defender.repository - INFO - Inserted batch 49 (2000 records)
2025-12-03 13:53:53,641 - app.integrations.defender.repository - INFO - Inserted batch 50 (2000 records)
2025-12-03 13:53:53,881 - app.integrations.defender.repository - INFO - Inserted batch 51 (2000 records)
2025-12-03 13:53:54,116 - app.integrations.defender.repository - INFO - Inserted batch 52 (2000 records)
2025-12-03 13:53:54,368 - app.integrations.defender.repository - INFO - Inserted batch 53 (2000 records)
2025-12-03 13:53:54,761 - app.integrations.defender.repository - INFO - Inserted batch 54 (2000 records)
2025-12-03 13:53:54,990 - app.integrations.defender.repository - INFO - Inserted batch 55 (2000 records)
2025-12-03 13:53:55,206 - app.integrations.defender.repository - INFO - Inserted batch 56 (2000 records)
2025-12-03 13:53:55,436 - app.integrations.defender.repository - INFO - Inserted batch 57 (2000 records)
2025-12-03 13:53:55,985 - app.integrations.defender.repository - INFO - Inserted batch 58 (2000 records)
2025-12-03 13:53:56,213 - app.integrations.defender.repository - INFO - Inserted batch 59 (2000 records)
2025-12-03 13:53:56,432 - app.integrations.defender.repository - INFO - Inserted batch 60 (2000 records)
2025-12-03 13:53:56,720 - app.integrations.defender.repository - INFO - Inserted batch 61 (2000 records)
2025-12-03 13:53:56,945 - app.integrations.defender.repository - INFO - Inserted batch 62 (2000 records)
2025-12-03 13:53:57,172 - app.integrations.defender.repository - INFO - Inserted batch 63 (2000 records)
2025-12-03 13:53:57,399 - app.integrations.defender.repository - INFO - Inserted batch 64 (2000 records)
2025-12-03 13:53:57,706 - app.integrations.defender.repository - INFO - Inserted batch 65 (2000 records)
2025-12-03 13:53:58,098 - app.integrations.defender.repository - INFO - Inserted batch 66 (2000 records)
2025-12-03 13:53:58,324 - app.integrations.defender.repository - INFO - Inserted batch 67 (2000 records)
2025-12-03 13:53:58,585 - app.integrations.defender.repository - INFO - Inserted batch 68 (2000 records)
2025-12-03 13:53:58,821 - app.integrations.defender.repository - INFO - Inserted batch 69 (2000 records)
2025-12-03 13:53:59,032 - app.integrations.defender.repository - INFO - Inserted batch 70 (2000 records)
2025-12-03 13:53:59,288 - app.integrations.defender.repository - INFO - Inserted batch 71 (2000 records)
2025-12-03 13:53:59,548 - app.integrations.defender.repository - INFO - Inserted batch 72 (2000 records)
2025-12-03 13:53:59,910 - app.integrations.defender.repository - INFO - Inserted batch 73 (2000 records)
2025-12-03 13:54:00,163 - app.integrations.defender.repository - INFO - Inserted batch 74 (2000 records)
2025-12-03 13:54:00,401 - app.integrations.defender.repository - INFO - Inserted batch 75 (2000 records)
2025-12-03 13:54:00,727 - app.integrations.defender.repository - INFO - Inserted batch 76 (2000 records)
2025-12-03 13:54:00,984 - app.integrations.defender.repository - INFO - Inserted batch 77 (2000 records)
2025-12-03 13:54:01,209 - app.integrations.defender.repository - INFO - Inserted batch 78 (2000 records)
2025-12-03 13:54:01,442 - app.integrations.defender.repository - INFO - Inserted batch 79 (2000 records)
2025-12-03 13:54:01,822 - app.integrations.defender.repository - INFO - Inserted batch 80 (2000 records)
2025-12-03 13:54:02,102 - app.integrations.defender.repository - INFO - Inserted batch 81 (2000 records)
2025-12-03 13:54:02,336 - app.integrations.defender.repository - INFO - Inserted batch 82 (2000 records)
2025-12-03 13:54:02,614 - app.integrations.defender.repository - INFO - Inserted batch 83 (2000 records)
2025-12-03 13:54:02,917 - app.integrations.defender.repository - INFO - Inserted batch 84 (2000 records)
2025-12-03 13:54:03,153 - app.integrations.defender.repository - INFO - Inserted batch 85 (2000 records)
2025-12-03 13:54:03,394 - app.integrations.defender.repository - INFO - Inserted batch 86 (2000 records)
2025-12-03 13:54:03,838 - app.integrations.defender.repository - INFO - Inserted batch 87 (2000 records)
2025-12-03 13:54:04,083 - app.integrations.defender.repository - INFO - Inserted batch 88 (2000 records)
2025-12-03 13:54:04,306 - app.integrations.defender.repository - INFO - Inserted batch 89 (2000 records)
2025-12-03 13:54:04,557 - app.integrations.defender.repository - INFO - Inserted batch 90 (2000 records)
2025-12-03 13:54:05,458 - app.integrations.defender.repository - INFO - Inserted batch 91 (2000 records)
2025-12-03 13:54:05,766 - app.integrations.defender.repository - INFO - Inserted batch 92 (2000 records)
2025-12-03 13:54:05,958 - app.integrations.defender.repository - INFO - Inserted batch 93 (1267 records)
2025-12-03 13:54:06,328 - app.integrations.defender.repository - INFO - Successfully inserted 185267 records into temporary table
2025-12-03 13:54:06,328 - app.integrations.defender.repository - INFO - Switching tables atomically...
2025-12-03 13:54:06,399 - app.integrations.defender.repository - INFO - Renamed vulnerabilities to vulnerabilities_old
2025-12-03 13:54:06,428 - app.integrations.defender.repository - INFO - Renamed vulnerabilities_temp to vulnerabilities
2025-12-03 13:54:06,475 - app.integrations.defender.repository - INFO - Dropped old table vulnerabilities_old
2025-12-03 13:54:06,475 - app.integrations.defender.repository - INFO - Verifying data was saved correctly...
2025-12-03 13:54:06,739 - app.integrations.defender.repository - INFO - Verification: 185267 records found in vulnerabilities table
2025-12-03 13:54:06,739 - app.integrations.defender.repository - INFO - Data verification successful: 185267 records match expected count
2025-12-03 13:54:06,739 - app.integrations.defender.repository - INFO - Successfully saved 185267 vulnerability records using table switching method
2025-12-03 13:54:06,928 - app.integrations.defender.sync - INFO - Database verification: 185267 records in database after save
2025-12-03 13:54:06,929 - app.integrations.defender.sync - INFO - Device vulnerability details full sync completed, fetched 185267 records, saved 185267 records
2025-12-03 13:54:06,945 - app.integrations.defender.repository - INFO - Sync time updated successfully: 2025-12-03 13:54:06.929086, type: full, records: 185267
2025-12-03 13:54:06,946 - app.integrations.defender.sync - INFO - Sync time recorded: 2025-12-03 13:54:06.929086, records: 185267
2025-12-03 13:54:07,050 - app.integrations.defender.sync - INFO - Starting vulnerability catalog sync...
2025-12-03 13:54:07,050 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=0
2025-12-03 13:54:14,685 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=0)
2025-12-03 13:54:14,685 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=8000
2025-12-03 13:54:23,637 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=8000)
2025-12-03 13:54:23,637 - app.integrations.defender.api_client - INFO - Requesting vulnerability catalog: https://us.api.security.microsoft.com/api/vulnerabilities?$top=8000&$skip=16000
2025-12-03 13:54:31,377 - app.integrations.defender.api_client - INFO - Fetched 8000 catalog records (skip=16000)
2025-12-03 13:54:31,377 - app.integrations.defender.api_client - INFO - Total fetched 24000 vulnerability catalog records
2025-12-03 13:54:31,378 - app.integrations.defender.service - INFO - Successfully fetched 24000 catalog records
2025-12-03 13:54:31,378 - app.integrations.defender.sync - INFO - Catalog API returned 24000 records
2025-12-03 13:54:32,999 - app.integrations.defender.repository - INFO - Saved/updated 24000 catalog records
2025-12-03 13:54:33,005 - app.integrations.defender.sync - INFO - Catalog sync completed, 24000 records saved
2025-12-03 13:54:33,012 - app.integrations.defender.sync - INFO - Creating snapshot after sync...
2025-12-03 13:54:34,725 - app.integrations.defender.repository - INFO - Recording CVE-Device combinations for snapshot (deduplicating by CVE-Device)...
2025-12-03 13:54:37,512 - app.integrations.defender.repository - INFO - Found 162986 unique CVE-Device combinations after deduplication
2025-12-03 13:54:37,677 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 1 (2000 records)
2025-12-03 13:54:37,772 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 2 (2000 records)
2025-12-03 13:54:37,850 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 3 (2000 records)
2025-12-03 13:54:37,920 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 4 (2000 records)
2025-12-03 13:54:37,995 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 5 (2000 records)
2025-12-03 13:54:38,069 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 6 (2000 records)
2025-12-03 13:54:38,144 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 7 (2000 records)
2025-12-03 13:54:38,215 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 8 (2000 records)
2025-12-03 13:54:38,304 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 9 (2000 records)
2025-12-03 13:54:38,381 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 10 (2000 records)
2025-12-03 13:54:38,467 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 11 (2000 records)
2025-12-03 13:54:38,547 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 12 (2000 records)
2025-12-03 13:54:38,797 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 13 (2000 records)
2025-12-03 13:54:38,898 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 14 (2000 records)
2025-12-03 13:54:38,986 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 15 (2000 records)
2025-12-03 13:54:39,072 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 16 (2000 records)
2025-12-03 13:54:39,146 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 17 (2000 records)
2025-12-03 13:54:39,224 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 18 (2000 records)
2025-12-03 13:54:39,324 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 19 (2000 records)
2025-12-03 13:54:39,401 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 20 (2000 records)
2025-12-03 13:54:39,479 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 21 (2000 records)
2025-12-03 13:54:39,555 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 22 (2000 records)
2025-12-03 13:54:39,702 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 23 (2000 records)
2025-12-03 13:54:39,803 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 24 (2000 records)
2025-12-03 13:54:39,875 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 25 (2000 records)
2025-12-03 13:54:39,945 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 26 (2000 records)
2025-12-03 13:54:40,013 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 27 (2000 records)
2025-12-03 13:54:40,082 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 28 (2000 records)
2025-12-03 13:54:40,155 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 29 (2000 records)
2025-12-03 13:54:40,227 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 30 (2000 records)
2025-12-03 13:54:40,297 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 31 (2000 records)
2025-12-03 13:54:40,363 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 32 (2000 records)
2025-12-03 13:54:40,440 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 33 (2000 records)
2025-12-03 13:54:40,515 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 34 (2000 records)
2025-12-03 13:54:40,585 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 35 (2000 records)
2025-12-03 13:54:40,735 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 36 (2000 records)
2025-12-03 13:54:40,798 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 37 (2000 records)
2025-12-03 13:54:40,868 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 38 (2000 records)
2025-12-03 13:54:40,937 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 39 (2000 records)
2025-12-03 13:54:41,012 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 40 (2000 records)
2025-12-03 13:54:41,079 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 41 (2000 records)
2025-12-03 13:54:41,151 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 42 (2000 records)
2025-12-03 13:54:41,224 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 43 (2000 records)
2025-12-03 13:54:41,292 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 44 (2000 records)
2025-12-03 13:54:41,363 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 45 (2000 records)
2025-12-03 13:54:41,433 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 46 (2000 records)
2025-12-03 13:54:41,509 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 47 (2000 records)
2025-12-03 13:54:41,580 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 48 (2000 records)
2025-12-03 13:54:41,794 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 49 (2000 records)
2025-12-03 13:54:41,861 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 50 (2000 records)
2025-12-03 13:54:41,931 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 51 (2000 records)
2025-12-03 13:54:42,001 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 52 (2000 records)
2025-12-03 13:54:42,076 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 53 (2000 records)
2025-12-03 13:54:42,146 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 54 (2000 records)
2025-12-03 13:54:42,213 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 55 (2000 records)
2025-12-03 13:54:42,282 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 56 (2000 records)
2025-12-03 13:54:42,350 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 57 (2000 records)
2025-12-03 13:54:42,423 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 58 (2000 records)
2025-12-03 13:54:42,500 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 59 (2000 records)
2025-12-03 13:54:42,570 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 60 (2000 records)
2025-12-03 13:54:42,738 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 61 (2000 records)
2025-12-03 13:54:42,809 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 62 (2000 records)
2025-12-03 13:54:42,878 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 63 (2000 records)
2025-12-03 13:54:42,950 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 64 (2000 records)
2025-12-03 13:54:43,017 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 65 (2000 records)
2025-12-03 13:54:43,092 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 66 (2000 records)
2025-12-03 13:54:43,163 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 67 (2000 records)
2025-12-03 13:54:43,232 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 68 (2000 records)
2025-12-03 13:54:43,301 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 69 (2000 records)
2025-12-03 13:54:43,380 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 70 (2000 records)
2025-12-03 13:54:43,453 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 71 (2000 records)
2025-12-03 13:54:43,525 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 72 (2000 records)
2025-12-03 13:54:43,594 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 73 (2000 records)
2025-12-03 13:54:43,738 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 74 (2000 records)
2025-12-03 13:54:43,808 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 75 (2000 records)
2025-12-03 13:54:43,877 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 76 (2000 records)
2025-12-03 13:54:43,954 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 77 (2000 records)
2025-12-03 13:54:44,024 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 78 (2000 records)
2025-12-03 13:54:44,090 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 79 (2000 records)
2025-12-03 13:54:44,159 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 80 (2000 records)
2025-12-03 13:54:44,228 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 81 (2000 records)
2025-12-03 13:54:44,260 - app.integrations.defender.repository - INFO - Inserted CVE-Device snapshot batch 82 (986 records)
2025-12-03 13:54:44,306 - app.integrations.defender.repository - INFO - Snapshot recorded successfully, snapshot ID: 14, CVE-Device records: 162986
2025-12-03 13:54:44,328 - app.integrations.defender.sync - INFO - Snapshot created successfully with ID: 14
2025-12-03 13:54:44,328 - app.integrations.defender.sync - INFO - Full sync completed successfully
2025-12-03 13:54:44,328 - app.integrations.defender.sync - INFO - Full sync process completed successfully
2025-12-03 13:54:44,329 - app.integrations.defender.sync - INFO - Database connection closed
2025-12-03 13:54:44,329 - app.integrations.defender.sync - INFO - Vulnerability data sync completed successfully
